function t(g,f){var x=Object.keys(g);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(g);f&&(C=C.filter((function(f){return Object.getOwnPropertyDescriptor(g,f).enumerable}))),x.push.apply(x,C)}return x}function e(g){for(var f=1;f<arguments.length;f++){var x=null!=arguments[f]?arguments[f]:{};f%2?t(Object(x),!0).forEach((function(f){s(g,f,x[f])})):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(x)):t(Object(x)).forEach((function(f){Object.defineProperty(g,f,Object.getOwnPropertyDescriptor(x,f))}))}return g}function s(g,f,x){return(f=n(f))in g?Object.defineProperty(g,f,{value:x,enumerable:!0,configurable:!0,writable:!0}):g[f]=x,g}function i(g,f){if(null==g)return{};var x,C,w=function(g,f){if(null==g)return{};var x,C,w={},S=Object.keys(g);for(C=0;C<S.length;C++)x=S[C],f.indexOf(x)>=0||(w[x]=g[x]);return w}(g,f);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(g);for(C=0;C<S.length;C++)x=S[C],f.indexOf(x)>=0||Object.prototype.propertyIsEnumerable.call(g,x)&&(w[x]=g[x])}return w}function r(g,f){return f||(f=g.slice(0)),Object.freeze(Object.defineProperties(g,{raw:{value:Object.freeze(f)}}))}function n(g){var f=function(g,f){if("object"!=typeof g||null===g)return g;var x=g[Symbol.toPrimitive];if(void 0!==x){var C=x.call(g,f||"default");if("object"!=typeof C)return C;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===f?String:Number)(g)}(g,"string");return"symbol"==typeof f?f:String(f)}class o{constructor(){s(this,"browserShadowBlurConstant",1),s(this,"DPI",96),s(this,"devicePixelRatio","undefined"!=typeof window?window.devicePixelRatio:1),s(this,"perfLimitSizeTotal",2097152),s(this,"maxCacheSideLimit",4096),s(this,"minCacheSideLimit",256),s(this,"disableStyleCopyPaste",!1),s(this,"enableGLFiltering",!0),s(this,"textureSize",4096),s(this,"forceGLPutImageData",!1),s(this,"cachesBoundsOfCurve",!0),s(this,"fontPaths",{}),s(this,"NUM_FRACTION_DIGITS",4)}}const g=new class extends o{constructor(g){super(),this.configure(g)}configure(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,g)}addFonts(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.fontPaths=e(e({},this.fontPaths),g)}removeFonts(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((g=>{delete this.fontPaths[g]}))}clearFonts(){this.fontPaths={}}restoreDefaults(g){const f=new o,x=(null==g?void 0:g.reduce(((g,x)=>(g[x]=f[x],g)),{}))||f;this.configure(x)}},h=function(g){for(var f=arguments.length,x=new Array(f>1?f-1:0),C=1;C<f;C++)x[C-1]=arguments[C];return console[g]("fabric",...x)};class c extends Error{constructor(g,f){super("fabric: ".concat(g),f)}}class l extends c{constructor(g){super("".concat(g," 'options.signal' is in 'aborted' state"))}}class u{}class d extends u{testPrecision(g,f){const x="precision ".concat(f," float;\nvoid main(){}"),C=g.createShader(g.FRAGMENT_SHADER);return!!C&&(g.shaderSource(C,x),g.compileShader(C),!!g.getShaderParameter(C,g.COMPILE_STATUS))}queryWebGL(g){const f=g.getContext("webgl");f&&(this.maxTextureSize=f.getParameter(f.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find((g=>this.testPrecision(f,g))),f.getExtension("WEBGL_lose_context").loseContext(),h("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(g){return!!this.maxTextureSize&&this.maxTextureSize>=g}}const f={};let x;const p=g=>{x=g},m=()=>x||(x={document:document,window:window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new d,dispose(){},copyPasteData:f}),v=()=>m().document,y=()=>m().window,_=()=>{var f;return Math.max(null!==(f=g.devicePixelRatio)&&void 0!==f?f:y().devicePixelRatio,1)};const C=new class{constructor(){s(this,"charWidthsCache",{}),s(this,"boundsOfCurveCache",{})}getFontCache(g){let{fontFamily:f,fontStyle:x,fontWeight:C}=g;f=f.toLowerCase(),this.charWidthsCache[f]||(this.charWidthsCache[f]={});const w=this.charWidthsCache[f],S="".concat(x.toLowerCase(),"_").concat((C+"").toLowerCase());return w[S]||(w[S]={}),w[S]}clearFontCache(g){(g=(g||"").toLowerCase())?this.charWidthsCache[g]&&delete this.charWidthsCache[g]:this.charWidthsCache={}}limitDimsByArea(f){const{perfLimitSizeTotal:x}=g,C=Math.sqrt(x*f);return[Math.floor(C),Math.floor(x/C)]}};const w="6.0.0-rc2";function b(){}const S=Math.PI/2,T=2*Math.PI,O=Math.PI/180,k=Object.freeze([1,0,0,1,0,0]),D=16,M=.4477152502,A="center",P="left",E="top",j="bottom",F="right",L="none",R=/\r?\n/,B="json",I="svg";const X=new class{constructor(){this[B]=new Map,this[I]=new Map}getClass(g){const f=this[B].get(g);if(!f)throw new c("No class registered for ".concat(g));return f}setClass(g,f){f?this[B].set(f,g):(this[B].set(g.type,g),this[B].set(g.type.toLowerCase(),g))}getSVGClass(g){return this[I].get(g)}setSVGClass(g,f){this[I].set(null!=f?f:g.type.toLowerCase(),g)}};const N=new class extends Array{remove(g){const f=this.indexOf(g);f>-1&&this.splice(f,1)}cancelAll(){const g=this.splice(0);return g.forEach((g=>g.abort())),g}cancelByCanvas(g){if(!g)return[];const f=this.filter((f=>{var x;return f.target===g||"object"==typeof f.target&&(null===(x=f.target)||void 0===x?void 0:x.canvas)===g}));return f.forEach((g=>g.abort())),f}cancelByTarget(g){if(!g)return[];const f=this.filter((f=>f.target===g));return f.forEach((g=>g.abort())),f}};class Y{constructor(){s(this,"__eventListeners",{})}on(g,f){if(this.__eventListeners||(this.__eventListeners={}),"object"==typeof g)return Object.entries(g).forEach((g=>{let[f,x]=g;this.on(f,x)})),()=>this.off(g);if(f){const x=g;return this.__eventListeners[x]||(this.__eventListeners[x]=[]),this.__eventListeners[x].push(f),()=>this.off(x,f)}return()=>!1}once(g,f){if("object"==typeof g){const f=[];return Object.entries(g).forEach((g=>{let[x,C]=g;f.push(this.once(x,C))})),()=>f.forEach((g=>g()))}if(f){const x=this.on(g,(function(){for(var g=arguments.length,C=new Array(g),w=0;w<g;w++)C[w]=arguments[w];f.call(this,...C),x()}));return x}return()=>!1}_removeEventListener(g,f){if(this.__eventListeners[g])if(f){const x=this.__eventListeners[g],C=x.indexOf(f);C>-1&&x.splice(C,1)}else this.__eventListeners[g]=[]}off(g,f){if(this.__eventListeners)if(void 0===g)for(const g in this.__eventListeners)this._removeEventListener(g);else"object"==typeof g?Object.entries(g).forEach((g=>{let[f,x]=g;this._removeEventListener(f,x)})):this._removeEventListener(g,f)}fire(g,f){var x;if(!this.__eventListeners)return;const C=null===(x=this.__eventListeners[g])||void 0===x?void 0:x.concat();if(C)for(let g=0;g<C.length;g++)C[g].call(this,f||{})}}const W=(g,f)=>Math.floor(Math.random()*(f-g+1))+g,V=(g,f)=>isNaN(g)&&"number"==typeof f?f:g,z=(g,f)=>{const x=g.indexOf(f);return-1!==x&&g.splice(x,1),g},H=g=>{if(0===g)return 1;switch(Math.abs(g)/S){case 1:case 3:return 0;case 2:return-1}return Math.cos(g)},G=g=>{if(0===g)return 0;const f=g/S,x=Math.sign(g);switch(f){case 1:return x;case 2:return 0;case 3:return-x}return Math.sin(g)};class U{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;"object"==typeof g?(this.x=g.x,this.y=g.y):(this.x=g,this.y=f)}add(g){return new U(this.x+g.x,this.y+g.y)}addEquals(g){return this.x+=g.x,this.y+=g.y,this}scalarAdd(g){return new U(this.x+g,this.y+g)}scalarAddEquals(g){return this.x+=g,this.y+=g,this}subtract(g){return new U(this.x-g.x,this.y-g.y)}subtractEquals(g){return this.x-=g.x,this.y-=g.y,this}scalarSubtract(g){return new U(this.x-g,this.y-g)}scalarSubtractEquals(g){return this.x-=g,this.y-=g,this}multiply(g){return new U(this.x*g.x,this.y*g.y)}scalarMultiply(g){return new U(this.x*g,this.y*g)}scalarMultiplyEquals(g){return this.x*=g,this.y*=g,this}divide(g){return new U(this.x/g.x,this.y/g.y)}scalarDivide(g){return new U(this.x/g,this.y/g)}scalarDivideEquals(g){return this.x/=g,this.y/=g,this}eq(g){return this.x===g.x&&this.y===g.y}lt(g){return this.x<g.x&&this.y<g.y}lte(g){return this.x<=g.x&&this.y<=g.y}gt(g){return this.x>g.x&&this.y>g.y}gte(g){return this.x>=g.x&&this.y>=g.y}lerp(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return f=Math.max(Math.min(1,f),0),new U(this.x+(g.x-this.x)*f,this.y+(g.y-this.y)*f)}distanceFrom(g){const f=this.x-g.x,x=this.y-g.y;return Math.sqrt(f*f+x*x)}midPointFrom(g){return this.lerp(g)}min(g){return new U(Math.min(this.x,g.x),Math.min(this.y,g.y))}max(g){return new U(Math.max(this.x,g.x),Math.max(this.y,g.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(g,f){return this.x=g,this.y=f,this}setX(g){return this.x=g,this}setY(g){return this.y=g,this}setFromPoint(g){return this.x=g.x,this.y=g.y,this}swap(g){const f=this.x,x=this.y;this.x=g.x,this.y=g.y,g.x=f,g.y=x}clone(){return new U(this.x,this.y)}rotate(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$;const x=G(g),C=H(g),w=this.subtract(f);return new U(w.x*C-w.y*x,w.x*x+w.y*C).add(f)}transform(g){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new U(g[0]*this.x+g[2]*this.y+(f?0:g[4]),g[1]*this.x+g[3]*this.y+(f?0:g[5]))}}const $=new U(0,0),q=g=>!!g&&Array.isArray(g._objects);function K(g){class e extends g{constructor(){super(...arguments),s(this,"_objects",[])}_onObjectAdded(g){}_onObjectRemoved(g){}_onStackOrderChanged(g){}add(){for(var g=arguments.length,f=new Array(g),x=0;x<g;x++)f[x]=arguments[x];const C=this._objects.push(...f);return f.forEach((g=>this._onObjectAdded(g))),C}insertAt(g){for(var f=arguments.length,x=new Array(f>1?f-1:0),C=1;C<f;C++)x[C-1]=arguments[C];return this._objects.splice(g,0,...x),x.forEach((g=>this._onObjectAdded(g))),this._objects.length}remove(){const g=this._objects,f=[];for(var x=arguments.length,C=new Array(x),w=0;w<x;w++)C[w]=arguments[w];return C.forEach((x=>{const C=g.indexOf(x);-1!==C&&(g.splice(C,1),f.push(x),this._onObjectRemoved(x))})),f}forEachObject(g){this.getObjects().forEach(((f,x,C)=>g(f,x,C)))}getObjects(){for(var g=arguments.length,f=new Array(g),x=0;x<g;x++)f[x]=arguments[x];return 0===f.length?[...this._objects]:this._objects.filter((g=>g.isType(...f)))}item(g){return this._objects[g]}isEmpty(){return 0===this._objects.length}size(){return this._objects.length}contains(g,f){return!!this._objects.includes(g)||!!f&&this._objects.some((f=>f instanceof e&&f.contains(g,!0)))}complexity(){return this._objects.reduce(((g,f)=>g+(f.complexity?f.complexity():0)),0)}sendObjectToBack(g){return!(!g||g===this._objects[0])&&(z(this._objects,g),this._objects.unshift(g),this._onStackOrderChanged(g),!0)}bringObjectToFront(g){return!(!g||g===this._objects[this._objects.length-1])&&(z(this._objects,g),this._objects.push(g),this._onStackOrderChanged(g),!0)}sendObjectBackwards(g,f){if(!g)return!1;const x=this._objects.indexOf(g);if(0!==x){const C=this.findNewLowerIndex(g,x,f);return z(this._objects,g),this._objects.splice(C,0,g),this._onStackOrderChanged(g),!0}return!1}bringObjectForward(g,f){if(!g)return!1;const x=this._objects.indexOf(g);if(x!==this._objects.length-1){const C=this.findNewUpperIndex(g,x,f);return z(this._objects,g),this._objects.splice(C,0,g),this._onStackOrderChanged(g),!0}return!1}moveObjectTo(g,f){return g!==this._objects[f]&&(z(this._objects,g),this._objects.splice(f,0,g),this._onStackOrderChanged(g),!0)}findNewLowerIndex(g,f,x){let C;if(x){C=f;for(let x=f-1;x>=0;--x)if(g.isOverlapping(this._objects[x])){C=x;break}}else C=f-1;return C}findNewUpperIndex(g,f,x){let C;if(x){C=f;for(let x=f+1;x<this._objects.length;++x)if(g.isOverlapping(this._objects[x])){C=x;break}}else C=f+1;return C}collectObjects(g){let{left:f,top:x,width:C,height:w}=g,{includeIntersecting:S=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const T=[],O=new U(f,x),k=O.add(new U(C,w));for(let g=this._objects.length-1;g>=0;g--){const f=this._objects[g];f.selectable&&f.visible&&(S&&f.intersectsWithRect(O,k)||f.isContainedWithinRect(O,k)||S&&f.containsPoint(O)||S&&f.containsPoint(k))&&T.push(f)}return T}}return e}class J extends Y{_setOptions(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const f in g)this.set(f,g[f])}_setObject(g){for(const f in g)this._set(f,g[f])}set(g,f){return"object"==typeof g?this._setObject(g):this._set(g,f),this}_set(g,f){this[g]=f}toggle(g){const f=this.get(g);return"boolean"==typeof f&&this.set(g,!f),this}get(g){return this[g]}}function Z(g){return y().requestAnimationFrame(g)}function Q(g){return y().cancelAnimationFrame(g)}let Ot=0;const tt=()=>Ot++,et=()=>{const g=v().createElement("canvas");if(!g||void 0===g.getContext)throw new c("Failed to create `canvas` element");return g},st=()=>v().createElement("img"),it=(g,f,x)=>g.toDataURL("image/".concat(f),x),rt=g=>g*O,nt=g=>g/O,ot=g=>g.every(((g,f)=>g===k[f])),at=(g,f,x)=>new U(g).transform(f,x),ht=g=>{const f=1/(g[0]*g[3]-g[1]*g[2]),x=[f*g[3],-f*g[1],-f*g[2],f*g[0],0,0],{x:C,y:w}=new U(g[4],g[5]).transform(x,!0);return x[4]=-C,x[5]=-w,x},ct=(g,f,x)=>[g[0]*f[0]+g[2]*f[1],g[1]*f[0]+g[3]*f[1],g[0]*f[2]+g[2]*f[3],g[1]*f[2]+g[3]*f[3],x?0:g[0]*f[4]+g[2]*f[5]+g[4],x?0:g[1]*f[4]+g[3]*f[5]+g[5]],lt=(g,f)=>g.reduceRight(((g,x)=>x&&g?ct(x,g,f):x||g),void 0)||k.concat(),ut=g=>{let[f,x]=g;return Math.atan2(x,f)},dt=g=>{const f=ut(g),x=Math.pow(g[0],2)+Math.pow(g[1],2),C=Math.sqrt(x),w=(g[0]*g[3]-g[2]*g[1])/C,S=Math.atan2(g[0]*g[2]+g[1]*g[3],x);return{angle:nt(f),scaleX:C,scaleY:w,skewX:nt(S),skewY:0,translateX:g[4]||0,translateY:g[5]||0}},gt=function(g){return[1,0,0,1,g,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0]};function ft(){let{angle:g=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{x:f=0,y:x=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const C=rt(g),w=H(C),S=G(C);return[w,S,-S,w,f?f-(w*f-S*x):0,x?x-(S*f+w*x):0]}const pt=function(g){return[g,0,0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:g,0,0]},mt=g=>Math.tan(rt(g)),vt=g=>[1,0,mt(g),1,0,0],yt=g=>[1,mt(g),0,1,0,0],_t=g=>{let{scaleX:f=1,scaleY:x=1,flipX:C=!1,flipY:w=!1,skewX:S=0,skewY:T=0}=g,O=pt(C?-f:f,w?-x:x);return S&&(O=ct(O,vt(S),!0)),T&&(O=ct(O,yt(T),!0)),O},xt=g=>{const{translateX:f=0,translateY:x=0,angle:C=0}=g;let w=gt(f,x);C&&(w=ct(w,ft({angle:C})));const S=_t(g);return ot(S)||(w=ct(w,S)),w},Ct=function(g){let{signal:f,crossOrigin:x=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(C,w){if(f&&f.aborted)return w(new l("loadImage"));const S=st();let T;f&&(T=function(g){S.src="",w(g)},f.addEventListener("abort",T,{once:!0}));const a=function(){S.onload=S.onerror=null,T&&(null==f||f.removeEventListener("abort",T)),C(S)};g?(S.onload=a,S.onerror=function(){T&&(null==f||f.removeEventListener("abort",T)),w(new c("Error loading ".concat(S.src)))},x&&(S.crossOrigin=x),S.src=g):a()}))},bt=function(g){let{signal:f,reviver:x=b}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((C,w)=>{const S=[];f&&f.addEventListener("abort",w,{once:!0}),Promise.all(g.map((g=>X.getClass(g.type).fromObject(g,{signal:f}).then((f=>(x(g,f),S.push(f),f)))))).then(C).catch((g=>{S.forEach((g=>{g.dispose&&g.dispose()})),w(g)})).finally((()=>{f&&f.removeEventListener("abort",w)}))}))},wt=function(g){let{signal:f}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((x,C)=>{const w=[];f&&f.addEventListener("abort",C,{once:!0});const S=Object.values(g).map((g=>g?g.type?bt([g],{signal:f}).then((g=>{let[f]=g;return w.push(f),f})):g.source?X.getClass("pattern").fromObject(g,{signal:f}).then((g=>(w.push(g),g))):g:g)),T=Object.keys(g);Promise.all(S).then((g=>g.reduce(((g,f,x)=>(g[T[x]]=f,g)),{}))).then(x).catch((g=>{w.forEach((g=>{g.dispose&&g.dispose()})),C(g)})).finally((()=>{f&&f.removeEventListener("abort",C)}))}))},St=function(g){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).reduce(((f,x)=>(x in g&&(f[x]=g[x]),f)),{})},Tt=(g,f)=>Object.keys(g).reduce(((x,C)=>(f(g[C],C,g)&&(x[C]=g[C]),x)),{}),Zt={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},kt=(g,f,x)=>(x<0&&(x+=1),x>1&&(x-=1),x<1/6?g+6*(f-g)*x:x<.5?f:x<2/3?g+(f-g)*(2/3-x)*6:g),Dt=(g,f,x,C)=>{g/=255,f/=255,x/=255;const w=Math.max(g,f,x),S=Math.min(g,f,x);let T,O;const k=(w+S)/2;if(w===S)T=O=0;else{const C=w-S;switch(O=k>.5?C/(2-w-S):C/(w+S),w){case g:T=(f-x)/C+(f<x?6:0);break;case f:T=(x-g)/C+2;break;case x:T=(g-f)/C+4}T/=6}return[Math.round(360*T),Math.round(100*O),Math.round(100*k),C]},Mt=function(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1";return parseFloat(g)/(g.endsWith("%")?100:1)},Pt=g=>Math.min(Math.round(g),255).toString(16).toUpperCase().padStart(2,"0"),Et=g=>{let[f,x,C,w=1]=g;const S=Math.round(.3*f+.59*x+.11*C);return[S,S,S,w]};class At{constructor(g){if(g)if(g instanceof At)this.setSource([...g._source]);else if(Array.isArray(g)){const[f,x,C,w=1]=g;this.setSource([f,x,C,w])}else this.setSource(this._tryParsingColor(g));else this.setSource([0,0,0,1])}_tryParsingColor(g){return g in Zt&&(g=Zt[g]),"transparent"===g?[255,255,255,0]:At.sourceFromHex(g)||At.sourceFromRgb(g)||At.sourceFromHsl(g)||[0,0,0,1]}getSource(){return this._source}setSource(g){this._source=g}toRgb(){const[g,f,x]=this.getSource();return"rgb(".concat(g,",").concat(f,",").concat(x,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[g,f,x]=Dt(...this.getSource());return"hsl(".concat(g,",").concat(f,"%,").concat(x,"%)")}toHsla(){const[g,f,x,C]=Dt(...this.getSource());return"hsla(".concat(g,",").concat(f,"%,").concat(x,"%,").concat(C,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[g,f,x,C]=this.getSource();return"".concat(Pt(g)).concat(Pt(f)).concat(Pt(x)).concat(Pt(Math.round(255*C)))}getAlpha(){return this.getSource()[3]}setAlpha(g){return this._source[3]=g,this}toGrayscale(){return this.setSource(Et(this.getSource())),this}toBlackWhite(g){const[f,,,x]=Et(this.getSource()),C=f<(g||127)?0:255;return this.setSource([C,C,C,x]),this}overlayWith(g){g instanceof At||(g=new At(g));const f=this.getSource(),x=g.getSource(),[C,w,S]=f.map(((g,f)=>Math.round(.5*g+.5*x[f])));return this.setSource([C,w,S,f[3]]),this}static fromRgb(g){return At.fromRgba(g)}static fromRgba(g){return new At(At.sourceFromRgb(g))}static sourceFromRgb(g){const f=g.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(f){const[g,x,C]=f.slice(1,4).map((g=>{const f=parseFloat(g);return g.endsWith("%")?Math.round(2.55*f):f}));return[g,x,C,Mt(f[4])]}}static fromHsl(g){return At.fromHsla(g)}static fromHsla(g){return new At(At.sourceFromHsl(g))}static sourceFromHsl(g){const f=g.match(/^hsla?\(\s*([+-]?\d{1,3})\s*[\s|,]\s*(\d{1,3}%)\s*[\s|,]\s*(\d{1,3}%)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!f)return;const x=(parseFloat(f[1])%360+360)%360/360,C=parseFloat(f[2])/100,w=parseFloat(f[3])/100;let S,T,O;if(0===C)S=T=O=w;else{const g=w<=.5?w*(C+1):w+C-w*C,f=2*w-g;S=kt(f,g,x+1/3),T=kt(f,g,x),O=kt(f,g,x-1/3)}return[Math.round(255*S),Math.round(255*T),Math.round(255*O),Mt(f[4])]}static fromHex(g){return new At(At.sourceFromHex(g))}static sourceFromHex(g){if(g.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const f=g.slice(g.indexOf("#")+1);let x;x=f.length<=4?f.split("").map((g=>g+g)):f.match(/.{2}/g);const[C,w,S,T=255]=x.map((g=>parseInt(g,16)));return[C,w,S,T/255]}}}const jt=(g,f)=>parseFloat(Number(g).toFixed(f)),Ft=function(f){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D;const C=/\D{0,2}$/.exec(f),w=parseFloat(f),S=g.DPI;switch(null==C?void 0:C[0]){case"mm":return w*S/25.4;case"cm":return w*S/2.54;case"in":return w*S;case"pt":return w*S/72;case"pc":return w*S/72*12;case"em":return w*x;default:return w}},Lt=g=>{const[f,x]=g.trim().split(" "),[C,w]=(S=f)&&S!==L?[S.slice(1,4),S.slice(5,8)]:S===L?[S,S]:["Mid","Mid"];var S;return{meetOrSlice:x||"meet",alignX:C,alignY:w}},Rt=f=>"matrix("+f.map((f=>jt(f,g.NUM_FRACTION_DIGITS))).join(" ")+")",Bt=function(g,f){let x,C,w=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(f)if(f.toLive)x="url(#SVGID_".concat(f.id,")");else{const g=new At(f),w=g.getAlpha();x=g.toRgb(),1!==w&&(C=w.toString())}else x="none";return w?"".concat(g,": ").concat(x,"; ").concat(C?"".concat(g,"-opacity: ").concat(C,"; "):""):"".concat(g,'="').concat(x,'" ').concat(C?"".concat(g,'-opacity="').concat(C,'" '):"")},It=g=>!!g&&void 0!==g.toLive,Xt=g=>!!g&&"function"==typeof g.toObject,Yt=g=>!!g&&void 0!==g.offsetX&&"source"in g,Wt=g=>!!g&&"function"==typeof g._renderText,Vt=g=>!!g&&"multiSelectionStacking"in g;function zt(g){const f=g&&Ht(g);let x=0,C=0;if(!g||!f)return{left:x,top:C};const w=f.documentElement,S=f.body||{scrollLeft:0,scrollTop:0};for(;g&&(g.parentNode||g.host)&&((g=g.parentNode||g.host)===f?(x=S.scrollLeft||w.scrollLeft||0,C=S.scrollTop||w.scrollTop||0):(x+=g.scrollLeft||0,C+=g.scrollTop||0),1!==g.nodeType||"fixed"!==g.style.position););return{left:x,top:C}}const Ht=g=>g.ownerDocument||null,Gt=g=>{var f;return(null===(f=g.ownerDocument)||void 0===f?void 0:f.defaultView)||null};function Ut(g,f){const x=g.style;x&&("string"==typeof f?g.style.cssText+=";"+f:Object.entries(f).forEach((g=>{let[f,C]=g;return x.setProperty(f,C)})))}const Nt=function(g,f,x){let{width:C,height:w}=x,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;g.width=C,g.height=w,S>1&&(g.setAttribute("width",(C*S).toString()),g.setAttribute("height",(w*S).toString()),f.scale(S,S))};const qt=(g,f)=>{let{width:x,height:C}=f;x&&(g.style.width="number"==typeof x?"".concat(x,"px"):x),C&&(g.style.height="number"==typeof C?"".concat(C,"px"):C)};function Kt(g){return void 0!==g.onselectstart&&(g.onselectstart=()=>!1),g.style.userSelect=L,g}class Jt{constructor(g){s(this,"_originalCanvasStyle",void 0),s(this,"lower",void 0);const f=this.createLowerCanvas(g);this.lower={el:f,ctx:f.getContext("2d")}}createLowerCanvas(g){const f=(x=g)&&void 0!==x.getContext?g:g&&v().getElementById(g)||et();var x;if(f.hasAttribute("data-fabric"))throw new c("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=f.style.cssText,f.setAttribute("data-fabric","main"),f.classList.add("lower-canvas"),f}cleanupDOM(g){let{width:f,height:x}=g;const{el:C}=this.lower;C.classList.remove("lower-canvas"),C.removeAttribute("data-fabric"),C.setAttribute("width","".concat(f)),C.setAttribute("height","".concat(x)),C.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(g,f){const{el:x,ctx:C}=this.lower;Nt(x,C,g,f)}setCSSDimensions(g){qt(this.lower.el,g)}calcOffset(){return function(g){var f;let x={left:0,top:0};const C=g&&Ht(g),w={left:0,top:0},S={borderLeftWidth:P,borderTopWidth:E,paddingLeft:P,paddingTop:E};if(!C)return w;const T=(null===(f=Gt(g))||void 0===f?void 0:f.getComputedStyle(g,null))||{};for(const g in S)w[S[g]]+=parseInt(T[g],10)||0;const O=C.documentElement;void 0!==g.getBoundingClientRect&&(x=g.getBoundingClientRect());const k=zt(g);return{left:x.left+k.left-(O.clientLeft||0)+w.left,top:x.top+k.top-(O.clientTop||0)+w.top}}(this.lower.el)}dispose(){m().dispose(this.lower.el),delete this.lower}}const $t={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...k]};class Qt extends(K(J)){get lowerCanvasEl(){var g;return null===(g=this.elements.lower)||void 0===g?void 0:g.el}get contextContainer(){var g;return null===(g=this.elements.lower)||void 0===g?void 0:g.ctx}static getDefaults(){return Qt.ownDefaults}constructor(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(f),this.initElements(g),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(g){this.elements=new Jt(g)}add(){const g=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),g}insertAt(g){for(var f=arguments.length,x=new Array(f>1?f-1:0),C=1;C<f;C++)x[C-1]=arguments[C];const w=super.insertAt(g,...x);return x.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),w}remove(){const g=super.remove(...arguments);return g.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),g}_onObjectAdded(g){g.canvas&&g.canvas!==this&&(h("warn","Canvas is trying to add an object that belongs to a different canvas.\nResulting to default behavior: removing object from previous canvas and adding to new canvas"),g.canvas.remove(g)),g._set("canvas",this),g.setCoords(),this.fire("object:added",{target:g}),g.fire("added",{target:this})}_onObjectRemoved(g){g._set("canvas",void 0),this.fire("object:removed",{target:g}),g.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?_():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(g,f){return this.setDimensions({width:g},f)}setHeight(g,f){return this.setDimensions({height:g},f)}_setDimensionsImpl(g){let{cssOnly:f=!1,backstoreOnly:x=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!f){const f=e({width:this.width,height:this.height},g);this.elements.setDimensions(f,this.getRetinaScaling()),this.hasLostContext=!0,this.width=f.width,this.height=f.height}x||this.elements.setCSSDimensions(g),this.calcOffset()}setDimensions(g,f){this._setDimensionsImpl(g,f),f&&f.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(g){const f=this.backgroundImage,x=this.overlayImage,C=this._objects.length;this.viewportTransform=g;for(let g=0;g<C;g++){const f=this._objects[g];f.group||f.setCoords()}f&&f.setCoords(),x&&x.setCoords(),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(g,f){const x=g,C=[...this.viewportTransform],w=at(g,ht(C));C[0]=f,C[3]=f;const S=at(w,C);C[4]+=x.x-S.x,C[5]+=x.y-S.y,this.setViewportTransform(C)}setZoom(g){this.zoomToPoint(new U(0,0),g)}absolutePan(g){const f=[...this.viewportTransform];return f[4]=-g.x,f[5]=-g.y,this.setViewportTransform(f)}relativePan(g){return this.absolutePan(new U(-g.x-this.viewportTransform[4],-g.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(g){g.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=Z((()=>this.renderAndReset())))}calcViewportBoundaries(){const g=this.width,f=this.height,x=ht(this.viewportTransform),C=at({x:0,y:0},x),w=at({x:g,y:f},x),S=C.min(w),T=C.max(w);return this.vptCoords={tl:S,tr:new U(T.x,S.y),bl:new U(S.x,T.y),br:T}}cancelRequestedRender(){this.nextRenderHandle&&(Q(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(g){}renderCanvas(g,f){if(this.destroyed)return;const x=this.viewportTransform,C=this.clipPath;this.calcViewportBoundaries(),this.clearContext(g),g.imageSmoothingEnabled=this.imageSmoothingEnabled,g.patternQuality="best",this.fire("before:render",{ctx:g}),this._renderBackground(g),g.save(),g.transform(x[0],x[1],x[2],x[3],x[4],x[5]),this._renderObjects(g,f),g.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(g),C&&(C._set("canvas",this),C.shouldCache(),C._transformDone=!0,C.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(g,C)),this._renderOverlay(g),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(g),this.fire("after:render",{ctx:g}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(g,f){const x=this.viewportTransform;g.save(),g.transform(...x),g.globalCompositeOperation="destination-in",f.transform(g),g.scale(1/f.zoomX,1/f.zoomY),g.drawImage(f._cacheCanvas,-f.cacheTranslationX,-f.cacheTranslationY),g.restore()}_renderObjects(g,f){for(let x=0,C=f.length;x<C;++x)f[x]&&f[x].render(g)}_renderBackgroundOrOverlay(g,f){const x=this["".concat(f,"Color")],C=this["".concat(f,"Image")],w=this.viewportTransform,S=this["".concat(f,"Vpt")];if(!x&&!C)return;const T=It(x);if(x){if(g.save(),g.beginPath(),g.moveTo(0,0),g.lineTo(this.width,0),g.lineTo(this.width,this.height),g.lineTo(0,this.height),g.closePath(),g.fillStyle=T?x.toLive(g):x,S&&g.transform(...w),T){g.transform(1,0,0,1,x.offsetX||0,x.offsetY||0);const f=x.gradientTransform||x.patternTransform;f&&g.transform(...f)}g.fill(),g.restore()}if(C){g.save();const{skipOffscreen:f}=this;this.skipOffscreen=S,S&&g.transform(...w),C.render(g),this.skipOffscreen=f,g.restore()}}_renderBackground(g){this._renderBackgroundOrOverlay(g,"background")}_renderOverlay(g){this._renderBackgroundOrOverlay(g,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new U(this.width/2,this.height/2)}centerObjectH(g){return this._centerObject(g,new U(this.getCenterPoint().x,g.getCenterPoint().y))}centerObjectV(g){return this._centerObject(g,new U(g.getCenterPoint().x,this.getCenterPoint().y))}centerObject(g){return this._centerObject(g,this.getCenterPoint())}viewportCenterObject(g){return this._centerObject(g,this.getVpCenter())}viewportCenterObjectH(g){return this._centerObject(g,new U(this.getVpCenter().x,g.getCenterPoint().y))}viewportCenterObjectV(g){return this._centerObject(g,new U(g.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return at(this.getCenterPoint(),ht(this.viewportTransform))}_centerObject(g,f){g.setXY(f,A,A),g.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(g){return this.toDatalessObject(g)}toObject(g){return this._toObjectMethod("toObject",g)}toJSON(){return this.toObject()}toDatalessObject(g){return this._toObjectMethod("toDatalessObject",g)}_toObjectMethod(g,f){const x=this.clipPath,C=x&&!x.excludeFromExport?this._toObject(x,g,f):null;return e(e(e({version:w},St(this,f)),{},{objects:this._objects.filter((g=>!g.excludeFromExport)).map((x=>this._toObject(x,g,f)))},this.__serializeBgOverlay(g,f)),C?{clipPath:C}:null)}_toObject(g,f,x){let C;this.includeDefaultValues||(C=g.includeDefaultValues,g.includeDefaultValues=!1);const w=g[f](x);return this.includeDefaultValues||(g.includeDefaultValues=!!C),w}__serializeBgOverlay(g,f){const x={},C=this.backgroundImage,w=this.overlayImage,S=this.backgroundColor,T=this.overlayColor;return It(S)?S.excludeFromExport||(x.background=S.toObject(f)):S&&(x.background=S),It(T)?T.excludeFromExport||(x.overlay=T.toObject(f)):T&&(x.overlay=T),C&&!C.excludeFromExport&&(x.backgroundImage=this._toObject(C,g,f)),w&&!w.excludeFromExport&&(x.overlayImage=this._toObject(w,g,f)),x}toSVG(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},f=arguments.length>1?arguments[1]:void 0;g.reviver=f;const x=[];return this._setSVGPreamble(x,g),this._setSVGHeader(x,g),this.clipPath&&x.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,')" >\n')),this._setSVGBgOverlayColor(x,"background"),this._setSVGBgOverlayImage(x,"backgroundImage",f),this._setSVGObjects(x,f),this.clipPath&&x.push("</g>\n"),this._setSVGBgOverlayColor(x,"overlay"),this._setSVGBgOverlayImage(x,"overlayImage",f),x.push("</svg>"),x.join("")}_setSVGPreamble(g,f){f.suppressPreamble||g.push('<?xml version="1.0" encoding="',f.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')}_setSVGHeader(f,x){const C=x.width||"".concat(this.width),S=x.height||"".concat(this.height),T=g.NUM_FRACTION_DIGITS,O=x.viewBox;let k;if(O)k='viewBox="'.concat(O.x," ").concat(O.y," ").concat(O.width," ").concat(O.height,'" ');else if(this.svgViewportTransformation){const g=this.viewportTransform;k='viewBox="'.concat(jt(-g[4]/g[0],T)," ").concat(jt(-g[5]/g[3],T)," ").concat(jt(this.width/g[0],T)," ").concat(jt(this.height/g[3],T),'" ')}else k='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');f.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',C,'" ','height="',S,'" ',k,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",w,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(x),"</defs>\n")}createSVGClipPathMarkup(g){const f=this.clipPath;return f?(f.clipPathId="CLIPPATH_".concat(tt()),'<clipPath id="'.concat(f.clipPathId,'" >\n').concat(f.toClipPathSVG(g.reviver),"</clipPath>\n")):""}createSVGRefElementsMarkup(){return["background","overlay"].map((g=>{const f=this["".concat(g,"Color")];if(It(f)){const x=this["".concat(g,"Vpt")],C=this.viewportTransform,w={isType:()=>!1,width:this.width/(x?C[0]:1),height:this.height/(x?C[3]:1)};return f.toSVG(w,{additionalTransform:x?Rt(C):""})}})).join("")}createSVGFontFacesMarkup(){const f=[],x={},C=g.fontPaths;this._objects.forEach((function e(g){f.push(g),q(g)&&g._objects.forEach(e)})),f.forEach((g=>{if(!Wt(g))return;const{styles:f,fontFamily:w}=g;!x[w]&&C[w]&&(x[w]=!0,f&&Object.values(f).forEach((g=>{Object.values(g).forEach((g=>{let{fontFamily:f=""}=g;!x[f]&&C[f]&&(x[f]=!0)}))})))}));const w=Object.keys(x).map((g=>"\t\t@font-face {\n\t\t\tfont-family: '".concat(g,"';\n\t\t\tsrc: url('").concat(C[g],"');\n\t\t}\n"))).join("");return w?'\t<style type="text/css"><![CDATA[\n'.concat(w,"]]></style>\n"):""}_setSVGObjects(g,f){this.forEachObject((x=>{x.excludeFromExport||this._setSVGObject(g,x,f)}))}_setSVGObject(g,f,x){g.push(f.toSVG(x))}_setSVGBgOverlayImage(g,f,x){const C=this[f];C&&!C.excludeFromExport&&C.toSVG&&g.push(C.toSVG(x))}_setSVGBgOverlayColor(g,f){const x=this["".concat(f,"Color")];if(x)if(It(x)){const C=x.repeat||"",w=this.width,S=this.height,T=this["".concat(f,"Vpt")]?Rt(ht(this.viewportTransform)):"";g.push('<rect transform="'.concat(T," translate(").concat(w/2,",").concat(S/2,')" x="').concat(x.offsetX-w/2,'" y="').concat(x.offsetY-S/2,'" width="').concat("repeat-y"!==C&&"no-repeat"!==C||!Yt(x)?w:x.source.width,'" height="').concat("repeat-x"!==C&&"no-repeat"!==C||!Yt(x)?S:x.source.height,'" fill="url(#SVGID_').concat(x.id,')"></rect>\n'))}else g.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',x,'"',"></rect>\n")}loadFromJSON(g,f){let{signal:x}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!g)return Promise.reject(new c("`json` is undefined"));const C="string"==typeof g?JSON.parse(g):g,{objects:w=[],backgroundImage:S,background:T,overlayImage:O,overlay:k,clipPath:D}=C,M=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([bt(w,{reviver:f,signal:x}),wt({backgroundImage:S,backgroundColor:T,overlayImage:O,overlayColor:k,clipPath:D},{signal:x})]).then((g=>{let[f,x]=g;return this.clear(),this.add(...f),this.set(C),this.set(x),this.renderOnAddRemove=M,this}))}clone(g){const f=this.toObject(g);return this.cloneWithoutData().loadFromJSON(f)}cloneWithoutData(){const g=et();return g.width=this.width,g.height=this.height,new this.constructor(g)}toDataURL(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{format:f="png",quality:x=1,multiplier:C=1,enableRetinaScaling:w=!1}=g,S=C*(w?this.getRetinaScaling():1);return it(this.toCanvasElement(S,g),f,x)}toCanvasElement(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,{width:f,height:x,left:C,top:w,filter:S}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const T=(f||this.width)*g,O=(x||this.height)*g,k=this.getZoom(),D=this.width,M=this.height,A=this.skipControlsDrawing,P=k*g,E=this.viewportTransform,j=[P,0,0,P,(E[4]-(C||0))*g,(E[5]-(w||0))*g],F=this.enableRetinaScaling,L=et(),R=S?this._objects.filter((g=>S(g))):this._objects;return L.width=T,L.height=O,this.enableRetinaScaling=!1,this.viewportTransform=j,this.width=T,this.height=O,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(L.getContext("2d"),R),this.viewportTransform=E,this.width=D,this.height=M,this.calcViewportBoundaries(),this.enableRetinaScaling=F,this.skipControlsDrawing=A,L}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),N.cancelByCanvas(this),this.disposed=!0,new Promise(((g,f)=>{const s=()=>{this.destroy(),g(!0)};s.kill=f,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?g(!1):this.nextRenderHandle?this.__cleanupTask=s:s()}))}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject((g=>g.dispose())),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}s(Qt,"ownDefaults",$t);const re=["touchstart","touchmove","touchend"];const te=g=>{const f=zt(g.target),x=function(g){const f=g.changedTouches;return f&&f[0]?f[0]:g}(g);return new U(x.clientX+f.left,x.clientY+f.top)},ee=g=>re.includes(g.type)||"touch"===g.pointerType,se=g=>{g.preventDefault(),g.stopPropagation()},ie=g=>{if(0===g.length)return{left:0,top:0,width:0,height:0};const{min:f,max:x}=g.reduce(((g,f)=>{let{min:x,max:C}=g;return{min:x.min(f),max:C.max(f)}}),{min:new U(g[0]),max:new U(g[0])}),C=x.subtract(f);return{left:f.x,top:f.y,width:C.x,height:C.y}},pe=["translateX","translateY","scaleX","scaleY"],ne=(g,f)=>oe(g,ct(f,g.calcOwnMatrix())),oe=(g,f)=>{const x=dt(f),{translateX:C,translateY:w,scaleX:S,scaleY:T}=x,O=i(x,pe),k=new U(C,w);g.flipX=!1,g.flipY=!1,Object.assign(g,O),g.set({scaleX:S,scaleY:T}),g.setPositionByOrigin(k,A,A)},ae=g=>{g.scaleX=1,g.scaleY=1,g.skewX=0,g.skewY=0,g.flipX=!1,g.flipY=!1,g.rotate(0)},he=g=>({scaleX:g.scaleX,scaleY:g.scaleY,skewX:g.skewX,skewY:g.skewY,angle:g.angle,left:g.left,flipX:g.flipX,flipY:g.flipY,top:g.top}),ce=(g,f,x)=>{const C=g/2,w=f/2,S=[new U(-C,-w),new U(C,-w),new U(-C,w),new U(C,w)].map((g=>g.transform(x))),T=ie(S);return new U(T.width,T.height)},le=function(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k;return ct(ht(arguments.length>1&&void 0!==arguments[1]?arguments[1]:k),g)},ue=function(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k;return g.transform(le(f,x))},de=function(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k;return g.transform(le(f,x),!0)},ge=(g,f,x)=>{const C=le(f,x);return oe(g,ct(C,g.calcOwnMatrix())),C},fe=(g,f)=>{var x;const{transform:{target:C}}=f;null===(x=C.canvas)||void 0===x||x.fire("object:".concat(g),e(e({},f),{},{target:C})),C.fire(g,f)},ve={left:-.5,top:-.5,center:0,bottom:.5,right:.5},me=g=>"string"==typeof g?ve[g]:g-.5,Ee="not-allowed";function ye(g){return g.originX===A&&g.originY===A}function _e(g){return.5-me(g)}const xe=(g,f)=>g[f],Ce=(g,f,x,C)=>({e:g,transform:f,pointer:new U(x,C)});function be(g,f){const x=g.getTotalAngle()+nt(Math.atan2(f.y,f.x))+360;return Math.round(x%360/45)}function we(g,f,x,C,w){var S;let{target:T,corner:O}=g;const k=T.controls[O],D=(null===(S=T.canvas)||void 0===S?void 0:S.getZoom())||1,M=T.padding/D,P=function(g,f,x,C){const w=g.getRelativeCenterPoint(),S=void 0!==x&&void 0!==C?g.translateToGivenOrigin(w,A,A,x,C):new U(g.left,g.top);return(g.angle?f.rotate(-rt(g.angle),w):f).subtract(S)}(T,new U(C,w),f,x);return P.x>=M&&(P.x-=M),P.x<=-M&&(P.x+=M),P.y>=M&&(P.y-=M),P.y<=M&&(P.y+=M),P.x-=k.offsetX,P.y-=k.offsetY,P}const Se=(g,f,x,C)=>{const{target:w,offsetX:S,offsetY:T}=f,O=x-S,k=C-T,D=!xe(w,"lockMovementX")&&w.left!==O,M=!xe(w,"lockMovementY")&&w.top!==k;return D&&w.set(P,O),M&&w.set(E,k),(D||M)&&fe("moving",Ce(g,f,x,C)),D||M};class Te{getSvgStyles(g){const f=this.fillRule?this.fillRule:"nonzero",x=this.strokeWidth?this.strokeWidth:"0",C=this.strokeDashArray?this.strokeDashArray.join(" "):L,w=this.strokeDashOffset?this.strokeDashOffset:"0",S=this.strokeLineCap?this.strokeLineCap:"butt",T=this.strokeLineJoin?this.strokeLineJoin:"miter",O=this.strokeMiterLimit?this.strokeMiterLimit:"4",k=void 0!==this.opacity?this.opacity:"1",D=this.visible?"":" visibility: hidden;",M=g?"":this.getSvgFilter(),A=Bt("fill",this.fill);return[Bt("stroke",this.stroke),"stroke-width: ",x,"; ","stroke-dasharray: ",C,"; ","stroke-linecap: ",S,"; ","stroke-dashoffset: ",w,"; ","stroke-linejoin: ",T,"; ","stroke-miterlimit: ",O,"; ",A,"fill-rule: ",f,"; ","opacity: ",k,";",M,D].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const x=g?this.calcTransformMatrix():this.calcOwnMatrix(),C='transform="'.concat(Rt(x));return"".concat(C).concat(f,'" ')}_toSVG(g){return[""]}toSVG(g){return this._createBaseSVGMarkup(this._toSVG(g),{reviver:g})}toClipPathSVG(g){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(g),{reviver:g})}_createBaseClipPathSVGMarkup(g){let{reviver:f,additionalTransform:x=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const C=[this.getSvgTransform(!0,x),this.getSvgCommons()].join(""),w=g.indexOf("COMMON_PARTS");return g[w]=C,f?f(g.join("")):g.join("")}_createBaseSVGMarkup(g){let{noStyle:f,reviver:x,withShadow:C,additionalTransform:w}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const S=f?"":'style="'.concat(this.getSvgStyles(),'" '),T=C?'style="'.concat(this.getSvgFilter(),'" '):"",O=this.clipPath,k=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",D=O&&O.absolutePositioned,M=this.stroke,A=this.fill,P=this.shadow,E=[],j=g.indexOf("COMMON_PARTS");let F;O&&(O.clipPathId="CLIPPATH_".concat(tt()),F='<clipPath id="'.concat(O.clipPathId,'" >\n').concat(O.toClipPathSVG(x),"</clipPath>\n")),D&&E.push("<g ",T,this.getSvgCommons()," >\n"),E.push("<g ",this.getSvgTransform(!1),D?"":T+this.getSvgCommons()," >\n");const L=[S,k,f?"":this.addPaintOrder()," ",w?'transform="'.concat(w,'" '):""].join("");return g[j]=L,It(A)&&E.push(A.toSVG(this)),It(M)&&E.push(M.toSVG(this)),P&&E.push(P.toSVG(this)),O&&E.push(F),E.push(g.join("")),E.push("</g>\n"),D&&E.push("</g>\n"),x?x(E.join("")):E.join("")}addPaintOrder(){return"fill"!==this.paintFirst?' paint-order="'.concat(this.paintFirst,'" '):""}}const Oe=(g,f,x,C)=>(g<Math.abs(f)?(g=f,C=x/4):C=0===f&&0===g?x/T*Math.asin(1):x/T*Math.asin(f/g),{a:g,c:f,p:x,s:C}),ke=(g,f,x,C,w)=>g*Math.pow(2,10*(C-=1))*Math.sin((C*w-f)*T/x),De=(g,f,x,C)=>-x*Math.cos(g/C*S)+x+f,Me=(g,f,x,C)=>(g/=C)<1/2.75?x*(7.5625*g*g)+f:g<2/2.75?x*(7.5625*(g-=1.5/2.75)*g+.75)+f:g<2.5/2.75?x*(7.5625*(g-=2.25/2.75)*g+.9375)+f:x*(7.5625*(g-=2.625/2.75)*g+.984375)+f,Pe=(g,f,x,C)=>x-Me(C-g,0,x,C)+f;var Fe=Object.freeze({__proto__:null,defaultEasing:De,easeInBack:function(g,f,x,C){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return x*(g/=C)*g*((w+1)*g-w)+f},easeInBounce:Pe,easeInCirc:(g,f,x,C)=>-x*(Math.sqrt(1-(g/=C)*g)-1)+f,easeInCubic:(g,f,x,C)=>x*(g/C)**3+f,easeInElastic:(g,f,x,C)=>{const w=x;let S=0;if(0===g)return f;if(1===(g/=C))return f+x;S||(S=.3*C);const{a:T,s:O,p:k}=Oe(w,x,S,1.70158);return-ke(T,O,k,g,C)+f},easeInExpo:(g,f,x,C)=>0===g?f:x*2**(10*(g/C-1))+f,easeInOutBack:function(g,f,x,C){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return(g/=C/2)<1?x/2*(g*g*((1+(w*=1.525))*g-w))+f:x/2*((g-=2)*g*((1+(w*=1.525))*g+w)+2)+f},easeInOutBounce:(g,f,x,C)=>g<C/2?.5*Pe(2*g,0,x,C)+f:.5*Me(2*g-C,0,x,C)+.5*x+f,easeInOutCirc:(g,f,x,C)=>(g/=C/2)<1?-x/2*(Math.sqrt(1-g**2)-1)+f:x/2*(Math.sqrt(1-(g-=2)*g)+1)+f,easeInOutCubic:(g,f,x,C)=>(g/=C/2)<1?x/2*g**3+f:x/2*((g-2)**3+2)+f,easeInOutElastic:(g,f,x,C)=>{const w=x;let S=0;if(0===g)return f;if(2===(g/=C/2))return f+x;S||(S=C*(.3*1.5));const{a:O,s:k,p:D,c:M}=Oe(w,x,S,1.70158);return g<1?-.5*ke(O,k,D,g,C)+f:O*Math.pow(2,-10*(g-=1))*Math.sin((g*C-k)*T/D)*.5+M+f},easeInOutExpo:(g,f,x,C)=>0===g?f:g===C?f+x:(g/=C/2)<1?x/2*2**(10*(g-1))+f:x/2*-(2**(-10*--g)+2)+f,easeInOutQuad:(g,f,x,C)=>(g/=C/2)<1?x/2*g**2+f:-x/2*(--g*(g-2)-1)+f,easeInOutQuart:(g,f,x,C)=>(g/=C/2)<1?x/2*g**4+f:-x/2*((g-=2)*g**3-2)+f,easeInOutQuint:(g,f,x,C)=>(g/=C/2)<1?x/2*g**5+f:x/2*((g-2)**5+2)+f,easeInOutSine:(g,f,x,C)=>-x/2*(Math.cos(Math.PI*g/C)-1)+f,easeInQuad:(g,f,x,C)=>x*(g/=C)*g+f,easeInQuart:(g,f,x,C)=>x*(g/=C)*g**3+f,easeInQuint:(g,f,x,C)=>x*(g/C)**5+f,easeInSine:(g,f,x,C)=>-x*Math.cos(g/C*S)+x+f,easeOutBack:function(g,f,x,C){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return x*((g=g/C-1)*g*((w+1)*g+w)+1)+f},easeOutBounce:Me,easeOutCirc:(g,f,x,C)=>x*Math.sqrt(1-(g=g/C-1)*g)+f,easeOutCubic:(g,f,x,C)=>x*((g/C-1)**3+1)+f,easeOutElastic:(g,f,x,C)=>{const w=x;let S=0;if(0===g)return f;if(1===(g/=C))return f+x;S||(S=.3*C);const{a:O,s:k,p:D,c:M}=Oe(w,x,S,1.70158);return O*2**(-10*g)*Math.sin((g*C-k)*T/D)+M+f},easeOutExpo:(g,f,x,C)=>g===C?f+x:x*-(2**(-10*g/C)+1)+f,easeOutQuad:(g,f,x,C)=>-x*(g/=C)*(g-2)+f,easeOutQuart:(g,f,x,C)=>-x*((g=g/C-1)*g**3-1)+f,easeOutQuint:(g,f,x,C)=>x*((g/C-1)**5+1)+f,easeOutSine:(g,f,x,C)=>x*Math.sin(g/C*S)+f});const Ae=()=>!1;class je{constructor(g){let{startValue:f,byValue:x,duration:C=500,delay:w=0,easing:S=De,onStart:T=b,onChange:O=b,onComplete:k=b,abort:D=Ae,target:M}=g;s(this,"_state","pending"),s(this,"durationProgress",0),s(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=C,this.delay=w,this.easing=S,this._onStart=T,this._onChange=O,this._onComplete=k,this._abort=D,this.target=M,this.startValue=f,this.byValue=x,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return"aborted"===this._state||"completed"===this._state}start(){const t=g=>{"pending"===this._state&&(this.startTime=g||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout((()=>Z(t)),this.delay):Z(t)}tick(g){const f=(g||+new Date)-this.startTime,x=Math.min(f,this.duration);this.durationProgress=x/this.duration;const{value:C,valueProgress:w}=this.calculate(x);this.value=Object.freeze(C),this.valueProgress=w,"aborted"!==this._state&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):f>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),Z(this.tick)))}register(){N.push(this)}unregister(){N.remove(this)}abort(){this._state="aborted",this.unregister()}}const Re=["startValue","endValue"];class Le extends je{constructor(g){let{startValue:f=0,endValue:x=100}=g;super(e(e({},i(g,Re)),{},{startValue:f,byValue:x-f}))}calculate(g){const f=this.easing(g,this.startValue,this.byValue,this.duration);return{value:f,valueProgress:Math.abs((f-this.startValue)/this.byValue)}}}const Ue=["startValue","endValue"];class Be extends je{constructor(g){let{startValue:f=[0],endValue:x=[100]}=g;super(e(e({},i(g,Ue)),{},{startValue:f,byValue:x.map(((g,x)=>g-f[x]))}))}calculate(g){const f=this.startValue.map(((f,x)=>this.easing(g,f,this.byValue[x],this.duration,x)));return{value:f,valueProgress:Math.abs((f[0]-this.startValue[0])/this.byValue[0])}}}const Ie=(g,f,x)=>Math.max(g,Math.min(f,x)),Xe=["startValue","endValue","easing","onChange","onComplete","abort"],Ye=(g,f,x,C)=>f+x*(1-Math.cos(g/C*S)),We=g=>g&&((f,x,C)=>g(new At(f).toRgba(),x,C));class Ve extends je{constructor(g){let{startValue:f,endValue:x,easing:C=Ye,onChange:w,onComplete:S,abort:T}=g,O=i(g,Xe);const k=new At(f).getSource(),D=new At(x).getSource();super(e(e({},O),{},{startValue:k,byValue:D.map(((g,f)=>g-k[f])),easing:C,onChange:We(w),onComplete:We(S),abort:We(T)}))}calculate(g){const[f,x,C,w]=this.startValue.map(((f,x)=>this.easing(g,f,this.byValue[x],this.duration,x))),S=[...[f,x,C].map(Math.round),Ie(0,w,1)];return{value:S,valueProgress:S.map(((g,f)=>0!==this.byValue[f]?Math.abs((g-this.startValue[f])/this.byValue[f]):0)).find((g=>0!==g))||0}}}function ze(g){const f=(g=>Array.isArray(g.startValue)||Array.isArray(g.endValue))(g)?new Be(g):new Le(g);return f.start(),f}function He(g){const f=new Ve(g);return f.start(),f}const Ge=new U(1,0),cs=new U,Ne=(g,f)=>g.rotate(f),qe=(g,f)=>new U(f).subtract(g),Ke=g=>g.distanceFrom(cs),Je=(g,f)=>Math.atan2(ts(g,f),es(g,f)),Ze=g=>Je(Ge,g),Qe=g=>g.eq(cs)?g:g.scalarDivide(Ke(g)),$e=function(g){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Qe(new U(-g.y,g.x).scalarMultiply(f?1:-1))},ts=(g,f)=>g.x*f.y-g.y*f.x,es=(g,f)=>g.x*f.x+g.y*f.y,ss=(g,f,x)=>{if(g.eq(f)||g.eq(x))return!0;const C=ts(f,x),w=ts(f,g),S=ts(x,g);return C>=0?w>=0&&S<=0:!(w<=0&&S>=0)};class is{constructor(g){this.status=g,this.points=[]}includes(g){return this.points.some((f=>f.eq(g)))}append(){for(var g=arguments.length,f=new Array(g),x=0;x<g;x++)f[x]=arguments[x];return this.points=this.points.concat(f.filter((g=>!this.includes(g)))),this}static isPointContained(g,f,x){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(f.eq(x))return g.eq(f);if(f.x===x.x)return g.x===f.x&&(C||g.y>=Math.min(f.y,x.y)&&g.y<=Math.max(f.y,x.y));if(f.y===x.y)return g.y===f.y&&(C||g.x>=Math.min(f.x,x.x)&&g.x<=Math.max(f.x,x.x));{const w=qe(f,x),S=qe(f,g).divide(w);return C?Math.abs(S.x)===Math.abs(S.y):S.x===S.y&&S.x>=0&&S.x<=1}}static isPointInPolygon(g,f){const x=new U(g).setX(Math.min(g.x-1,...f.map((g=>g.x))));let C=0;for(let w=0;w<f.length;w++){const S=this.intersectSegmentSegment(f[w],f[(w+1)%f.length],g,x);if(S.includes(g))return!0;C+=Number("Intersection"===S.status)}return C%2==1}static intersectLineLine(g,f,x,C){let w=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],S=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const T=f.x-g.x,O=f.y-g.y,k=C.x-x.x,D=C.y-x.y,M=g.x-x.x,A=g.y-x.y,P=k*A-D*M,E=T*A-O*M,j=D*T-k*O;if(0!==j){const f=P/j,x=E/j;return(w||0<=f&&f<=1)&&(S||0<=x&&x<=1)?new is("Intersection").append(new U(g.x+f*T,g.y+f*O)):new is}if(0===P||0===E){const T=w||S||is.isPointContained(g,x,C)||is.isPointContained(f,x,C)||is.isPointContained(x,g,f)||is.isPointContained(C,g,f);return new is(T?"Coincident":void 0)}return new is("Parallel")}static intersectSegmentLine(g,f,x,C){return is.intersectLineLine(g,f,x,C,!1,!0)}static intersectSegmentSegment(g,f,x,C){return is.intersectLineLine(g,f,x,C,!1,!1)}static intersectLinePolygon(g,f,x){let C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const w=new is,S=x.length;for(let T,O,k,D=0;D<S;D++){if(T=x[D],O=x[(D+1)%S],k=is.intersectLineLine(g,f,T,O,C,!1),"Coincident"===k.status)return k;w.append(...k.points)}return w.points.length>0&&(w.status="Intersection"),w}static intersectSegmentPolygon(g,f,x){return is.intersectLinePolygon(g,f,x,!1)}static intersectPolygonPolygon(g,f){const x=new is,C=g.length,w=[];for(let S=0;S<C;S++){const T=g[S],O=g[(S+1)%C],k=is.intersectSegmentPolygon(T,O,f);"Coincident"===k.status?(w.push(k),x.append(T,O)):x.append(...k.points)}return w.length>0&&w.length===g.length?new is("Coincident"):(x.points.length>0&&(x.status="Intersection"),x)}static intersectPolygonRectangle(g,f,x){const C=f.min(x),w=f.max(x),S=new U(w.x,C.y),T=new U(C.x,w.y);return is.intersectPolygonPolygon(g,[C,S,w,T])}}class rs extends J{_getTransformedDimensions(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const f=e({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},g),x=f.strokeWidth;let C=x,w=0;this.strokeUniform&&(C=0,w=x);const S=f.width+C,T=f.height+C;let O;return O=0===f.skewX&&0===f.skewY?new U(S*f.scaleX,T*f.scaleY):ce(S,T,_t(f)),O.scalarAdd(w)}translateToGivenOrigin(g,f,x,C,w){let S=g.x,T=g.y;const O=me(C)-me(f),k=me(w)-me(x);if(O||k){const g=this._getTransformedDimensions();S+=O*g.x,T+=k*g.y}return new U(S,T)}translateToCenterPoint(g,f,x){const C=this.translateToGivenOrigin(g,f,x,A,A);return this.angle?C.rotate(rt(this.angle),g):C}translateToOriginPoint(g,f,x){const C=this.translateToGivenOrigin(g,A,A,f,x);return this.angle?C.rotate(rt(this.angle),g):C}getCenterPoint(){const g=this.getRelativeCenterPoint();return this.group?at(g,this.group.calcTransformMatrix()):g}getRelativeCenterPoint(){return this.translateToCenterPoint(new U(this.left,this.top),this.originX,this.originY)}getPointByOrigin(g,f){return this.translateToOriginPoint(this.getRelativeCenterPoint(),g,f)}setPositionByOrigin(g,f,x){const C=this.translateToCenterPoint(g,f,x),w=this.translateToOriginPoint(C,this.originX,this.originY);this.set({left:w.x,top:w.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),P,E)}}class ns extends rs{getX(){return this.getXY().x}setX(g){this.setXY(this.getXY().setX(g))}getY(){return this.getXY().y}setY(g){this.setXY(this.getXY().setY(g))}getRelativeX(){return this.left}setRelativeX(g){this.left=g}getRelativeY(){return this.top}setRelativeY(g){this.top=g}getXY(){const g=this.getRelativeXY();return this.group?at(g,this.group.calcTransformMatrix()):g}setXY(g,f,x){this.group&&(g=at(g,ht(this.group.calcTransformMatrix()))),this.setRelativeXY(g,f,x)}getRelativeXY(){return new U(this.left,this.top)}setRelativeXY(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.originX,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.originY;this.setPositionByOrigin(g,f,x)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:g,tr:f,br:x,bl:C}=this.aCoords||(this.aCoords=this.calcACoords()),w=[g,f,x,C];if(this.group){const g=this.group.calcTransformMatrix();return w.map((f=>at(f,g)))}return w}intersectsWithRect(g,f){return"Intersection"===is.intersectPolygonRectangle(this.getCoords(),g,f).status}intersectsWithObject(g){const f=is.intersectPolygonPolygon(this.getCoords(),g.getCoords());return"Intersection"===f.status||"Coincident"===f.status||g.isContainedWithinObject(this)||this.isContainedWithinObject(g)}isContainedWithinObject(g){return this.getCoords().every((f=>g.containsPoint(f)))}isContainedWithinRect(g,f){const{left:x,top:C,width:w,height:S}=this.getBoundingRect();return x>=g.x&&x+w<=f.x&&C>=g.y&&C+S<=f.y}isOverlapping(g){return this.intersectsWithObject(g)||this.isContainedWithinObject(g)||g.isContainedWithinObject(this)}containsPoint(g){return is.isPointInPolygon(g,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:g,br:f}=this.canvas.vptCoords;return!!this.getCoords().some((x=>x.x<=f.x&&x.x>=g.x&&x.y<=f.y&&x.y>=g.y))||!!this.intersectsWithRect(g,f)||this.containsPoint(g.midPointFrom(f))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:g,br:f}=this.canvas.vptCoords;return!!this.intersectsWithRect(g,f)||this.getCoords().every((x=>(x.x>=f.x||x.x<=g.x)&&(x.y>=f.y||x.y<=g.y)))&&this.containsPoint(g.midPointFrom(f))}getBoundingRect(){return ie(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(g){this._set("scaleX",g),this._set("scaleY",g),this.setCoords()}scaleToWidth(g){const f=this.getBoundingRect().width/this.getScaledWidth();return this.scale(g/this.width/f)}scaleToHeight(g){const f=this.getBoundingRect().height/this.getScaledHeight();return this.scale(g/this.height/f)}getCanvasRetinaScaling(){var g;return(null===(g=this.canvas)||void 0===g?void 0:g.getRetinaScaling())||1}getTotalAngle(){return this.group?nt(ut(this.calcTransformMatrix())):this.angle}getViewportTransform(){var g;return(null===(g=this.canvas)||void 0===g?void 0:g.viewportTransform)||k.concat()}calcACoords(){const g=ft({angle:this.angle}),{x:f,y:x}=this.getRelativeCenterPoint(),C=gt(f,x),w=ct(C,g),S=this._getTransformedDimensions(),T=S.x/2,O=S.y/2;return{tl:at({x:-T,y:-O},w),tr:at({x:T,y:-O},w),bl:at({x:-T,y:O},w),br:at({x:T,y:O},w)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=[];return!g&&this.group&&(f=this.group.transformMatrixKey(g)),f.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,me(this.originX),me(this.originY)),f}calcTransformMatrix(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=this.calcOwnMatrix();if(g||!this.group)return f;const x=this.transformMatrixKey(g),C=this.matrixCache;return C&&C.key.every(((g,f)=>g===x[f]))?C.value:(this.group&&(f=ct(this.group.calcTransformMatrix(!1),f)),this.matrixCache={key:x,value:f},f)}calcOwnMatrix(){const g=this.transformMatrixKey(!0),f=this.ownMatrixCache;if(f&&f.key===g)return f.value;const x=this.getRelativeCenterPoint(),C={angle:this.angle,translateX:x.x,translateY:x.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},w=xt(C);return this.ownMatrixCache={key:g,value:w},w}_getNonTransformedDimensions(){return new U(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(g){return this._getTransformedDimensions(g).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}}class os extends ns{isDescendantOf(g){const{parent:f,group:x}=this;return f===g||x===g||this.canvas===g||!!f&&f.isDescendantOf(g)||!!x&&x!==f&&x.isDescendantOf(g)}getAncestors(g){const f=[];let x=this;do{var C;x=x instanceof os?null!==(C=x.parent)&&void 0!==C?C:g?void 0:x.canvas:void 0,x&&f.push(x)}while(x);return f}findCommonAncestors(g,f){if(this===g)return{fork:[],otherFork:[],common:[this,...this.getAncestors(f)]};const x=this.getAncestors(f),C=g.getAncestors(f);if(0===x.length&&C.length>0&&this===C[C.length-1])return{fork:[],otherFork:[g,...C.slice(0,C.length-1)],common:[this]};for(let f,w=0;w<x.length;w++){if(f=x[w],f===g)return{fork:[this,...x.slice(0,w)],otherFork:[],common:x.slice(w)};for(let S=0;S<C.length;S++){if(this===C[S])return{fork:[],otherFork:[g,...C.slice(0,S)],common:[this,...x]};if(f===C[S])return{fork:[this,...x.slice(0,w)],otherFork:[g,...C.slice(0,S)],common:x.slice(w)}}}return{fork:[this,...x],otherFork:[g,...C],common:[]}}hasCommonAncestors(g,f){const x=this.findCommonAncestors(g,f);return x&&!!x.common.length}isInFrontOf(g){if(this===g)return;const f=this.findCommonAncestors(g);if(!f)return;if(f.fork.includes(g))return!0;if(f.otherFork.includes(this))return!1;const x=f.common[0];if(!x)return;const C=f.fork.pop(),w=f.otherFork.pop(),S=x._objects.indexOf(C),T=x._objects.indexOf(w);return S>-1&&S>T}}class as extends os{animate(g,f){return Object.entries(g).reduce(((g,x)=>{let[C,w]=x;return g[C]=this._animate(C,w,f),g}),{})}_animate(g,f){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const C=g.split("."),w=this.constructor.colorProperties.includes(C[C.length-1]),{abort:S,startValue:T,onChange:O,onComplete:k}=x,D=e(e({},x),{},{target:this,startValue:null!=T?T:C.reduce(((g,f)=>g[f]),this),endValue:f,abort:null==S?void 0:S.bind(this),onChange:(g,f,x)=>{C.reduce(((f,x,w)=>(w===C.length-1&&(f[x]=g),f[x])),this),O&&O(g,f,x)},onComplete:(g,f,x)=>{this.setCoords(),k&&k(g,f,x)}});return w?He(D):ze(D)}}function hs(g){return new RegExp("^("+g.join("|")+")\\b","i")}var ls,us;s(as,"colorProperties",["fill","stroke","backgroundColor"]);const ds=String.raw(ls||(ls=r(["(?:[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?)"],["(?:[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?)"]))),gs="http://www.w3.org/2000/svg";String.raw(us||(us=r(["(?:s+,?s*|,s*|$)"],["(?:\\s+,?\\s*|,\\s*|$)"])));const fs=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+ds+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+ds+"))?\\s+(.*)"),ps={cx:P,x:P,r:"radius",cy:E,y:E,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},ms="font-size",vs="clip-path",ys=hs(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),_s=hs(["symbol","image","marker","pattern","view","svg"]),xs=hs(["symbol","g","a","svg","clipPath","defs"]),Cs=new RegExp("^\\s*("+ds+"+)\\s*,?\\s*("+ds+"+)\\s*,?\\s*("+ds+"+)\\s*,?\\s*("+ds+"+)\\s*$"),bs="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",Ts=new RegExp("(?:\\s|^)"+bs+bs+"("+ds+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class ws{constructor(g){const f="string"==typeof g?ws.parseShadow(g):g;Object.assign(this,ws.ownDefaults);for(const g in f)this[g]=f[g];this.id=tt()}static parseShadow(g){const f=g.trim(),[,x=0,C=0,w=0]=(Ts.exec(f)||[]).map((g=>parseFloat(g)||0));return{color:(f.replace(Ts,"")||"rgb(0,0,0)").trim(),offsetX:x,offsetY:C,blur:w}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(f){const x=Ne(new U(this.offsetX,this.offsetY),rt(-f.angle)),C=new At(this.color);let w=40,S=40;return f.width&&f.height&&(w=100*jt((Math.abs(x.x)+this.blur)/f.width,g.NUM_FRACTION_DIGITS)+20,S=100*jt((Math.abs(x.y)+this.blur)/f.height,g.NUM_FRACTION_DIGITS)+20),f.flipX&&(x.x*=-1),f.flipY&&(x.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(S,'%" height="').concat(100+2*S,'%" x="-').concat(w,'%" width="').concat(100+2*w,'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="').concat(jt(this.blur?this.blur/2:0,g.NUM_FRACTION_DIGITS),'"></feGaussianBlur>\n\t<feOffset dx="').concat(jt(x.x,g.NUM_FRACTION_DIGITS),'" dy="').concat(jt(x.y,g.NUM_FRACTION_DIGITS),'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="').concat(C.toRgb(),'" flood-opacity="').concat(C.getAlpha(),'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n')}toObject(){const g={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},f=ws.ownDefaults;return this.includeDefaultValues?g:Tt(g,((g,x)=>g!==f[x]))}static async fromObject(g){return new this(g)}}s(ws,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),s(ws,"type","shadow"),X.setClass(ws,"shadow");const Ss=g=>JSON.parse(JSON.stringify(g)),Os=[E,P,"scaleX","scaleY","flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible","skewX","skewY"],ks=["fill","stroke","strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],Ds={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:P,originY:E,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:"fill",fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},Ms=["type"],Ps=["extraParam"];let js=class t extends as{static getDefaults(){return t.ownDefaults}get type(){const g=this.constructor.type;return"FabricObject"===g?"object":g.toLowerCase()}set type(g){h("warn","Setting type has no effect",g)}constructor(g){super(),s(this,"_cacheContext",null),Object.assign(this,t.ownDefaults),this.setOptions(g)}_createCacheCanvas(){this._cacheCanvas=et(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(f){const x=f.width,w=f.height,S=g.maxCacheSideLimit,T=g.minCacheSideLimit;if(x<=S&&w<=S&&x*w<=g.perfLimitSizeTotal)return x<T&&(f.width=T),w<T&&(f.height=T),f;const O=x/w,[k,D]=C.limitDimsByArea(O),M=Ie(T,k,S),A=Ie(T,D,S);return x>M&&(f.zoomX/=x/M,f.width=M,f.capped=!0),w>A&&(f.zoomY/=w/A,f.height=A,f.capped=!0),f}_getCacheCanvasDimensions(){const g=this.getTotalObjectScaling(),f=this._getTransformedDimensions({skewX:0,skewY:0}),x=f.x*g.x/this.scaleX,C=f.y*g.y/this.scaleY;return{width:x+2,height:C+2,zoomX:g.x,zoomY:g.y,x:x,y:C}}_updateCacheCanvas(){const f=this._cacheCanvas,x=this._cacheContext,C=this._limitCacheSize(this._getCacheCanvasDimensions()),w=g.minCacheSideLimit,S=C.width,T=C.height,O=C.zoomX,k=C.zoomY,D=S!==this.cacheWidth||T!==this.cacheHeight,M=this.zoomX!==O||this.zoomY!==k;if(!f||!x)return!1;let A,P,E=D||M,j=0,F=0,L=!1;if(D){const g=this._cacheCanvas.width,f=this._cacheCanvas.height,x=S>g||T>f;L=x||(S<.9*g||T<.9*f)&&g>w&&f>w,x&&!C.capped&&(S>w||T>w)&&(j=.1*S,F=.1*T)}return Wt(this)&&this.path&&(E=!0,L=!0,j+=this.getHeightOfLine(0)*this.zoomX,F+=this.getHeightOfLine(0)*this.zoomY),!!E&&(L?(f.width=Math.ceil(S+j),f.height=Math.ceil(T+F)):(x.setTransform(1,0,0,1,0,0),x.clearRect(0,0,f.width,f.height)),A=C.x/2,P=C.y/2,this.cacheTranslationX=Math.round(f.width/2-A)+A,this.cacheTranslationY=Math.round(f.height/2-P)+P,this.cacheWidth=S,this.cacheHeight=T,x.translate(this.cacheTranslationX,this.cacheTranslationY),x.scale(O,k),this.zoomX=O,this.zoomY=k,!0)}setOptions(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setOptions(g)}transform(g){const f=this.group&&!this.group._transformDone||this.group&&this.canvas&&g===this.canvas.contextTop,x=this.calcTransformMatrix(!f);g.transform(x[0],x[1],x[2],x[3],x[4],x[5])}toObject(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const x=g.NUM_FRACTION_DIGITS,C=this.clipPath&&!this.clipPath.excludeFromExport?e(e({},this.clipPath.toObject(f)),{},{inverted:this.clipPath.inverted,absolutePositioned:this.clipPath.absolutePositioned}):null,S=e(e({},St(this,f)),{},{type:this.constructor.type,version:w,originX:this.originX,originY:this.originY,left:jt(this.left,x),top:jt(this.top,x),width:jt(this.width,x),height:jt(this.height,x),fill:Xt(this.fill)?this.fill.toObject():this.fill,stroke:Xt(this.stroke)?this.stroke.toObject():this.stroke,strokeWidth:jt(this.strokeWidth,x),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:jt(this.strokeMiterLimit,x),scaleX:jt(this.scaleX,x),scaleY:jt(this.scaleY,x),angle:jt(this.angle,x),flipX:this.flipX,flipY:this.flipY,opacity:jt(this.opacity,x),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:jt(this.skewX,x),skewY:jt(this.skewY,x)},C?{clipPath:C}:null);return this.includeDefaultValues?S:this._removeDefaultValues(S)}toDatalessObject(g){return this.toObject(g)}_removeDefaultValues(g){const f=this.constructor.getDefaults(),x=Object.keys(f).length>0?f:Object.getPrototypeOf(this);return Tt(g,((g,f)=>{if(f===P||f===E||"type"===f)return!0;const C=x[f];return g!==C&&!(Array.isArray(g)&&Array.isArray(C)&&0===g.length&&0===C.length)}))}toString(){return"#<".concat(this.constructor.type,">")}getObjectScaling(){if(!this.group)return new U(Math.abs(this.scaleX),Math.abs(this.scaleY));const g=dt(this.calcTransformMatrix());return new U(Math.abs(g.scaleX),Math.abs(g.scaleY))}getTotalObjectScaling(){const g=this.getObjectScaling();if(this.canvas){const f=this.canvas.getZoom(),x=this.getCanvasRetinaScaling();return g.scalarMultiply(f*x)}return g}getObjectOpacity(){let g=this.opacity;return this.group&&(g*=this.group.getObjectOpacity()),g}_constrainScale(g){return Math.abs(g)<this.minScaleLimit?g<0?-this.minScaleLimit:this.minScaleLimit:0===g?1e-4:g}_set(g,f){"scaleX"!==g&&"scaleY"!==g||(f=this._constrainScale(f)),"scaleX"===g&&f<0?(this.flipX=!this.flipX,f*=-1):"scaleY"===g&&f<0?(this.flipY=!this.flipY,f*=-1):"shadow"!==g||!f||f instanceof ws||(f=new ws(f));const x=this[g]!==f;return this[g]=f,x&&this.constructor.cacheProperties.includes(g)&&(this.dirty=!0),this.parent&&(this.dirty||x&&this.constructor.stateProperties.includes(g))&&this.parent._set("dirty",!0),this}isNotVisible(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible}render(g){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(g.save(),this._setupCompositeOperation(g),this.drawSelectionBackground(g),this.transform(g),this._setOpacity(g),this._setShadow(g),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(g)):(this._removeCacheCanvas(),this.drawObject(g),this.dirty=!1),g.restore())}drawSelectionBackground(g){}renderCache(g){g=g||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext&&(this.drawObject(this._cacheContext,g.forClipping),this.dirty=!1)}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0}hasStroke(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth}hasFill(){return this.fill&&"transparent"!==this.fill}needsItsOwnCache(){return!!("stroke"===this.paintFirst&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.parent||!this.parent.isOnACache()),this.ownCaching}willDrawShadow(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)}drawClipPathOnCache(g,f){if(g.save(),f.inverted?g.globalCompositeOperation="destination-out":g.globalCompositeOperation="destination-in",f.absolutePositioned){const f=ht(this.calcTransformMatrix());g.transform(f[0],f[1],f[2],f[3],f[4],f[5])}f.transform(g),g.scale(1/f.zoomX,1/f.zoomY),g.drawImage(f._cacheCanvas,-f.cacheTranslationX,-f.cacheTranslationY),g.restore()}drawObject(g,f){const x=this.fill,C=this.stroke;f?(this.fill="black",this.stroke="",this._setClippingProperties(g)):this._renderBackground(g),this._render(g),this._drawClipPath(g,this.clipPath),this.fill=x,this.stroke=C}_drawClipPath(g,f){f&&(f._set("canvas",this.canvas),f.shouldCache(),f._transformDone=!0,f.renderCache({forClipping:!0}),this.drawClipPathOnCache(g,f))}drawCacheOnCanvas(g){g.scale(1/this.zoomX,1/this.zoomY),g.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!g&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned){if(this._cacheCanvas&&this._cacheContext&&!g){const g=this.cacheWidth/this.zoomX,f=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-g/2,-f/2,g,f)}return!0}return!1}_renderBackground(g){if(!this.backgroundColor)return;const f=this._getNonTransformedDimensions();g.fillStyle=this.backgroundColor,g.fillRect(-f.x/2,-f.y/2,f.x,f.y),this._removeShadow(g)}_setOpacity(g){this.group&&!this.group._transformDone?g.globalAlpha=this.getObjectOpacity():g.globalAlpha*=this.opacity}_setStrokeStyles(g,f){const x=f.stroke;x&&(g.lineWidth=f.strokeWidth,g.lineCap=f.strokeLineCap,g.lineDashOffset=f.strokeDashOffset,g.lineJoin=f.strokeLineJoin,g.miterLimit=f.strokeMiterLimit,It(x)?"percentage"===x.gradientUnits||x.gradientTransform||x.patternTransform?this._applyPatternForTransformedGradient(g,x):(g.strokeStyle=x.toLive(g),this._applyPatternGradientTransform(g,x)):g.strokeStyle=f.stroke)}_setFillStyles(g,f){let{fill:x}=f;x&&(It(x)?(g.fillStyle=x.toLive(g),this._applyPatternGradientTransform(g,x)):g.fillStyle=x)}_setClippingProperties(g){g.globalAlpha=1,g.strokeStyle="transparent",g.fillStyle="#000000"}_setLineDash(g,f){f&&0!==f.length&&(1&f.length&&f.push(...f),g.setLineDash(f))}_setShadow(f){if(!this.shadow)return;const x=this.shadow,C=this.canvas,w=this.getCanvasRetinaScaling(),[S,,,T]=(null==C?void 0:C.viewportTransform)||k,O=S*w,D=T*w,M=x.nonScaling?new U(1,1):this.getObjectScaling();f.shadowColor=x.color,f.shadowBlur=x.blur*g.browserShadowBlurConstant*(O+D)*(M.x+M.y)/4,f.shadowOffsetX=x.offsetX*O*M.x,f.shadowOffsetY=x.offsetY*D*M.y}_removeShadow(g){this.shadow&&(g.shadowColor="",g.shadowBlur=g.shadowOffsetX=g.shadowOffsetY=0)}_applyPatternGradientTransform(g,f){if(!It(f))return{offsetX:0,offsetY:0};const x=f.gradientTransform||f.patternTransform,C=-this.width/2+f.offsetX||0,w=-this.height/2+f.offsetY||0;return"percentage"===f.gradientUnits?g.transform(this.width,0,0,this.height,C,w):g.transform(1,0,0,1,C,w),x&&g.transform(x[0],x[1],x[2],x[3],x[4],x[5]),{offsetX:C,offsetY:w}}_renderPaintInOrder(g){"stroke"===this.paintFirst?(this._renderStroke(g),this._renderFill(g)):(this._renderFill(g),this._renderStroke(g))}_render(g){}_renderFill(g){this.fill&&(g.save(),this._setFillStyles(g,this),"evenodd"===this.fillRule?g.fill("evenodd"):g.fill(),g.restore())}_renderStroke(g){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(g),g.save(),this.strokeUniform){const f=this.getObjectScaling();g.scale(1/f.x,1/f.y)}this._setLineDash(g,this.strokeDashArray),this._setStrokeStyles(g,this),g.stroke(),g.restore()}}_applyPatternForTransformedGradient(g,f){var x;const C=this._limitCacheSize(this._getCacheCanvasDimensions()),w=et(),S=this.getCanvasRetinaScaling(),T=C.x/this.scaleX/S,O=C.y/this.scaleY/S;w.width=Math.ceil(T),w.height=Math.ceil(O);const k=w.getContext("2d");k&&(k.beginPath(),k.moveTo(0,0),k.lineTo(T,0),k.lineTo(T,O),k.lineTo(0,O),k.closePath(),k.translate(T/2,O/2),k.scale(C.zoomX/this.scaleX/S,C.zoomY/this.scaleY/S),this._applyPatternGradientTransform(k,f),k.fillStyle=f.toLive(g),k.fill(),g.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),g.scale(S*this.scaleX/C.zoomX,S*this.scaleY/C.zoomY),g.strokeStyle=null!==(x=k.createPattern(w,"no-repeat"))&&void 0!==x?x:"")}_findCenterFromElement(){return new U(this.left+this.width/2,this.top+this.height/2)}clone(g){const f=this.toObject(g);return this.constructor.fromObject(f)}cloneAsImage(g){const f=this.toCanvasElement(g);return new(X.getClass("image"))(f)}toCanvasElement(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const f=he(this),x=this.group,C=this.shadow,w=Math.abs,S=g.enableRetinaScaling?_():1,T=(g.multiplier||1)*S,O=g.canvasProvider||(g=>new Qt(g,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,g.withoutTransform&&ae(this),g.withoutShadow&&(this.shadow=null),g.viewportTransform&&ge(this,this.getViewportTransform()),this.setCoords();const k=et(),D=this.getBoundingRect(),M=this.shadow,P=new U;if(M){const g=M.blur,f=M.nonScaling?new U(1,1):this.getObjectScaling();P.x=2*Math.round(w(M.offsetX)+g)*w(f.x),P.y=2*Math.round(w(M.offsetY)+g)*w(f.y)}const E=D.width+P.x,j=D.height+P.y;k.width=Math.ceil(E),k.height=Math.ceil(j);const F=O(k);"jpeg"===g.format&&(F.backgroundColor="#fff"),this.setPositionByOrigin(new U(F.width/2,F.height/2),A,A);const L=this.canvas;F._objects=[this],this.set("canvas",F),this.setCoords();const R=F.toCanvasElement(T||1,g);return this.set("canvas",L),this.shadow=C,x&&(this.group=x),this.set(f),this.setCoords(),F._objects=[],F.destroy(),R}toDataURL(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return it(this.toCanvasElement(g),g.format||"png",g.quality||1)}isType(){for(var g=arguments.length,f=new Array(g),x=0;x<g;x++)f[x]=arguments[x];return f.includes(this.constructor.type)||f.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(g){const{centeredRotation:f,originX:x,originY:C}=this;if(f){const{x:g,y:f}=this.getRelativeCenterPoint();this.originX=A,this.originY=A,this.left=g,this.top=f}if(this.set("angle",g),f){const{x:g,y:f}=this.translateToOriginPoint(this.getRelativeCenterPoint(),x,C);this.left=g,this.top=f,this.originX=x,this.originY=C}}setOnGroup(){}_setupCompositeOperation(g){this.globalCompositeOperation&&(g.globalCompositeOperation=this.globalCompositeOperation)}dispose(){N.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&m().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}static _fromObject(g){let f=i(g,Ms),x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{extraParam:C}=x,w=i(x,Ps);return wt(Ss(f),w).then((g=>{const f=e(e({},w),g);if(C){const{[C]:g}=f;return new this(g,i(f,[C].map(n)))}return new this(f)}))}static fromObject(g,f){return this._fromObject(g,f)}};s(js,"stateProperties",Os),s(js,"cacheProperties",ks),s(js,"ownDefaults",Ds),s(js,"type","FabricObject"),X.setClass(js),X.setClass(js,"object");const Es=(g,f)=>(x,C,w,S)=>{const T=f(x,C,w,S);return T&&fe(g,Ce(x,C,w,S)),T};function As(g){return(f,x,C,w)=>{const{target:S,originX:T,originY:O}=x,k=S.getRelativeCenterPoint(),D=S.translateToOriginPoint(k,T,O),M=g(f,x,C,w);return S.setPositionByOrigin(D,x.originX,x.originY),M}}const Is=Es("resizing",As(((g,f,x,C)=>{const w=we(f,f.originX,f.originY,x,C);if(f.originX===A||f.originX===F&&w.x<0||f.originX===P&&w.x>0){const{target:g}=f,x=g.strokeWidth/(g.strokeUniform?g.scaleX:1),C=ye(f)?2:1,S=g.width,T=Math.ceil(Math.abs(w.x*C/g.scaleX)-x);return g.set("width",Math.max(T,0)),S!==g.width}return!1})));function Fs(g,f,x,C,w){C=C||{};const S=this.sizeX||C.cornerSize||w.cornerSize,O=this.sizeY||C.cornerSize||w.cornerSize,k=void 0!==C.transparentCorners?C.transparentCorners:w.transparentCorners,D=k?"stroke":"fill",M=!k&&(C.cornerStrokeColor||w.cornerStrokeColor);let A,P=f,E=x;g.save(),g.fillStyle=C.cornerColor||w.cornerColor||"",g.strokeStyle=C.cornerStrokeColor||w.cornerStrokeColor||"",S>O?(A=S,g.scale(1,O/S),E=x*S/O):O>S?(A=O,g.scale(S/O,1),P=f*O/S):A=S,g.lineWidth=1,g.beginPath(),g.arc(P,E,A/2,0,T,!1),g[D](),M&&g.stroke(),g.restore()}function Ls(g,f,x,C,w){C=C||{};const S=this.sizeX||C.cornerSize||w.cornerSize,T=this.sizeY||C.cornerSize||w.cornerSize,O=void 0!==C.transparentCorners?C.transparentCorners:w.transparentCorners,k=O?"stroke":"fill",D=!O&&(C.cornerStrokeColor||w.cornerStrokeColor),M=S/2,A=T/2;g.save(),g.fillStyle=C.cornerColor||w.cornerColor||"",g.strokeStyle=C.cornerStrokeColor||w.cornerStrokeColor||"",g.lineWidth=1,g.translate(f,x);const P=w.getTotalAngle();g.rotate(rt(P)),g["".concat(k,"Rect")](-M,-A,S,T),D&&g.strokeRect(-M,-A,S,T),g.restore()}class Rs{constructor(g){s(this,"visible",!0),s(this,"actionName","scale"),s(this,"angle",0),s(this,"x",0),s(this,"y",0),s(this,"offsetX",0),s(this,"offsetY",0),s(this,"sizeX",0),s(this,"sizeY",0),s(this,"touchSizeX",0),s(this,"touchSizeY",0),s(this,"cursorStyle","crosshair"),s(this,"withConnection",!1),Object.assign(this,g)}shouldActivate(g,f,x,C){var w;let{tl:S,tr:T,br:O,bl:k}=C;return(null===(w=f.canvas)||void 0===w?void 0:w.getActiveObject())===f&&f.isControlVisible(g)&&is.isPointInPolygon(x,[S,T,O,k])}getActionHandler(g,f,x){return this.actionHandler}getMouseDownHandler(g,f,x){return this.mouseDownHandler}getMouseUpHandler(g,f,x){return this.mouseUpHandler}cursorStyleHandler(g,f,x){return f.cursorStyle}getActionName(g,f,x){return f.actionName}getVisibility(g,f){var x,C;return null!==(x=null===(C=g._controlsVisibility)||void 0===C?void 0:C[f])&&void 0!==x?x:this.visible}setVisibility(g,f,x){this.visible=g}positionHandler(g,f,x,C){return new U(this.x*g.x+this.offsetX,this.y*g.y+this.offsetY).transform(f)}calcCornerCoords(g,f,x,C,w,S){const T=lt([gt(x,C),ft({angle:g}),pt((w?this.touchSizeX:this.sizeX)||f,(w?this.touchSizeY:this.sizeY)||f)]);return{tl:new U(-.5,-.5).transform(T),tr:new U(.5,-.5).transform(T),br:new U(.5,.5).transform(T),bl:new U(-.5,.5).transform(T)}}render(g,f,x,C,w){"circle"===((C=C||{}).cornerStyle||w.cornerStyle)?Fs.call(this,g,f,x,C,w):Ls.call(this,g,f,x,C,w)}}const Bs=(g,f,x)=>x.lockRotation?Ee:f.cursorStyle,Us=Es("rotating",As(((g,f,x,C)=>{let{target:w,ex:S,ey:T,theta:O,originX:k,originY:D}=f;const M=w.translateToOriginPoint(w.getRelativeCenterPoint(),k,D);if(xe(w,"lockRotation"))return!1;const A=Math.atan2(T-M.y,S-M.x),P=Math.atan2(C-M.y,x-M.x);let E=nt(P-A+O);if(w.snapAngle&&w.snapAngle>0){const g=w.snapAngle,f=w.snapThreshold||g,x=Math.ceil(E/g)*g,C=Math.floor(E/g)*g;Math.abs(E-C)<f?E=C:Math.abs(E-x)<f&&(E=x)}E<0&&(E=360+E),E%=360;const j=w.angle!==E;return w.angle=E,j})));function Xs(g,f){const x=f.canvas,C=g[x.uniScaleKey];return x.uniformScaling&&!C||!x.uniformScaling&&C}function Ys(g,f,x){const C=xe(g,"lockScalingX"),w=xe(g,"lockScalingY");if(C&&w)return!0;if(!f&&(C||w)&&x)return!0;if(C&&"x"===f)return!0;if(w&&"y"===f)return!0;const{width:S,height:T,strokeWidth:O}=g;return 0===S&&0===O&&"y"!==f||0===T&&0===O&&"x"!==f}const Ws=["e","se","s","sw","w","nw","n","ne","e"],Vs=(g,f,x)=>{const C=Xs(g,x);if(Ys(x,0!==f.x&&0===f.y?"x":0===f.x&&0!==f.y?"y":"",C))return Ee;const w=be(x,f);return"".concat(Ws[w],"-resize")};function zs(g,f,x,C){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const S=f.target,T=w.by,O=Xs(g,S);let k,D,M,A,P,E;if(Ys(S,T,O))return!1;if(f.gestureScale)D=f.scaleX*f.gestureScale,M=f.scaleY*f.gestureScale;else{if(k=we(f,f.originX,f.originY,x,C),P="y"!==T?Math.sign(k.x||f.signX||1):1,E="x"!==T?Math.sign(k.y||f.signY||1):1,f.signX||(f.signX=P),f.signY||(f.signY=E),xe(S,"lockScalingFlip")&&(f.signX!==P||f.signY!==E))return!1;if(A=S._getTransformedDimensions(),O&&!T){const g=Math.abs(k.x)+Math.abs(k.y),{original:x}=f,C=g/(Math.abs(A.x*x.scaleX/S.scaleX)+Math.abs(A.y*x.scaleY/S.scaleY));D=x.scaleX*C,M=x.scaleY*C}else D=Math.abs(k.x*S.scaleX/A.x),M=Math.abs(k.y*S.scaleY/A.y);ye(f)&&(D*=2,M*=2),f.signX!==P&&"y"!==T&&(f.originX=_e(f.originX),D*=-1,f.signX=P),f.signY!==E&&"x"!==T&&(f.originY=_e(f.originY),M*=-1,f.signY=E)}const j=S.scaleX,F=S.scaleY;return T?("x"===T&&S.set("scaleX",D),"y"===T&&S.set("scaleY",M)):(!xe(S,"lockScalingX")&&S.set("scaleX",D),!xe(S,"lockScalingY")&&S.set("scaleY",M)),j!==S.scaleX||F!==S.scaleY}const Hs=Es("scaling",As(((g,f,x,C)=>zs(g,f,x,C)))),Gs=Es("scaling",As(((g,f,x,C)=>zs(g,f,x,C,{by:"x"})))),Ns=Es("scaling",As(((g,f,x,C)=>zs(g,f,x,C,{by:"y"})))),qs=["target","ex","ey","skewingSide"],Ks={x:{counterAxis:"y",scale:"scaleX",skew:"skewX",lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:"scaleY",skew:"skewY",lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},gi=["ns","nesw","ew","nwse"],Js=(g,f,x)=>{if(0!==f.x&&xe(x,"lockSkewingY"))return Ee;if(0!==f.y&&xe(x,"lockSkewingX"))return Ee;const C=be(x,f)%4;return"".concat(gi[C],"-resize")};function Zs(g,f,x,C,w){const{target:S}=x,{counterAxis:T,origin:O,lockSkewing:k,skew:D,flip:M}=Ks[g];if(xe(S,k))return!1;const{origin:P,flip:E}=Ks[T],j=me(x[P])*(S[E]?-1:1),F=-Math.sign(j)*(S[M]?-1:1),L=-(0===S[D]&&we(x,A,A,C,w)[g]>0||S[D]>0?1:-1)*F*.5+.5,R=Es("skewing",As(((f,x,C,w)=>function(g,f,x){let{target:C,ex:w,ey:S,skewingSide:T}=f,O=i(f,qs);const{skew:k}=Ks[g],D=x.subtract(new U(w,S)).divide(new U(C.scaleX,C.scaleY))[g],M=C[k],A=O[k],P=Math.tan(rt(A)),E="y"===g?C._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:C._getTransformedDimensions({scaleX:1,scaleY:1}).y,j=2*D*T/Math.max(E,1)+P,F=nt(Math.atan(j));C.set(k,F);const L=M!==C[k];if(L&&"y"===g){const{skewX:g,scaleX:f}=C,x=C._getTransformedDimensions({skewY:M}),w=C._getTransformedDimensions(),S=0!==g?x.x/w.x:1;1!==S&&C.set("scaleX",S*f)}return L}(g,x,new U(C,w)))));return R(f,e(e({},x),{},{[O]:L,skewingSide:F}),C,w)}const Qs=(g,f,x,C)=>Zs("x",g,f,x,C),$s=(g,f,x,C)=>Zs("y",g,f,x,C);function ti(g,f){return g[f.canvas.altActionKey]}const ei=(g,f,x)=>{const C=ti(g,x);return 0===f.x?C?"skewX":"scaleY":0===f.y?C?"skewY":"scaleX":""},si=(g,f,x)=>ti(g,x)?Js(0,f,x):Vs(g,f,x),ii=(g,f,x,C)=>ti(g,f.target)?$s(g,f,x,C):Gs(g,f,x,C),ri=(g,f,x,C)=>ti(g,f.target)?Qs(g,f,x,C):Ns(g,f,x,C),ni=()=>({ml:new Rs({x:-.5,y:0,cursorStyleHandler:si,actionHandler:ii,getActionName:ei}),mr:new Rs({x:.5,y:0,cursorStyleHandler:si,actionHandler:ii,getActionName:ei}),mb:new Rs({x:0,y:.5,cursorStyleHandler:si,actionHandler:ri,getActionName:ei}),mt:new Rs({x:0,y:-.5,cursorStyleHandler:si,actionHandler:ri,getActionName:ei}),tl:new Rs({x:-.5,y:-.5,cursorStyleHandler:Vs,actionHandler:Hs}),tr:new Rs({x:.5,y:-.5,cursorStyleHandler:Vs,actionHandler:Hs}),bl:new Rs({x:-.5,y:.5,cursorStyleHandler:Vs,actionHandler:Hs}),br:new Rs({x:.5,y:.5,cursorStyleHandler:Vs,actionHandler:Hs}),mtr:new Rs({x:0,y:-.5,actionHandler:Us,cursorStyleHandler:Bs,offsetY:-40,withConnection:!0,actionName:"rotate"})}),oi=()=>({mr:new Rs({x:.5,y:0,actionHandler:Is,cursorStyleHandler:si,actionName:"resizing"}),ml:new Rs({x:-.5,y:0,actionHandler:Is,cursorStyleHandler:si,actionName:"resizing"})}),ai=()=>e(e({},ni()),oi());class hi extends js{static getDefaults(){return e(e({},super.getDefaults()),hi.ownDefaults)}constructor(g){super(),Object.assign(this,this.constructor.createControls(),hi.ownDefaults),this.setOptions(g)}static createControls(){return{controls:ni()}}_updateCacheCanvas(){const g=this.canvas;if(this.noScaleCache&&g&&g._currentTransform){const f=g._currentTransform,x=f.target,C=f.action;if(this===x&&C&&C.startsWith("scale"))return!1}return super._updateCacheCanvas()}getActiveControl(){const g=this.__corner;return g?{key:g,control:this.controls[g],coord:this.oCoords[g]}:void 0}findControl(g){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const x=Object.entries(this.oCoords);for(let C=x.length-1;C>=0;C--){const[w,S]=x[C],T=this.controls[w];if(T.shouldActivate(w,this,g,f?S.touchCorner:S.corner))return this.__corner=w,{key:w,control:T,coord:this.oCoords[w]}}}calcOCoords(){const g=this.getViewportTransform(),f=this.getCenterPoint(),x=gt(f.x,f.y),C=ft({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),w=ct(x,C),S=ct(g,w),T=ct(S,[1/g[0],0,0,1/g[3],0,0]),O=this.group?dt(this.calcTransformMatrix()):void 0;O&&(O.scaleX=Math.abs(O.scaleX),O.scaleY=Math.abs(O.scaleY));const k=this._calculateCurrentDimensions(O),D={};return this.forEachControl(((g,f)=>{const x=g.positionHandler(k,T,this,g);D[f]=Object.assign(x,this._calcCornerCoords(g,x))})),D}_calcCornerCoords(g,f){const x=this.getTotalAngle();return{corner:g.calcCornerCoords(x,this.cornerSize,f.x,f.y,!1,this),touchCorner:g.calcCornerCoords(x,this.touchCornerSize,f.x,f.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(g){for(const f in this.controls)g(this.controls[f],f,this)}drawSelectionBackground(g){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;g.save();const f=this.getRelativeCenterPoint(),x=this._calculateCurrentDimensions(),C=this.getViewportTransform();g.translate(f.x,f.y),g.scale(1/C[0],1/C[3]),g.rotate(rt(this.angle)),g.fillStyle=this.selectionBackgroundColor,g.fillRect(-x.x/2,-x.y/2,x.x,x.y),g.restore()}strokeBorders(g,f){g.strokeRect(-f.x/2,-f.y/2,f.x,f.y)}_drawBorders(g,f){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const C=e({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},x);g.save(),g.strokeStyle=C.borderColor,this._setLineDash(g,C.borderDashArray),this.strokeBorders(g,f),C.hasControls&&this.drawControlsConnectingLines(g,f),g.restore()}_renderControls(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{hasBorders:x,hasControls:C}=this,w=e({hasBorders:x,hasControls:C},f),S=this.getViewportTransform(),T=w.hasBorders,O=w.hasControls,k=ct(S,this.calcTransformMatrix()),D=dt(k);g.save(),g.translate(D.translateX,D.translateY),g.lineWidth=1*this.borderScaleFactor,this.group===this.parent&&(g.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(D.angle-=180),g.rotate(rt(this.group?D.angle:this.angle)),T&&this.drawBorders(g,D,f),O&&this.drawControls(g,f),g.restore()}drawBorders(g,f,x){let C;if(x&&x.forActiveSelection||this.group){const g=ce(this.width,this.height,_t(f)),x=this.isStrokeAccountedForInDimensions()?$:(this.strokeUniform?(new U).scalarAdd(this.canvas?this.canvas.getZoom():1):new U(f.scaleX,f.scaleY)).scalarMultiply(this.strokeWidth);C=g.add(x).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else C=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(g,C,x)}drawControlsConnectingLines(g,f){let x=!1;g.beginPath(),this.forEachControl(((C,w)=>{C.withConnection&&C.getVisibility(this,w)&&(x=!0,g.moveTo(C.x*f.x,C.y*f.y),g.lineTo(C.x*f.x+C.offsetX,C.y*f.y+C.offsetY))})),x&&g.stroke()}drawControls(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};g.save();const x=this.getCanvasRetinaScaling(),{cornerStrokeColor:C,cornerDashArray:w,cornerColor:S}=this,T=e({cornerStrokeColor:C,cornerDashArray:w,cornerColor:S},f);g.setTransform(x,0,0,x,0,0),g.strokeStyle=g.fillStyle=T.cornerColor,this.transparentCorners||(g.strokeStyle=T.cornerStrokeColor),this._setLineDash(g,T.cornerDashArray),this.setCoords(),this.forEachControl(((f,x)=>{if(f.getVisibility(this,x)){const C=this.oCoords[x];f.render(g,C.x,C.y,T,this)}})),g.restore()}isControlVisible(g){return this.controls[g]&&this.controls[g].getVisibility(this,g)}setControlVisible(g,f){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[g]=f}setControlsVisibility(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.entries(g).forEach((g=>{let[f,x]=g;return this.setControlVisible(f,x)}))}clearContextTop(g){if(!this.canvas)return;const f=this.canvas.contextTop;if(!f)return;const x=this.canvas.viewportTransform;f.save(),f.transform(x[0],x[1],x[2],x[3],x[4],x[5]),this.transform(f);const C=this.width+4,w=this.height+4;return f.clearRect(-C/2,-w/2,C,w),g||f.restore(),f}onDeselect(g){return!1}onSelect(g){return!1}shouldStartDragging(g){return!1}onDragStart(g){return!1}canDrop(g){return!1}renderDragSourceEffect(g){}renderDropTargetEffect(g){}}function ci(g,f){return f.forEach((f=>{Object.getOwnPropertyNames(f.prototype).forEach((x=>{"constructor"!==x&&Object.defineProperty(g.prototype,x,Object.getOwnPropertyDescriptor(f.prototype,x)||Object.create(null))}))})),g}s(hi,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class li extends hi{}ci(li,[Te]),X.setClass(li),X.setClass(li,"object");const ui=(g,f,x,C)=>{const w=2*(C=Math.round(C))+1,{data:S}=g.getImageData(f-C,x-C,w,w);for(let g=3;g<S.length;g+=4)if(S[g]>0)return!1;return!0};class di{constructor(g){this.options=g,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new U(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new U(1/this.options.scaleX,1/this.options.scaleY):new U(1,1)}createSideVector(g,f){const x=qe(g,f);return this.options.strokeUniform?x.multiply(this.scale):x}projectOrthogonally(g,f,x){return this.applySkew(g.add(this.calcOrthogonalProjection(g,f,x)))}isSkewed(){return 0!==this.options.skewX||0!==this.options.skewY}applySkew(g){const f=new U(g);return f.y+=f.x*Math.tan(rt(this.options.skewY)),f.x+=f.y*Math.tan(rt(this.options.skewX)),f}scaleUnitVector(g,f){return g.multiply(this.strokeUniformScalar).scalarMultiply(f)}}const xi=new U;class fi extends di{static getOrthogonalRotationFactor(g,f){const x=f?Je(g,f):Ze(g);return Math.abs(x)<S?-1:1}constructor(g,f,x,C){super(C),s(this,"AB",void 0),s(this,"AC",void 0),s(this,"alpha",void 0),s(this,"bisector",void 0),this.A=new U(g),this.B=new U(f),this.C=new U(x),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=Je(this.AB,this.AC),this.bisector=Qe(Ne(this.AB.eq(xi)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(g,f){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude;const C=this.createSideVector(g,f),w=$e(C),S=fi.getOrthogonalRotationFactor(w,this.bisector);return this.scaleUnitVector(w,x*S)}projectBevel(){const g=[];return(this.alpha%T==0?[this.B]:[this.B,this.C]).forEach((f=>{g.push(this.projectOrthogonally(this.A,f)),g.push(this.projectOrthogonally(this.A,f,-this.strokeProjectionMagnitude))})),g}projectMiter(){const g=[],f=Math.abs(this.alpha),x=1/Math.sin(f/2),C=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*x),w=this.options.strokeUniform?Ke(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return Ke(C)/this.strokeProjectionMagnitude<=w&&g.push(this.applySkew(this.A.add(C))),g.push(...this.projectBevel()),g}projectRoundNoSkew(g,f){const x=[],C=new U(fi.getOrthogonalRotationFactor(this.bisector),fi.getOrthogonalRotationFactor(new U(this.bisector.y,this.bisector.x)));return[new U(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(C),new U(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(C)].forEach((C=>{ss(C,g,f)&&x.push(this.A.add(C))})),x}projectRoundWithSkew(g,f){const x=[],{skewX:C,skewY:w,scaleX:S,scaleY:T,strokeUniform:O}=this.options,k=new U(Math.tan(rt(C)),Math.tan(rt(w))),D=this.strokeProjectionMagnitude,M=O?D/T/Math.sqrt(1/T**2+1/S**2*k.y**2):D/Math.sqrt(1+k.y**2),A=new U(Math.sqrt(Math.max(D**2-M**2,0)),M),P=O?D/Math.sqrt(1+k.x**2*(1/T)**2/(1/S+1/S*k.x*k.y)**2):D/Math.sqrt(1+k.x**2/(1+k.x*k.y)**2),E=new U(P,Math.sqrt(Math.max(D**2-P**2,0)));return[E,E.scalarMultiply(-1),A,A.scalarMultiply(-1)].map((g=>this.applySkew(O?g.multiply(this.strokeUniformScalar):g))).forEach((C=>{ss(C,g,f)&&x.push(this.applySkew(this.A).add(C))})),x}projectRound(){const g=[];g.push(...this.projectBevel());const f=this.alpha%T==0,x=this.applySkew(this.A),C=g[f?0:2].subtract(x),w=g[f?1:0].subtract(x),S=f?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),O=ts(C,S)>0,k=O?C:w,D=O?w:C;return this.isSkewed()?g.push(...this.projectRoundWithSkew(k,D)):g.push(...this.projectRoundNoSkew(k,D)),g}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map((g=>({originPoint:this.A,projectedPoint:g,angle:this.alpha,bisector:this.bisector})))}}class pi extends di{constructor(g,f,x){super(x),this.A=new U(g),this.T=new U(f)}calcOrthogonalProjection(g,f){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude;const C=this.createSideVector(g,f);return this.scaleUnitVector($e(C),x)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const g=[];if(!this.isSkewed()&&this.A.eq(this.T)){const f=new U(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);g.push(this.applySkew(this.A.add(f)),this.applySkew(this.A.subtract(f)))}else g.push(...new fi(this.A,this.T,this.T,this.options).projectRound());return g}projectSquare(){const g=[];if(this.A.eq(this.T)){const f=new U(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);g.push(this.A.add(f),this.A.subtract(f))}else{const f=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),x=this.scaleUnitVector(Qe(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),C=this.A.add(x);g.push(C.add(f),C.subtract(f))}return g.map((g=>this.applySkew(g)))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map((g=>({originPoint:this.A,projectedPoint:g})))}}const mi=function(g,f){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C=[];if(0===g.length)return C;const w=g.reduce(((g,f)=>(g[g.length-1].eq(f)||g.push(new U(f)),g)),[new U(g[0])]);if(1===w.length)x=!0;else if(!x){const g=w[0],f=((g,f)=>{for(let x=g.length-1;x>=0;x--)if(f(g[x],x,g))return x;return-1})(w,(f=>!f.eq(g)));w.splice(f+1)}return w.forEach(((g,w,S)=>{let T,O;0===w?(O=S[1],T=x?g:S[S.length-1]):w===S.length-1?(T=S[w-1],O=x?g:S[0]):(T=S[w-1],O=S[w+1]),x&&1===S.length?C.push(...new pi(g,g,f).project()):!x||0!==w&&w!==S.length-1?C.push(...new fi(g,T,O,f).project()):C.push(...new pi(g,0===w?O:T,f).project())})),C},vi=g=>g.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),yi=g=>{const f=[];for(let x,C=0;C<g.length;C++)!1!==(x=_i(g,C))&&f.push(x);return f},_i=(g,f)=>{const x=g.charCodeAt(f);if(isNaN(x))return"";if(x<55296||x>57343)return g.charAt(f);if(55296<=x&&x<=56319){if(g.length<=f+1)throw"High surrogate without following low surrogate";const x=g.charCodeAt(f+1);if(56320>x||x>57343)throw"High surrogate without following low surrogate";return g.charAt(f)+g.charAt(f+1)}if(0===f)throw"Low surrogate without preceding high surrogate";const C=g.charCodeAt(f-1);if(55296>C||C>56319)throw"Low surrogate without preceding high surrogate";return!1};var Si=Object.freeze({__proto__:null,capitalize:function(g){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"".concat(g.charAt(0).toUpperCase()).concat(f?g.slice(1):g.slice(1).toLowerCase())},escapeXml:vi,graphemeSplit:yi});const Ci=function(g,f){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return g.fill!==f.fill||g.stroke!==f.stroke||g.strokeWidth!==f.strokeWidth||g.fontSize!==f.fontSize||g.fontFamily!==f.fontFamily||g.fontWeight!==f.fontWeight||g.fontStyle!==f.fontStyle||g.textBackgroundColor!==f.textBackgroundColor||g.deltaY!==f.deltaY||x&&(g.overline!==f.overline||g.underline!==f.underline||g.linethrough!==f.linethrough)},bi=(g,f)=>{const x=f.split("\n"),C=[];let w=-1,S={};g=Ss(g);for(let f=0;f<x.length;f++){const T=yi(x[f]);if(g[f])for(let x=0;x<T.length;x++){w++;const T=g[f][x];T&&Object.keys(T).length>0&&(Ci(S,T,!0)?C.push({start:w,end:w+1,style:T}):C[C.length-1].end++),S=T||{}}else w+=T.length,S={}}return C},wi=(g,f)=>{if(!Array.isArray(g))return Ss(g);const x=f.split(R),C={};let w=-1,S=0;for(let f=0;f<x.length;f++){const T=yi(x[f]);for(let x=0;x<T.length;x++)w++,g[S]&&g[S].start<=w&&w<g[S].end&&(C[f]=C[f]||{},C[f][x]=e({},g[S].style),w===g[S].end-1&&S++)}return C},Di=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function Ti(g,f){const x=g.nodeName,C=g.getAttribute("class"),w=g.getAttribute("id"),S="(?![a-zA-Z\\-]+)";let T;if(T=new RegExp("^"+x,"i"),f=f.replace(T,""),w&&f.length&&(T=new RegExp("#"+w+S,"i"),f=f.replace(T,"")),C&&f.length){const g=C.split(" ");for(let x=g.length;x--;)T=new RegExp("\\."+g[x]+S,"i"),f=f.replace(T,"")}return 0===f.length}function Oi(g,f){let x=!0;const C=Ti(g,f.pop());return C&&f.length&&(x=function(g,f){let x,C=!0;for(;g.parentElement&&1===g.parentElement.nodeType&&f.length;)C&&(x=f.pop()),C=Ti(g=g.parentElement,x);return 0===f.length}(g,f)),C&&x&&0===f.length}const ki=g=>{var f;return null!==(f=ps[g])&&void 0!==f?f:g},Ai=new RegExp("(".concat(ds,")"),"gi"),Mi=g=>g.replace(Ai," $1 ").replace(/,/gi," ").replace(/\s+/gi," ");var Pi,Ei,ji,Fi,Li,Ri,Bi;const Ii="(".concat(ds,")"),Ui=String.raw(Pi||(Pi=r(["(skewX)(",")"],["(skewX)\\(","\\)"])),Ii),Xi=String.raw(Ei||(Ei=r(["(skewY)(",")"],["(skewY)\\(","\\)"])),Ii),Yi=String.raw(ji||(ji=r(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),Ii,Ii,Ii),Wi=String.raw(Fi||(Fi=r(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),Ii,Ii),Vi=String.raw(Li||(Li=r(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),Ii,Ii),zi=String.raw(Ri||(Ri=r(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),Ii,Ii,Ii,Ii,Ii,Ii),Hi="(?:".concat(zi,"|").concat(Vi,"|").concat(Yi,"|").concat(Wi,"|").concat(Ui,"|").concat(Xi,")"),Gi="(?:".concat(Hi,"*)"),Ni=String.raw(Bi||(Bi=r(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),Gi),qi=new RegExp(Ni),Ki=new RegExp(Hi),tr=new RegExp(Hi,"g");function Ji(g){const f=[];if(!(g=Mi(g).replace(/\s*([()])\s*/gi,"$1"))||g&&!qi.test(g))return[...k];for(const x of g.matchAll(tr)){const g=Ki.exec(x[0]);if(!g)continue;let C=k;const w=g.filter((g=>!!g)),[,S,...T]=w,[O,D,M,A,P,E]=T.map((g=>parseFloat(g)));switch(S){case"translate":C=gt(O,D);break;case"rotate":C=ft({angle:O},{x:D,y:M});break;case"scale":C=pt(O,D);break;case"skewX":C=vt(O);break;case"skewY":C=yt(O);break;case"matrix":C=[O,D,M,A,P,E]}f.push(C)}return lt(f)}function Zi(g,f,x,C){const w=Array.isArray(f);let S,T=f;if("fill"!==g&&"stroke"!==g||f!==L){if("strokeUniform"===g)return"non-scaling-stroke"===f;if("strokeDashArray"===g)T=f===L?null:f.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===g)T=x&&x.transformMatrix?ct(x.transformMatrix,Ji(f)):Ji(f);else if("visible"===g)T=f!==L&&"hidden"!==f,x&&!1===x.visible&&(T=!1);else if("opacity"===g)T=parseFloat(f),x&&void 0!==x.opacity&&(T*=x.opacity);else if("textAnchor"===g)T="start"===f?P:"end"===f?F:A;else if("charSpacing"===g)S=Ft(f,C)/C*1e3;else if("paintFirst"===g){const g=f.indexOf("fill"),x=f.indexOf("stroke");T="fill",(g>-1&&x>-1&&x<g||-1===g&&x>-1)&&(T="stroke")}else{if("href"===g||"xlink:href"===g||"font"===g)return f;if("imageSmoothing"===g)return"optimizeQuality"===f;S=w?f.map(Ft):Ft(f,C)}}else T="";return!w&&isNaN(S)?T:S}function Qi(g,f){const x=g.match(fs);if(!x)return;const C=x[1],w=x[3],S=x[4],T=x[5],O=x[6];C&&(f.fontStyle=C),w&&(f.fontWeight=isNaN(parseFloat(w))?w:parseFloat(w)),S&&(f.fontSize=Ft(S)),O&&(f.fontFamily=O),T&&(f.lineHeight="normal"===T?1:T)}function $i(g){const f={},x=g.getAttribute("style");return x?("string"==typeof x?function(g,f){g.replace(/;\s*$/,"").split(";").forEach((g=>{const[x,C]=g.split(":");f[x.trim().toLowerCase()]=C.trim()}))}(x,f):function(g,f){Object.entries(g).forEach((g=>{let[x,C]=g;void 0!==C&&(f[x.toLowerCase()]=C)}))}(x,f),f):f}const sr={stroke:"strokeOpacity",fill:"fillOpacity"};function er(g,f,x){if(!g)return{};let C,w={},S=D;g.parentNode&&xs.test(g.parentNode.nodeName)&&(w=er(g.parentElement,f,x),w.fontSize&&(C=S=Ft(w.fontSize)));const T=e(e(e({},f.reduce(((f,x)=>{const C=g.getAttribute(x);return C&&(f[x]=C),f}),{})),function(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x={};for(const C in f)Oi(g,C.split(" "))&&(x=e(e({},x),f[C]));return x}(g,x)),$i(g));T[vs]&&g.setAttribute(vs,T[vs]),T[ms]&&(C=Ft(T[ms],S),T[ms]="".concat(C));const O={};for(const g in T){const f=ki(g),x=Zi(f,T[g],w,C);O[f]=x}O&&O.font&&Qi(O.font,O);const k=e(e({},w),O);return xs.test(g.nodeName)?k:function(g){const f=li.getDefaults();return Object.entries(sr).forEach((x=>{let[C,w]=x;if(void 0===g[w]||""===g[C])return;if(void 0===g[C]){if(!f[C])return;g[C]=f[C]}if(0===g[C].indexOf("url("))return;const S=new At(g[C]);g[C]=S.setAlpha(jt(S.getAlpha()*g[w],2)).toRgba()})),g}(k)}const ir=["left","top","width","height","visible"],nr=["rx","ry"];class rr extends li{static getDefaults(){return e(e({},super.getDefaults()),rr.ownDefaults)}constructor(g){super(),Object.assign(this,rr.ownDefaults),this.setOptions(g),this._initRxRy()}_initRxRy(){const{rx:g,ry:f}=this;g&&!f?this.ry=g:f&&!g&&(this.rx=f)}_render(g){const{width:f,height:x}=this,C=-f/2,w=-x/2,S=this.rx?Math.min(this.rx,f/2):0,T=this.ry?Math.min(this.ry,x/2):0,O=0!==S||0!==T;g.beginPath(),g.moveTo(C+S,w),g.lineTo(C+f-S,w),O&&g.bezierCurveTo(C+f-M*S,w,C+f,w+M*T,C+f,w+T),g.lineTo(C+f,w+x-T),O&&g.bezierCurveTo(C+f,w+x-M*T,C+f-M*S,w+x,C+f-S,w+x),g.lineTo(C+S,w+x),O&&g.bezierCurveTo(C+M*S,w+x,C,w+x-M*T,C,w+x-T),g.lineTo(C,w+T),O&&g.bezierCurveTo(C,w+M*T,C+M*S,w,C+S,w),g.closePath(),this._renderPaintInOrder(g)}toObject(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...nr,...g])}_toSVG(){const{width:g,height:f,rx:x,ry:C}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-g/2,'" y="').concat(-f/2,'" rx="').concat(x,'" ry="').concat(C,'" width="').concat(g,'" height="').concat(f,'" />\n')]}static async fromElement(g,f,x){const C=er(g,this.ATTRIBUTE_NAMES,x),{left:w=0,top:S=0,width:T=0,height:O=0,visible:k=!0}=C,D=i(C,ir);return new this(e(e(e({},f),D),{},{left:w,top:S,width:T,height:O,visible:Boolean(k&&T&&O)}))}}s(rr,"type","Rect"),s(rr,"cacheProperties",[...ks,...nr]),s(rr,"ownDefaults",{rx:0,ry:0}),s(rr,"ATTRIBUTE_NAMES",[...Di,"x","y","rx","ry","width","height"]),X.setClass(rr),X.setSVGClass(rr);const or="initialization",ar="added",hr="removed",dr="imperative",cr=(g,f)=>{const{strokeUniform:x,strokeWidth:C,width:w,height:S,group:T}=f,O=T&&T!==g?le(T.calcTransformMatrix(),g.calcTransformMatrix()):null,k=O?f.getRelativeCenterPoint().transform(O):f.getRelativeCenterPoint(),D=!f.isStrokeAccountedForInDimensions(),M=x&&D?de(new U(C,C),void 0,g.calcTransformMatrix()):$,A=!x&&D?C:0,P=ce(w+A,S+A,lt([O,f.calcOwnMatrix()],!0)).add(M).scalarDivide(2);return[k.subtract(P),k.add(P)]};class lr{calcLayoutResult(g,f){if(this.shouldPerformLayout(g))return this.calcBoundingBox(f,g)}shouldPerformLayout(g){return g.type===or||g.type===dr||!!g.prevStrategy&&g.strategy!==g.prevStrategy}shouldLayoutClipPath(g){let{type:f,target:{clipPath:x}}=g;return f!==or&&x&&!x.absolutePositioned}getInitialSize(g,f){return f.size}calcBoundingBox(g,f){if(f.type===dr&&f.overrides)return f.overrides;if(0===g.length)return;const{target:x}=f,{left:C,top:w,width:S,height:T}=ie(g.map((g=>cr(x,g))).reduce(((g,f)=>g.concat(f)),[])),O=new U(S,T),k=new U(C,w).add(O.scalarDivide(2));if(f.type===or){const g=this.getInitialSize(f,{size:O,center:k});return{center:k,relativeCorrection:new U(0,0),size:g}}return{center:k.transform(x.calcOwnMatrix()),size:O}}}s(lr,"type","strategy");class ur extends lr{shouldPerformLayout(g){return!0}}s(ur,"type","fit-content"),X.setClass(ur);const gr=["strategy"],fr=["target","strategy","bubbles","prevStrategy"],mr="layoutManager";class pr{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ur;s(this,"strategy",void 0),this.strategy=g,this._subscriptions=new Map}performLayout(g){const f=e(e({bubbles:!0,strategy:this.strategy},g),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(f);const x=this.getLayoutResult(f);x&&this.commitLayout(f,x),this.onAfterLayout(f,x),this._prevLayoutStrategy=f.strategy}attachHandlers(g,f){const{target:x}=f;return["modified","moving","resizing","rotating","scaling","skewing","changed","modifyPoly"].map((f=>g.on(f,(g=>this.performLayout("modified"===f?{type:"object_modified",trigger:f,e:g,target:x}:{type:"object_modifying",trigger:f,e:g,target:x})))))}subscribe(g,f){this.unsubscribe(g,f);const x=this.attachHandlers(g,f);this._subscriptions.set(g,x)}unsubscribe(g,f){(this._subscriptions.get(g)||[]).forEach((g=>g())),this._subscriptions.delete(g)}unsubscribeTargets(g){g.targets.forEach((f=>this.unsubscribe(f,g)))}subscribeTargets(g){g.targets.forEach((f=>this.subscribe(f,g)))}onBeforeLayout(g){const{target:f,type:x}=g,{canvas:C}=f;if(x===or||x===ar?this.subscribeTargets(g):x===hr&&this.unsubscribeTargets(g),f.fire("layout:before",{context:g}),C&&C.fire("object:layout:before",{target:f,context:g}),x===dr&&g.deep){const x=i(g,gr);f.forEachObject((g=>g.layoutManager&&g.layoutManager.performLayout(e(e({},x),{},{bubbles:!1,target:g}))))}}getLayoutResult(g){const{target:f}=g,x=g.strategy.calcLayoutResult(g,f.getObjects());if(!x)return;const C=g.type===or?new U:f.getRelativeCenterPoint(),{center:w,correction:S=new U,relativeCorrection:T=new U}=x,O=C.subtract(w).add(S).transform(g.type===or?k:ht(f.calcOwnMatrix()),!0).add(T);return{result:x,prevCenter:C,nextCenter:w,offset:O}}commitLayout(g,f){const{target:x}=g,{result:{size:C},nextCenter:w}=f;var S,T;x.set({width:C.x,height:C.y}),this.layoutObjects(g,f),g.type===or?x.set({left:null!==(S=g.x)&&void 0!==S?S:w.x+C.x*me(x.originX),top:null!==(T=g.y)&&void 0!==T?T:w.y+C.y*me(x.originY)}):(x.setPositionByOrigin(w,A,A),x.setCoords(),x.set("dirty",!0))}layoutObjects(g,f){const{target:x}=g;x.forEachObject((C=>{C.group===x&&this.layoutObject(g,f,C)})),g.strategy.shouldLayoutClipPath(g)&&this.layoutObject(g,f,x.clipPath)}layoutObject(g,f,x){let{offset:C}=f;x.set({left:x.left+C.x,top:x.top+C.y})}onAfterLayout(g,f){const{target:x,strategy:C,bubbles:w,prevStrategy:S}=g,T=i(g,fr),{canvas:O}=x;x.fire("layout:after",{context:g,result:f}),O&&O.fire("object:layout:after",{context:g,result:f,target:x});const k=x.parent;w&&null!=k&&k.layoutManager&&((T.path||(T.path=[])).push(x),k.layoutManager.performLayout(e(e({},T),{},{target:k}))),x.set("dirty",!0)}dispose(){this._subscriptions.forEach((g=>g.forEach((g=>g())))),this._subscriptions.clear()}toObject(){return{type:mr,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}X.setClass(pr,mr);const Cr=["type","objects","layoutManager"];class vr extends pr{performLayout(){}}class yr extends(K(li)){static getDefaults(){return e(e({},super.getDefaults()),yr.ownDefaults)}constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),s(this,"_activeObjects",[]),s(this,"__objectSelectionTracker",void 0),s(this,"__objectSelectionDisposer",void 0),Object.assign(this,yr.ownDefaults),this.setOptions(f),this._objects=[...g],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject((g=>{this.enterGroup(g,!1)})),this.layoutManager=f.layoutManager||new pr,this.layoutManager.performLayout({type:or,target:this,targets:[...g],x:f.left,y:f.top})}canEnterGroup(g){return g===this||this.isDescendantOf(g)?(h("error","Group: circular object trees are not supported, this call has no effect"),!1):-1===this._objects.indexOf(g)||(h("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(g){return g.filter(((g,f,x)=>this.canEnterGroup(g)&&x.indexOf(g)===f))}add(){for(var g=arguments.length,f=new Array(g),x=0;x<g;x++)f[x]=arguments[x];const C=this._filterObjectsBeforeEnteringGroup(f),w=super.add(...C);return this._onAfterObjectsChange(ar,C),w}insertAt(g){for(var f=arguments.length,x=new Array(f>1?f-1:0),C=1;C<f;C++)x[C-1]=arguments[C];const w=this._filterObjectsBeforeEnteringGroup(x),S=super.insertAt(g,...w);return this._onAfterObjectsChange(ar,w),S}remove(){const g=super.remove(...arguments);return this._onAfterObjectsChange(hr,g),g}_onObjectAdded(g){this.enterGroup(g,!0),this.fire("object:added",{target:g}),g.fire("added",{target:this})}_onObjectRemoved(g,f){this.exitGroup(g,f),this.fire("object:removed",{target:g}),g.fire("removed",{target:this})}_onAfterObjectsChange(g,f){this.layoutManager.performLayout({type:g,targets:f,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(g,f){const x=this[g];return super._set(g,f),"canvas"===g&&x!==f&&(this._objects||[]).forEach((x=>{x._set(g,f)})),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(g,f){let{target:x}=f;const C=this._activeObjects;if(g)C.push(x),this._set("dirty",!0);else if(C.length>0){const g=C.indexOf(x);g>-1&&(C.splice(g,1),this._set("dirty",!0))}}_watchObject(g,f){g&&this._watchObject(!1,f),g?(f.on("selected",this.__objectSelectionTracker),f.on("deselected",this.__objectSelectionDisposer)):(f.off("selected",this.__objectSelectionTracker),f.off("deselected",this.__objectSelectionDisposer))}enterGroup(g,f){g.group&&g.group.remove(g),g._set("parent",this),this._enterGroup(g,f)}_enterGroup(g,f){f&&oe(g,ct(ht(this.calcTransformMatrix()),g.calcTransformMatrix())),this._shouldSetNestedCoords()&&g.setCoords(),g._set("group",this),g._set("canvas",this.canvas),this._watchObject(!0,g);const x=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();x&&(x===g||g.isDescendantOf(x))&&this._activeObjects.push(g)}exitGroup(g,f){this._exitGroup(g,f),g._set("parent",void 0),g._set("canvas",void 0)}_exitGroup(g,f){g._set("group",void 0),f||(oe(g,ct(this.calcTransformMatrix(),g.calcTransformMatrix())),g.setCoords()),this._watchObject(!1,g);const x=this._activeObjects.length>0?this._activeObjects.indexOf(g):-1;x>-1&&this._activeObjects.splice(x,1)}shouldCache(){const g=li.prototype.shouldCache.call(this);if(g)for(let g=0;g<this._objects.length;g++)if(this._objects[g].willDrawShadow())return this.ownCaching=!1,!1;return g}willDrawShadow(){if(super.willDrawShadow())return!0;for(let g=0;g<this._objects.length;g++)if(this._objects[g].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(g){this._renderBackground(g);for(let x=0;x<this._objects.length;x++){var f;null!==(f=this.canvas)&&void 0!==f&&f.preserveObjectStacking&&this._objects[x].group!==this?(g.save(),g.transform(...ht(this.calcTransformMatrix())),this._objects[x].render(g),g.restore()):this._objects[x].group===this&&this._objects[x].render(g)}this._drawClipPath(g,this.clipPath)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject((g=>g.setCoords()))}triggerLayout(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.layoutManager.performLayout(e({target:this,type:dr},g))}render(g){this._transformDone=!0,super.render(g),this._transformDone=!1}__serializeObjects(g,f){const x=this.includeDefaultValues;return this._objects.filter((function(g){return!g.excludeFromExport})).map((function(C){const w=C.includeDefaultValues;C.includeDefaultValues=x;const S=C[g||"toObject"](f);return C.includeDefaultValues=w,S}))}toObject(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const f=this.layoutManager.toObject();return e(e(e({},super.toObject(["subTargetCheck","interactive",...g])),"fit-content"!==f.strategy||this.includeDefaultValues?{layoutManager:f}:{}),{},{objects:this.__serializeObjects("toObject",g)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject((g=>{this._watchObject(!1,g),g.dispose()})),super.dispose()}_createSVGBgRect(g){if(!this.backgroundColor)return"";const f=rr.prototype._toSVG.call(this),x=f.indexOf("COMMON_PARTS");f[x]='for="group" ';const C=f.join("");return g?g(C):C}_toSVG(g){const f=["<g ","COMMON_PARTS"," >\n"],x=this._createSVGBgRect(g);x&&f.push("\t\t",x);for(let x=0;x<this._objects.length;x++)f.push("\t\t",this._objects[x].toSVG(g));return f.push("</g>\n"),f}getSvgStyles(){const g=void 0!==this.opacity&&1!==this.opacity?"opacity: ".concat(this.opacity,";"):"",f=this.visible?"":" visibility: hidden;";return[g,this.getSvgFilter(),f].join("")}toClipPathSVG(g){const f=[],x=this._createSVGBgRect(g);x&&f.push("\t",x);for(let x=0;x<this._objects.length;x++)f.push("\t",this._objects[x].toClipPathSVG(g));return this._createBaseClipPathSVGMarkup(f,{reviver:g})}static fromObject(g,f){let{type:x,objects:C=[],layoutManager:w}=g,S=i(g,Cr);return Promise.all([bt(C,f),wt(S,f)]).then((g=>{let[f,x]=g;const C=new this(f,e(e(e({},S),x),{},{layoutManager:new vr}));if(w){const g=X.getClass(w.type),f=X.getClass(w.strategy);C.layoutManager=new g(new f)}else C.layoutManager=new pr;return C.layoutManager.subscribeTargets({type:or,target:C,targets:C.getObjects()}),C.setCoords(),C}))}}s(yr,"type","Group"),s(yr,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),X.setClass(yr);const _r=(g,f)=>Math.min(f.width/g.width,f.height/g.height),xr=(g,f)=>Math.max(f.width/g.width,f.height/g.height);var br;const wr="(".concat(ds,")"),Sr="(M) (?:".concat(wr," ").concat(wr," ?)+"),Tr="(L) (?:".concat(wr," ").concat(wr," ?)+"),Or="(H) (?:".concat(wr," ?)+"),kr="(V) (?:".concat(wr," ?)+"),Dr=String.raw(br||(br=r(["(Z)s*"],["(Z)\\s*"]))),Mr="(C) (?:".concat(wr," ").concat(wr," ").concat(wr," ").concat(wr," ").concat(wr," ").concat(wr," ?)+"),Ar="(S) (?:".concat(wr," ").concat(wr," ").concat(wr," ").concat(wr," ?)+"),Pr="(Q) (?:".concat(wr," ").concat(wr," ").concat(wr," ").concat(wr," ?)+"),Er="(T) (?:".concat(wr," ").concat(wr," ?)+"),jr="(A) (?:".concat(wr," ").concat(wr," ").concat(wr," ([01]) ?([01]) ").concat(wr," ").concat(wr," ?)+"),Fr="(?:(?:".concat(Sr,")")+"|(?:".concat(Tr,")")+"|(?:".concat(Or,")")+"|(?:".concat(kr,")")+"|(?:".concat(Dr,")")+"|(?:".concat(Mr,")")+"|(?:".concat(Ar,")")+"|(?:".concat(Pr,")")+"|(?:".concat(Er,")")+"|(?:".concat(jr,"))"),Qr={m:"l",M:"L"},Lr=(g,f,x,C,w,S,T,O,k,D,M)=>{const A=H(g),P=G(g),E=H(f),j=G(f),F=x*w*E-C*S*j+T,L=C*w*E+x*S*j+O;return["C",D+k*(-x*w*P-C*S*A),M+k*(-C*w*P+x*S*A),F+k*(x*w*j+C*S*E),L+k*(C*w*j-x*S*E),F,L]},Rr=(g,f,x,C)=>{const w=Math.atan2(f,g),S=Math.atan2(C,x);return S>=w?S-w:2*Math.PI-(w-S)};function Br(f,x,w,S,T,O,k,D){let M;if(g.cachesBoundsOfCurve&&(M=[...arguments].join(),C.boundsOfCurveCache[M]))return C.boundsOfCurveCache[M];const A=Math.sqrt,P=Math.abs,E=[],j=[[0,0],[0,0]];let F=6*f-12*w+6*T,L=-3*f+9*w-9*T+3*k,R=3*w-3*f;for(let g=0;g<2;++g){if(g>0&&(F=6*x-12*S+6*O,L=-3*x+9*S-9*O+3*D,R=3*S-3*x),P(L)<1e-12){if(P(F)<1e-12)continue;const g=-R/F;0<g&&g<1&&E.push(g);continue}const f=F*F-4*R*L;if(f<0)continue;const C=A(f),w=(-F+C)/(2*L);0<w&&w<1&&E.push(w);const T=(-F-C)/(2*L);0<T&&T<1&&E.push(T)}let B=E.length;const I=B,X=Wr(f,x,w,S,T,O,k,D);for(;B--;){const{x:g,y:f}=X(E[B]);j[0][B]=g,j[1][B]=f}j[0][I]=f,j[1][I]=x,j[0][I+1]=k,j[1][I+1]=D;const N=[new U(Math.min(...j[0]),Math.min(...j[1])),new U(Math.max(...j[0]),Math.max(...j[1]))];return g.cachesBoundsOfCurve&&(C.boundsOfCurveCache[M]=N),N}const Ir=(g,f,x)=>{let[C,w,S,T,k,D,M,A]=x;const P=((g,f,x,C,w,S,T)=>{if(0===x||0===C)return[];let k=0,D=0,M=0;const A=Math.PI,P=T*O,E=G(P),j=H(P),F=.5*(-j*g-E*f),L=.5*(-j*f+E*g),R=x**2,B=C**2,I=L**2,X=F**2,N=R*B-R*I-B*X;let $=Math.abs(x),Ot=Math.abs(C);if(N<0){const g=Math.sqrt(1-N/(R*B));$*=g,Ot*=g}else M=(w===S?-1:1)*Math.sqrt(N/(R*I+B*X));const Zt=M*$*L/Ot,$t=-M*Ot*F/$,re=j*Zt-E*$t+.5*g,pe=E*Zt+j*$t+.5*f;let ve=Rr(1,0,(F-Zt)/$,(L-$t)/Ot),Ee=Rr((F-Zt)/$,(L-$t)/Ot,(-F-Zt)/$,(-L-$t)/Ot);0===S&&Ee>0?Ee-=2*A:1===S&&Ee<0&&(Ee+=2*A);const Fe=Math.ceil(Math.abs(Ee/A*2)),Re=new Array(Fe),Ue=Ee/Fe,Xe=8/3*Math.sin(Ue/4)*Math.sin(Ue/4)/Math.sin(Ue/2);let Ge=ve+Ue;for(let g=0;g<Fe;g++)Re[g]=Lr(ve,Ge,j,E,$,Ot,re,pe,Xe,k,D),k=Re[g][5],D=Re[g][6],ve=Ge,Ge+=Ue;return Re})(M-g,A-f,w,S,k,D,T);for(let x=0,C=P.length;x<C;x++)P[x][1]+=g,P[x][2]+=f,P[x][3]+=g,P[x][4]+=f,P[x][5]+=g,P[x][6]+=f;return P},Xr=g=>{let f=0,x=0,C=0,w=0;const S=[];let T,O=0,k=0;for(const D of g){const g=[...D];let M;switch(g[0]){case"l":g[1]+=f,g[2]+=x;case"L":f=g[1],x=g[2],M=["L",f,x];break;case"h":g[1]+=f;case"H":f=g[1],M=["L",f,x];break;case"v":g[1]+=x;case"V":x=g[1],M=["L",f,x];break;case"m":g[1]+=f,g[2]+=x;case"M":f=g[1],x=g[2],C=g[1],w=g[2],M=["M",f,x];break;case"c":g[1]+=f,g[2]+=x,g[3]+=f,g[4]+=x,g[5]+=f,g[6]+=x;case"C":O=g[3],k=g[4],f=g[5],x=g[6],M=["C",g[1],g[2],O,k,f,x];break;case"s":g[1]+=f,g[2]+=x,g[3]+=f,g[4]+=x;case"S":"C"===T?(O=2*f-O,k=2*x-k):(O=f,k=x),f=g[3],x=g[4],M=["C",O,k,g[1],g[2],f,x],O=M[3],k=M[4];break;case"q":g[1]+=f,g[2]+=x,g[3]+=f,g[4]+=x;case"Q":O=g[1],k=g[2],f=g[3],x=g[4],M=["Q",O,k,f,x];break;case"t":g[1]+=f,g[2]+=x;case"T":"Q"===T?(O=2*f-O,k=2*x-k):(O=f,k=x),f=g[1],x=g[2],M=["Q",O,k,f,x];break;case"a":g[6]+=f,g[7]+=x;case"A":Ir(f,x,g).forEach((g=>S.push(g))),f=g[6],x=g[7];break;case"z":case"Z":f=C,x=w,M=["Z"]}M?(S.push(M),T=M[0]):T=""}return S},Yr=(g,f,x,C)=>Math.sqrt((x-g)**2+(C-f)**2),Wr=(g,f,x,C,w,S,T,O)=>k=>{const D=k**3,M=(g=>3*g**2*(1-g))(k),A=(g=>3*g*(1-g)**2)(k),P=(g=>(1-g)**3)(k);return new U(T*D+w*M+x*A+g*P,O*D+S*M+C*A+f*P)},Vr=g=>g**2,zr=g=>2*g*(1-g),Hr=g=>(1-g)**2,Gr=(g,f,x,C,w,S,T,O)=>k=>{const D=Vr(k),M=zr(k),A=Hr(k),P=3*(A*(x-g)+M*(w-x)+D*(T-w)),E=3*(A*(C-f)+M*(S-C)+D*(O-S));return Math.atan2(E,P)},Ur=(g,f,x,C,w,S)=>T=>{const O=Vr(T),k=zr(T),D=Hr(T);return new U(w*O+x*k+g*D,S*O+C*k+f*D)},Nr=(g,f,x,C,w,S)=>T=>{const O=1-T,k=2*(O*(x-g)+T*(w-x)),D=2*(O*(C-f)+T*(S-C));return Math.atan2(D,k)},qr=(g,f,x)=>{let C=new U(f,x),w=0;for(let f=1;f<=100;f+=1){const x=g(f/100);w+=Yr(C.x,C.y,x.x,x.y),C=x}return w},Kr=(g,f)=>{let x,C=0,w=0,S={x:g.x,y:g.y},T=e({},S),O=.01,k=0;const D=g.iterator,M=g.angleFinder;for(;w<f&&O>1e-4;)T=D(C),k=C,x=Yr(S.x,S.y,T.x,T.y),x+w>f?(C-=O,O/=2):(S=T,C+=O,w+=x);return e(e({},T),{},{angle:M(k)})},Jr=g=>{let f,x,C=0,w=0,S=0,T=0,O=0;const k=[];for(const D of g){const g={x:w,y:S,command:D[0],length:0};switch(D[0]){case"M":x=g,x.x=T=w=D[1],x.y=O=S=D[2];break;case"L":x=g,x.length=Yr(w,S,D[1],D[2]),w=D[1],S=D[2];break;case"C":f=Wr(w,S,D[1],D[2],D[3],D[4],D[5],D[6]),x=g,x.iterator=f,x.angleFinder=Gr(w,S,D[1],D[2],D[3],D[4],D[5],D[6]),x.length=qr(f,w,S),w=D[5],S=D[6];break;case"Q":f=Ur(w,S,D[1],D[2],D[3],D[4]),x=g,x.iterator=f,x.angleFinder=Nr(w,S,D[1],D[2],D[3],D[4]),x.length=qr(f,w,S),w=D[3],S=D[4];break;case"Z":x=g,x.destX=T,x.destY=O,x.length=Yr(w,S,T,O),w=T,S=O}C+=x.length,k.push(x)}return k.push({length:C,x:w,y:S}),k},Zr=function(g,f){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Jr(g),C=0;for(;f-x[C].length>0&&C<x.length-2;)f-=x[C].length,C++;const w=x[C],S=f/w.length,T=g[C];switch(w.command){case"M":return{x:w.x,y:w.y,angle:0};case"Z":return e(e({},new U(w.x,w.y).lerp(new U(w.destX,w.destY),S)),{},{angle:Math.atan2(w.destY-w.y,w.destX-w.x)});case"L":return e(e({},new U(w.x,w.y).lerp(new U(T[1],T[2]),S)),{},{angle:Math.atan2(T[2]-w.y,T[1]-w.x)});case"C":case"Q":return Kr(w,f)}},$r=new RegExp(Fr,"gi"),on=new RegExp(Fr,"i"),tn=g=>{g=Mi(g);const f=[];for(let[x]of g.matchAll($r)){const g=[];let C;do{if(C=on.exec(x),!C)break;const f=C.filter((g=>g));f.shift();const w=f.map((g=>{const f=Number.parseFloat(g);return Number.isNaN(f)?g:f}));if(g.push(w),f.length<=1)break;f.shift(),x=x.replace(new RegExp("".concat(f.join(" ?")," ?$")),"")}while(C);g.reverse().forEach(((g,x)=>{const C=Qr[g[0]];x>0&&("l"==C||"L"==C)&&(g[0]=C),f.push(g)}))}return f},en=function(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=new U(g[0]),C=new U(g[1]),w=1,S=0;const T=[],O=g.length,k=O>2;let D;for(k&&(w=g[2].x<C.x?-1:g[2].x===C.x?0:1,S=g[2].y<C.y?-1:g[2].y===C.y?0:1),T.push(["M",x.x-w*f,x.y-S*f]),D=1;D<O;D++){if(!x.eq(C)){const g=x.midPointFrom(C);T.push(["Q",x.x,x.y,g.x,g.y])}x=g[D],D+1<g.length&&(C=g[D+1])}return k&&(w=x.x>g[D-2].x?1:x.x===g[D-2].x?0:-1,S=x.y>g[D-2].y?1:x.y===g[D-2].y?0:-1),T.push(["L",x.x+w*f,x.y+S*f]),T},sn=(g,f)=>g.map((g=>g.map(((g,x)=>0===x||void 0===f?g:jt(g,f))).join(" "))).join(" ");function rn(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const x=f.onComplete||b,C=new(y().XMLHttpRequest),w=f.signal,n=function(){C.abort()},o=function(){w&&w.removeEventListener("abort",n),C.onerror=C.ontimeout=b};if(w&&w.aborted)throw new l("request");return w&&w.addEventListener("abort",n,{once:!0}),C.onreadystatechange=function(){4===C.readyState&&(o(),x(C),C.onreadystatechange=b)},C.onerror=C.ontimeout=o,C.open("get",g,!0),C.send(),C}const nn=(g,f)=>{let x=g._findCenterFromElement();g.transformMatrix&&((g=>{if(g.transformMatrix){const{scaleX:f,scaleY:x,angle:C,skewX:w}=dt(g.transformMatrix);g.flipX=!1,g.flipY=!1,g.set("scaleX",f),g.set("scaleY",x),g.angle=C,g.skewX=w,g.skewY=0}})(g),x=x.transform(g.transformMatrix)),delete g.transformMatrix,f&&(g.scaleX*=f.scaleX,g.scaleY*=f.scaleY,g.cropX=f.cropX,g.cropY=f.cropY,x.x+=f.offsetLeft,x.y+=f.offsetTop,g.width=f.width,g.height=f.height),g.setPositionByOrigin(x,A,A)};var ln=Object.freeze({__proto__:null,addTransformToObject:ne,animate:ze,animateColor:He,applyTransformToObject:oe,calcAngleBetweenVectors:Je,calcDimensionsMatrix:_t,calcPlaneChangeMatrix:le,calcVectorRotation:Ze,cancelAnimFrame:Q,capValue:Ie,composeMatrix:xt,copyCanvasElement:g=>{var f;const x=et();return x.width=g.width,x.height=g.height,null===(f=x.getContext("2d"))||void 0===f||f.drawImage(g,0,0),x},cos:H,createCanvasElement:et,createImage:st,createRotateMatrix:ft,createScaleMatrix:pt,createSkewXMatrix:vt,createSkewYMatrix:yt,createTranslateMatrix:gt,createVector:qe,crossProduct:ts,degreesToRadians:rt,dotProduct:es,ease:Fe,enlivenObjectEnlivables:wt,enlivenObjects:bt,findScaleToCover:xr,findScaleToFit:_r,getBoundsOfCurve:Br,getOrthonormalVector:$e,getPathSegmentsInfo:Jr,getPointOnPath:Zr,getPointer:te,getRandomInt:W,getRegularPolygonPath:(g,f)=>{const x=2*Math.PI/g;let C=-S;g%2==0&&(C+=x/2);const w=new Array(g+1);for(let S=0;S<g;S++){const g=S*x+C,{x:T,y:O}=new U(H(g),G(g)).scalarMultiply(f);w[S]=[0===S?"M":"L",T,O]}return w[g]=["Z"],w},getSmoothPathFromPoints:en,getSvgAttributes:g=>{const f=["instantiated_by_use","style","id","class"];switch(g){case"linearGradient":return f.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);case"radialGradient":return f.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);case"stop":return f.concat(["offset","stop-color","stop-opacity"])}return f},getUnitVector:Qe,groupSVGElements:(g,f)=>g&&1===g.length?g[0]:new yr(g,f),hasStyleChanged:Ci,invertTransform:ht,isBetweenVectors:ss,isIdentityMatrix:ot,isTouchEvent:ee,isTransparent:ui,joinPath:sn,loadImage:Ct,magnitude:Ke,makeBoundingBoxFromPoints:ie,makePathSimpler:Xr,matrixToSVG:Rt,mergeClipPaths:(g,f)=>{var x;let C=g,w=f;C.inverted&&!w.inverted&&(C=f,w=g),ge(w,null===(x=w.group)||void 0===x?void 0:x.calcTransformMatrix(),C.calcTransformMatrix());const S=C.inverted&&w.inverted;return S&&(C.inverted=w.inverted=!1),new yr([C],{clipPath:w,inverted:S})},multiplyTransformMatrices:ct,multiplyTransformMatrixArray:lt,parsePath:tn,parsePreserveAspectRatioAttribute:Lt,parseUnit:Ft,pick:St,projectStrokeOnPoints:mi,qrDecompose:dt,radiansToDegrees:nt,removeFromArray:z,removeTransformFromObject:(g,f)=>{const x=ht(f),C=ct(x,g.calcOwnMatrix());oe(g,C)},removeTransformMatrixForSvgParsing:nn,request:rn,requestAnimFrame:Z,resetObjectTransform:ae,rotatePoint:(g,f,x)=>g.rotate(x,f),rotateVector:Ne,saveObjectTransform:he,sendObjectToPlane:ge,sendPointToPlane:ue,sendVectorToPlane:de,setStyle:Ut,sin:G,sizeAfterTransform:ce,string:Si,stylesFromArray:wi,stylesToArray:bi,toDataURL:it,toFixed:jt,transformPath:(g,f,x)=>(x&&(f=ct(f,[1,0,0,1,-x.x,-x.y])),g.map((g=>{const x=[...g];for(let C=1;C<g.length-1;C+=2){const{x:w,y:S}=at({x:g[C],y:g[C+1]},f);x[C]=w,x[C+1]=S}return x}))),transformPoint:at});class an extends Jt{constructor(g){let{allowTouchScrolling:f=!1,containerClass:x=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(g),s(this,"upper",void 0),s(this,"container",void 0);const{el:C}=this.lower,w=this.createUpperCanvas();this.upper={el:w,ctx:w.getContext("2d")},this.applyCanvasStyle(C,{allowTouchScrolling:f}),this.applyCanvasStyle(w,{allowTouchScrolling:f});const S=this.createContainerElement();S.classList.add(x),C.parentNode&&C.parentNode.replaceChild(S,C),S.append(C,w),this.container=S}createUpperCanvas(){const{el:g}=this.lower,f=et();return f.className=g.className,f.classList.remove("lower-canvas"),f.classList.add("upper-canvas"),f.setAttribute("data-fabric","top"),f.style.cssText=g.style.cssText,f.setAttribute("draggable","true"),f}createContainerElement(){const g=v().createElement("div");return g.setAttribute("data-fabric","wrapper"),Ut(g,{position:"relative"}),Kt(g),g}applyCanvasStyle(g,f){let{allowTouchScrolling:x}=f;Ut(g,{position:"absolute",left:"0",top:"0"}),function(g,f){const x=f?"manipulation":L;Ut(g,{"touch-action":x,"-ms-touch-action":x})}(g,x),Kt(g)}setDimensions(g,f){super.setDimensions(g,f);const{el:x,ctx:C}=this.upper;Nt(x,C,g,f)}setCSSDimensions(g){super.setCSSDimensions(g),qt(this.upper.el,g),qt(this.container,g)}cleanupDOM(g){const f=this.container,{el:x}=this.lower,{el:C}=this.upper;super.cleanupDOM(g),f.removeChild(C),f.removeChild(x),f.parentNode&&f.parentNode.replaceChild(x,f)}dispose(){super.dispose(),m().dispose(this.upper.el),delete this.upper,delete this.container}}class hn extends Qt{constructor(){super(...arguments),s(this,"targets",[]),s(this,"_hoveredTargets",[]),s(this,"_objectsToRender",void 0),s(this,"_currentTransform",null),s(this,"_groupSelector",null),s(this,"contextTopDirty",!1)}static getDefaults(){return e(e({},super.getDefaults()),hn.ownDefaults)}get upperCanvasEl(){var g;return null===(g=this.elements.upper)||void 0===g?void 0:g.el}get contextTop(){var g;return null===(g=this.elements.upper)||void 0===g?void 0:g.ctx}get wrapperEl(){return this.elements.container}initElements(g){this.elements=new an(g,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(g){this._objectsToRender=void 0,super._onObjectAdded(g)}_onObjectRemoved(g){this._objectsToRender=void 0,g===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[g]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[g]}),g.fire("deselected",{target:g})),g===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(g)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const g=this._activeObject;return!this.preserveObjectStacking&&g?this._objects.filter((f=>!f.group&&f!==g)).concat(g):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(g){g.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(g),this.contextTopDirty=!0),g.restore()}renderTop(){const g=this.contextTop;this.clearContext(g),this.renderTopLayer(g),this.fire("after:render",{ctx:g})}setTargetFindTolerance(g){g=Math.round(g),this.targetFindTolerance=g;const f=this.getRetinaScaling(),x=Math.ceil((2*g+1)*f);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=x,this.pixelFindContext.scale(f,f)}isTargetTransparent(g,f,x){const C=this.targetFindTolerance,w=this.pixelFindContext;this.clearContext(w),w.save(),w.translate(-f+C,-x+C),w.transform(...this.viewportTransform);const S=g.selectionBackgroundColor;g.selectionBackgroundColor="",g.render(w),g.selectionBackgroundColor=S,w.restore();const T=Math.round(C*this.getRetinaScaling());return ui(w,T,T,T)}_isSelectionKeyPressed(g){const f=this.selectionKey;return!!f&&(Array.isArray(f)?!!f.find((f=>!!f&&!0===g[f])):g[f])}_shouldClearSelection(g,f){const x=this.getActiveObjects(),C=this._activeObject;return!!(!f||f&&C&&x.length>1&&-1===x.indexOf(f)&&C!==f&&!this._isSelectionKeyPressed(g)||f&&!f.evented||f&&!f.selectable&&C&&C!==f)}_shouldCenterTransform(g,f,x){if(!g)return;let C;return"scale"===f||"scaleX"===f||"scaleY"===f||"resizing"===f?C=this.centeredScaling||g.centeredScaling:"rotate"===f&&(C=this.centeredRotation||g.centeredRotation),C?!x:x}_getOriginFromCorner(g,f){const x={x:g.originX,y:g.originY};return f?(["ml","tl","bl"].includes(f)?x.x=F:["mr","tr","br"].includes(f)&&(x.x=P),["tl","mt","tr"].includes(f)?x.y=j:["bl","mb","br"].includes(f)&&(x.y=E),x):x}_setupCurrentTransform(g,f,x){var C;const w=f.group?ue(this.getScenePoint(g),void 0,f.group.calcTransformMatrix()):this.getScenePoint(g),{key:S="",control:T}=f.getActiveControl()||{},O=x&&T?null===(C=T.getActionHandler(g,f,T))||void 0===C?void 0:C.bind(T):Se,k=((g,f,x,C)=>{if(!f||!g)return"drag";const w=C.controls[f];return w.getActionName(x,w,C)})(x,S,g,f),D=g[this.centeredKey],M=this._shouldCenterTransform(f,k,D)?{x:A,y:A}:this._getOriginFromCorner(f,S),P={target:f,action:k,actionHandler:O,actionPerformed:!1,corner:S,scaleX:f.scaleX,scaleY:f.scaleY,skewX:f.skewX,skewY:f.skewY,offsetX:w.x-f.left,offsetY:w.y-f.top,originX:M.x,originY:M.y,ex:w.x,ey:w.y,lastX:w.x,lastY:w.y,theta:rt(f.angle),width:f.width,height:f.height,shiftKey:g.shiftKey,altKey:D,original:e(e({},he(f)),{},{originX:M.x,originY:M.y})};this._currentTransform=P,this.fire("before:transform",{e:g,transform:P})}setCursor(g){this.upperCanvasEl.style.cursor=g}_drawSelection(g){const{x:f,y:x,deltaX:C,deltaY:w}=this._groupSelector,S=new U(f,x).transform(this.viewportTransform),T=new U(f+C,x+w).transform(this.viewportTransform),O=this.selectionLineWidth/2;let k=Math.min(S.x,T.x),D=Math.min(S.y,T.y),M=Math.max(S.x,T.x),A=Math.max(S.y,T.y);this.selectionColor&&(g.fillStyle=this.selectionColor,g.fillRect(k,D,M-k,A-D)),this.selectionLineWidth&&this.selectionBorderColor&&(g.lineWidth=this.selectionLineWidth,g.strokeStyle=this.selectionBorderColor,k+=O,D+=O,M-=O,A-=O,li.prototype._setLineDash.call(this,g,this.selectionDashArray),g.strokeRect(k,D,M-k,A-D))}findTarget(g){if(this.skipTargetFind)return;const f=this.getViewportPoint(g),x=this._activeObject,C=this.getActiveObjects();if(this.targets=[],x&&C.length>=1){if(x.findControl(f,ee(g)))return x;if(C.length>1&&this.searchPossibleTargets([x],f))return x;if(x===this.searchPossibleTargets([x],f)){if(this.preserveObjectStacking){const C=this.targets;this.targets=[];const w=this.searchPossibleTargets(this._objects,f);return g[this.altSelectionKey]&&w&&w!==x?(this.targets=C,x):w}return x}}return this.searchPossibleTargets(this._objects,f)}_pointIsInObjectSelectionArea(g,f){let x=g.getCoords();const C=this.getZoom(),w=g.padding/C;if(w){const[g,f,C,S]=x,T=Math.atan2(f.y-g.y,f.x-g.x),O=H(T)*w,k=G(T)*w,D=O+k,M=O-k;x=[new U(g.x-M,g.y-D),new U(f.x+D,f.y-M),new U(C.x+M,C.y+D),new U(S.x-D,S.y+M)]}return is.isPointInPolygon(f,x)}_checkTarget(g,f){if(g&&g.visible&&g.evented&&this._pointIsInObjectSelectionArea(g,ue(f,void 0,this.viewportTransform))){if(!this.perPixelTargetFind&&!g.perPixelTargetFind||g.isEditing)return!0;if(!this.isTargetTransparent(g,f.x,f.y))return!0}return!1}_searchPossibleTargets(g,f){let x=g.length;for(;x--;){const C=g[x];if(this._checkTarget(C,f)){if(q(C)&&C.subTargetCheck){const g=this._searchPossibleTargets(C._objects,f);g&&this.targets.push(g)}return C}}}searchPossibleTargets(g,f){const x=this._searchPossibleTargets(g,f);if(x&&q(x)&&x.interactive&&this.targets[0]){const g=this.targets;for(let f=g.length-1;f>0;f--){const x=g[f];if(!q(x)||!x.interactive)return x}return g[0]}return x}getViewportPoint(g){return this._pointer?this._pointer:this.getPointer(g,!0)}getScenePoint(g){return this._absolutePointer?this._absolutePointer:this.getPointer(g)}getPointer(g){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const x=this.upperCanvasEl,C=x.getBoundingClientRect();let w=te(g),S=C.width||0,T=C.height||0;S&&T||(E in C&&j in C&&(T=Math.abs(C.top-C.bottom)),F in C&&P in C&&(S=Math.abs(C.right-C.left))),this.calcOffset(),w.x=w.x-this._offset.left,w.y=w.y-this._offset.top,f||(w=ue(w,void 0,this.viewportTransform));const O=this.getRetinaScaling();1!==O&&(w.x/=O,w.y/=O);const k=0===S||0===T?new U(1,1):new U(x.width/S,x.height/T);return w.multiply(k)}_setDimensionsImpl(g,f){this._resetTransformEventData(),super._setDimensionsImpl(g,f),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=et(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const g=this._activeObject;return Vt(g)?g.getObjects():g?[g]:[]}_fireSelectionEvents(g,f){let x=!1,C=!1;const w=this.getActiveObjects(),S=[],T=[];g.forEach((g=>{w.includes(g)||(x=!0,g.fire("deselected",{e:f,target:g}),T.push(g))})),w.forEach((C=>{g.includes(C)||(x=!0,C.fire("selected",{e:f,target:C}),S.push(C))})),g.length>0&&w.length>0?(C=!0,x&&this.fire("selection:updated",{e:f,selected:S,deselected:T})):w.length>0?(C=!0,this.fire("selection:created",{e:f,selected:S})):g.length>0&&(C=!0,this.fire("selection:cleared",{e:f,deselected:T})),C&&(this._objectsToRender=void 0)}setActiveObject(g,f){const x=this.getActiveObjects(),C=this._setActiveObject(g,f);return this._fireSelectionEvents(x,f),C}_setActiveObject(g,f){const x=this._activeObject;return x!==g&&!(!this._discardActiveObject(f,g)&&this._activeObject)&&!g.onSelect({e:f})&&(this._activeObject=g,Vt(g)&&x!==g&&(g.set("canvas",this),g.setCoords()),!0)}_discardActiveObject(g,f){const x=this._activeObject;return!!x&&!x.onDeselect({e:g,object:f})&&(this._currentTransform&&this._currentTransform.target===x&&this.endCurrentTransform(g),this._activeObject=void 0,!0)}discardActiveObject(g){const f=this.getActiveObjects(),x=this.getActiveObject();f.length&&this.fire("before:selection:cleared",{e:g,deselected:[x]});const C=this._discardActiveObject(g);return this._fireSelectionEvents(f,g),C}endCurrentTransform(g){const f=this._currentTransform;this._finalizeCurrentTransform(g),f&&f.target&&(f.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(g){const f=this._currentTransform,x=f.target,C={e:g,target:x,transform:f,action:f.action};x._scaling&&(x._scaling=!1),x.setCoords(),f.actionPerformed&&(this.fire("object:modified",C),x.fire("modified",C))}setViewportTransform(g){super.setViewportTransform(g);const f=this._activeObject;f&&f.setCoords()}destroy(){const g=this._activeObject;Vt(g)&&(g.removeAll(),g.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(g){const f=this._activeObject;f&&f._renderControls(g)}_toObject(g,f,x){const C=this._realizeGroupTransformOnObject(g),w=super._toObject(g,f,x);return g.set(C),w}_realizeGroupTransformOnObject(g){const{group:f}=g;if(f&&Vt(f)&&this._activeObject===f){const x=St(g,["angle","flipX","flipY",P,"scaleX","scaleY","skewX","skewY",E]);return ne(g,f.calcOwnMatrix()),x}return{}}_setSVGObject(g,f,x){const C=this._realizeGroupTransformOnObject(f);super._setSVGObject(g,f,x),f.set(C)}}s(hn,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class cn{constructor(g){s(this,"targets",[]),s(this,"__disposer",void 0);const e=()=>{const{hiddenTextarea:f}=g.getActiveObject()||{};f&&f.focus()},f=g.upperCanvasEl;f.addEventListener("click",e),this.__disposer=()=>f.removeEventListener("click",e)}exitTextEditing(){this.target=void 0,this.targets.forEach((g=>{g.isEditing&&g.exitEditing()}))}add(g){this.targets.push(g)}remove(g){this.unregister(g),z(this.targets,g)}register(g){this.target=g}unregister(g){g===this.target&&(this.target=void 0)}onMouseMove(g){var f;(null===(f=this.target)||void 0===f?void 0:f.isEditing)&&this.target.updateSelectionOnMouseMove(g)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const un=["target","oldTarget","fireCanvas","e"],pn={passive:!1},dn=(g,f)=>{const x=g.getViewportPoint(f),C=g.getScenePoint(f);return{viewportPoint:x,scenePoint:C,pointer:x,absolutePointer:C}},gn=function(g){for(var f=arguments.length,x=new Array(f>1?f-1:0),C=1;C<f;C++)x[C-1]=arguments[C];return g.addEventListener(...x)},fn=function(g){for(var f=arguments.length,x=new Array(f>1?f-1:0),C=1;C<f;C++)x[C-1]=arguments[C];return g.removeEventListener(...x)},vn={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class mn extends hn{constructor(g){super(g,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),s(this,"_isClick",void 0),s(this,"textEditingManager",new cn(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onDoubleClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach((g=>{this[g]=this[g].bind(this)})),this.addOrRemove(gn,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(g,f){const x=this.upperCanvasEl,C=this._getEventPrefix();g(Gt(x),"resize",this._onResize),g(x,C+"down",this._onMouseDown),g(x,"".concat(C,"move"),this._onMouseMove,pn),g(x,"".concat(C,"out"),this._onMouseOut),g(x,"".concat(C,"enter"),this._onMouseEnter),g(x,"wheel",this._onMouseWheel),g(x,"contextmenu",this._onContextMenu),g(x,"dblclick",this._onDoubleClick),g(x,"dragstart",this._onDragStart),g(x,"dragend",this._onDragEnd),g(x,"dragover",this._onDragOver),g(x,"dragenter",this._onDragEnter),g(x,"dragleave",this._onDragLeave),g(x,"drop",this._onDrop),this.enablePointerEvents||g(x,"touchstart",this._onTouchStart,pn)}removeListeners(){this.addOrRemove(fn,"remove");const g=this._getEventPrefix(),f=Ht(this.upperCanvasEl);fn(f,"".concat(g,"up"),this._onMouseUp),fn(f,"touchend",this._onTouchEnd,pn),fn(f,"".concat(g,"move"),this._onMouseMove,pn),fn(f,"touchmove",this._onMouseMove,pn)}_onMouseWheel(g){this.__onMouseWheel(g)}_onMouseOut(g){const f=this._hoveredTarget,x=e({e:g},dn(this,g));this.fire("mouse:out",e(e({},x),{},{target:f})),this._hoveredTarget=void 0,f&&f.fire("mouseout",e({},x)),this._hoveredTargets.forEach((g=>{this.fire("mouse:out",e(e({},x),{},{target:g})),g&&g.fire("mouseout",e({},x))})),this._hoveredTargets=[]}_onMouseEnter(g){this._currentTransform||this.findTarget(g)||(this.fire("mouse:over",e({e:g},dn(this,g))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(g){this._isClick=!1;const f=this.getActiveObject();if(f&&f.onDragStart(g)){this._dragSource=f;const x={e:g,target:f};return this.fire("dragstart",x),f.fire("dragstart",x),void gn(this.upperCanvasEl,"drag",this._onDragProgress)}se(g)}_renderDragEffects(g,f,x){let C=!1;const w=this._dropTarget;w&&w!==f&&w!==x&&(w.clearContextTop(),C=!0),null==f||f.clearContextTop(),x!==f&&(null==x||x.clearContextTop());const S=this.contextTop;S.save(),S.transform(...this.viewportTransform),f&&(S.save(),f.transform(S),f.renderDragSourceEffect(g),S.restore(),C=!0),x&&(S.save(),x.transform(S),x.renderDropTargetEffect(g),S.restore(),C=!0),S.restore(),C&&(this.contextTopDirty=!0)}_onDragEnd(g){const f=!!g.dataTransfer&&g.dataTransfer.dropEffect!==L,x=f?this._activeObject:void 0,C={e:g,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:f,dropTarget:x};fn(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",C),this._dragSource&&this._dragSource.fire("dragend",C),delete this._dragSource,this._onMouseUp(g)}_onDragProgress(g){const f={e:g,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",f),this._dragSource&&this._dragSource.fire("drag",f)}findDragTargets(g){this.targets=[];return{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(g)),targets:[...this.targets]}}_onDragOver(g){const f="dragover",{target:x,targets:C}=this.findDragTargets(g),w=this._dragSource,S={e:g,target:x,subTargets:C,dragSource:w,canDrop:!1,dropTarget:void 0};let T;this.fire(f,S),this._fireEnterLeaveEvents(x,S),x&&(x.canDrop(g)&&(T=x),x.fire(f,S));for(let x=0;x<C.length;x++){const w=C[x];w.canDrop(g)&&(T=w),w.fire(f,S)}this._renderDragEffects(g,w,T),this._dropTarget=T}_onDragEnter(g){const{target:f,targets:x}=this.findDragTargets(g),C={e:g,target:f,subTargets:x,dragSource:this._dragSource};this.fire("dragenter",C),this._fireEnterLeaveEvents(f,C)}_onDragLeave(g){const f={e:g,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",f),this._fireEnterLeaveEvents(void 0,f),this._renderDragEffects(g,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(g){const{target:f,targets:x}=this.findDragTargets(g),C=this._basicEventHandler("drop:before",e({e:g,target:f,subTargets:x,dragSource:this._dragSource},dn(this,g)));C.didDrop=!1,C.dropTarget=void 0,this._basicEventHandler("drop",C),this.fire("drop:after",C)}_onContextMenu(g){const f=this.findTarget(g),x=this.targets||[],C=this._basicEventHandler("contextmenu:before",{e:g,target:f,subTargets:x});return this.stopContextMenu&&se(g),this._basicEventHandler("contextmenu",C),!1}_onDoubleClick(g){this._cacheTransformEventData(g),this._handleEvent(g,"dblclick"),this._resetTransformEventData()}getPointerId(g){const f=g.changedTouches;return f?f[0]&&f[0].identifier:this.enablePointerEvents?g.pointerId:-1}_isMainEvent(g){return!0===g.isPrimary||!1!==g.isPrimary&&("touchend"===g.type&&0===g.touches.length||!g.changedTouches||g.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(g){g.preventDefault(),void 0===this.mainTouchId&&(this.mainTouchId=this.getPointerId(g)),this.__onMouseDown(g),this._resetTransformEventData();const f=this.upperCanvasEl,x=this._getEventPrefix(),C=Ht(f);gn(C,"touchend",this._onTouchEnd,pn),gn(C,"touchmove",this._onMouseMove,pn),fn(f,"".concat(x,"down"),this._onMouseDown)}_onMouseDown(g){this.__onMouseDown(g),this._resetTransformEventData();const f=this.upperCanvasEl,x=this._getEventPrefix();fn(f,"".concat(x,"move"),this._onMouseMove,pn);const C=Ht(f);gn(C,"".concat(x,"up"),this._onMouseUp),gn(C,"".concat(x,"move"),this._onMouseMove,pn)}_onTouchEnd(g){if(g.touches.length>0)return;this.__onMouseUp(g),this._resetTransformEventData(),delete this.mainTouchId;const f=this._getEventPrefix(),x=Ht(this.upperCanvasEl);fn(x,"touchend",this._onTouchEnd,pn),fn(x,"touchmove",this._onMouseMove,pn),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout((()=>{gn(this.upperCanvasEl,"".concat(f,"down"),this._onMouseDown),this._willAddMouseDown=0}),400)}_onMouseUp(g){this.__onMouseUp(g),this._resetTransformEventData();const f=this.upperCanvasEl,x=this._getEventPrefix();if(this._isMainEvent(g)){const g=Ht(this.upperCanvasEl);fn(g,"".concat(x,"up"),this._onMouseUp),fn(g,"".concat(x,"move"),this._onMouseMove,pn),gn(f,"".concat(x,"move"),this._onMouseMove,pn)}}_onMouseMove(g){const f=this.getActiveObject();!this.allowTouchScrolling&&(!f||!f.shouldStartDragging(g))&&g.preventDefault&&g.preventDefault(),this.__onMouseMove(g)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(g){const f=this.getActiveObject();return!!f!=!!g||f&&g&&f!==g}__onMouseUp(g){var f;this._cacheTransformEventData(g),this._handleEvent(g,"up:before");const x=this._currentTransform,C=this._isClick,w=this._target,{button:S}=g;if(S)return(this.fireMiddleClick&&1===S||this.fireRightClick&&2===S)&&this._handleEvent(g,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(g);if(!this._isMainEvent(g))return;let T,O,k=!1;if(x&&(this._finalizeCurrentTransform(g),k=x.actionPerformed),!C){const f=w===this._activeObject;this.handleSelection(g),k||(k=this._shouldRender(w)||!f&&w===this._activeObject)}if(w){const f=w.findControl(this.getViewportPoint(g),ee(g)),{key:C,control:S}=f||{};if(O=C,w.selectable&&w!==this._activeObject&&"up"===w.activeOn)this.setActiveObject(w,g),k=!0;else if(S){const f=S.getMouseUpHandler(g,w,S);f&&(T=this.getScenePoint(g),f.call(S,g,x,T.x,T.y))}w.isMoving=!1}if(x&&(x.target!==w||x.corner!==O)){const f=x.target&&x.target.controls[x.corner],C=f&&f.getMouseUpHandler(g,x.target,f);T=T||this.getScenePoint(g),C&&C.call(f,g,x,T.x,T.y)}this._setCursorFromEvent(g,w),this._handleEvent(g,"up"),this._groupSelector=null,this._currentTransform=null,w&&(w.__corner=void 0),k?this.requestRenderAll():C||null!==(f=this._activeObject)&&void 0!==f&&f.isEditing||this.renderTop()}_basicEventHandler(g,f){const{target:x,subTargets:C=[]}=f;this.fire(g,f),x&&x.fire(g,f);for(let w=0;w<C.length;w++)C[w]!==x&&C[w].fire(g,f);return f}_handleEvent(g,f){const x=this._target,C=this.targets||[],w=e(e({e:g,target:x,subTargets:C},dn(this,g)),{},{transform:this._currentTransform},"up:before"===f||"up"===f?{isClick:this._isClick,currentTarget:this.findTarget(g),currentSubTargets:this.targets}:{});this.fire("mouse:".concat(f),w),x&&x.fire("mouse".concat(f),w);for(let g=0;g<C.length;g++)C[g]!==x&&C[g].fire("mouse".concat(f),w)}_onMouseDownInDrawingMode(g){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(g),this.requestRenderAll());const f=this.getScenePoint(g);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(f,{e:g,pointer:f}),this._handleEvent(g,"down")}_onMouseMoveInDrawingMode(g){if(this._isCurrentlyDrawing){const f=this.getScenePoint(g);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(f,{e:g,pointer:f})}this.setCursor(this.freeDrawingCursor),this._handleEvent(g,"move")}_onMouseUpInDrawingMode(g){const f=this.getScenePoint(g);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:g,pointer:f}):this._isCurrentlyDrawing=!1,this._handleEvent(g,"up")}__onMouseDown(g){this._isClick=!0,this._cacheTransformEventData(g),this._handleEvent(g,"down:before");let f=this._target;const{button:x}=g;if(x)return(this.fireMiddleClick&&1===x||this.fireRightClick&&2===x)&&this._handleEvent(g,"down"),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(g);if(!this._isMainEvent(g))return;if(this._currentTransform)return;let C=this._shouldRender(f),w=!1;if(this.handleMultiSelection(g,f)?(f=this._activeObject,w=!0,C=!0):this._shouldClearSelection(g,f)&&this.discardActiveObject(g),this.selection&&(!f||!f.selectable&&!f.isEditing&&f!==this._activeObject)){const f=this.getScenePoint(g);this._groupSelector={x:f.x,y:f.y,deltaY:0,deltaX:0}}if(f){const x=f===this._activeObject;f.selectable&&"down"===f.activeOn&&this.setActiveObject(f,g);const C=f.findControl(this.getViewportPoint(g),ee(g));if(f===this._activeObject&&(C||!w)){this._setupCurrentTransform(g,f,x);const w=C?C.control:void 0,S=this.getScenePoint(g),T=w&&w.getMouseDownHandler(g,f,w);T&&T.call(w,g,this._currentTransform,S.x,S.y)}}C&&(this._objectsToRender=void 0),this._handleEvent(g,"down"),C&&this.requestRenderAll()}_resetTransformEventData(){this._target=void 0,this._pointer=void 0,this._absolutePointer=void 0}_cacheTransformEventData(g){this._resetTransformEventData(),this._pointer=this.getViewportPoint(g),this._absolutePointer=ue(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(g)}__onMouseMove(g){if(this._isClick=!1,this._cacheTransformEventData(g),this._handleEvent(g,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(g);if(!this._isMainEvent(g))return;const f=this._groupSelector;if(f){const x=this.getScenePoint(g);f.deltaX=x.x-f.x,f.deltaY=x.y-f.y,this.renderTop()}else if(this._currentTransform)this._transformObject(g);else{const f=this.findTarget(g);this._setCursorFromEvent(g,f),this._fireOverOutEvents(g,f)}this.textEditingManager.onMouseMove(g),this._handleEvent(g,"move"),this._resetTransformEventData()}_fireOverOutEvents(g,f){const x=this._hoveredTarget,C=this._hoveredTargets,w=this.targets,S=Math.max(C.length,w.length);this.fireSyntheticInOutEvents("mouse",{e:g,target:f,oldTarget:x,fireCanvas:!0});for(let f=0;f<S;f++)this.fireSyntheticInOutEvents("mouse",{e:g,target:w[f],oldTarget:C[f]});this._hoveredTarget=f,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(g,f){const x=this._draggedoverTarget,C=this._hoveredTargets,w=this.targets,S=Math.max(C.length,w.length);this.fireSyntheticInOutEvents("drag",e(e({},f),{},{target:g,oldTarget:x,fireCanvas:!0}));for(let g=0;g<S;g++)this.fireSyntheticInOutEvents("drag",e(e({},f),{},{target:w[g],oldTarget:C[g]}));this._draggedoverTarget=g}fireSyntheticInOutEvents(g,f){let{target:x,oldTarget:C,fireCanvas:w,e:S}=f,T=i(f,un);const{targetIn:O,targetOut:k,canvasIn:D,canvasOut:M}=vn[g],A=C!==x;if(C&&A){const g=e(e({},T),{},{e:S,target:C,nextTarget:x},dn(this,S));w&&this.fire(M,g),C.fire(k,g)}if(x&&A){const g=e(e({},T),{},{e:S,target:x,previousTarget:C},dn(this,S));w&&this.fire(D,g),x.fire(O,g)}}__onMouseWheel(g){this._cacheTransformEventData(g),this._handleEvent(g,"wheel"),this._resetTransformEventData()}_transformObject(g){const f=this.getScenePoint(g),x=this._currentTransform,C=x.target,w=C.group?ue(f,void 0,C.group.calcTransformMatrix()):f;x.shiftKey=g.shiftKey,x.altKey=!!this.centeredKey&&g[this.centeredKey],this._performTransformAction(g,x,w),x.actionPerformed&&this.requestRenderAll()}_performTransformAction(g,f,x){const C=x.x,w=x.y,S=f.action,T=f.actionHandler;let O=!1;T&&(O=T(g,f,C,w)),"drag"===S&&O&&(f.target.isMoving=!0,this.setCursor(f.target.moveCursor||this.moveCursor)),f.actionPerformed=f.actionPerformed||O}_setCursorFromEvent(g,f){if(!f)return void this.setCursor(this.defaultCursor);let x=f.hoverCursor||this.hoverCursor;const C=Vt(this._activeObject)?this._activeObject:null,w=(!C||f.group!==C)&&f.findControl(this.getViewportPoint(g));if(w){const x=w.control;this.setCursor(x.cursorStyleHandler(g,x,f))}else f.subTargetCheck&&this.targets.concat().reverse().map((g=>{x=g.hoverCursor||x})),this.setCursor(x)}handleMultiSelection(g,f){const x=this._activeObject,C=Vt(x);if(x&&this._isSelectionKeyPressed(g)&&this.selection&&f&&f.selectable&&(x!==f||C)&&(C||!f.isDescendantOf(x)&&!x.isDescendantOf(f))&&!f.onSelect({e:g})&&!x.getActiveControl()){if(C){const C=x.getObjects();if(f===x){const x=this.getViewportPoint(g);if(!(f=this.searchPossibleTargets(C,x)||this.searchPossibleTargets(this._objects,x))||!f.selectable)return!1}f.group===x?(x.remove(f),this._hoveredTarget=f,this._hoveredTargets=[...this.targets],1===x.size()&&this._setActiveObject(x.item(0),g)):(x.multiSelectAdd(f),this._hoveredTarget=x,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(C,g)}else{x.exitEditing&&x.exitEditing();const C=new(X.getClass("ActiveSelection"))([],{canvas:this});C.multiSelectAdd(x,f),this._hoveredTarget=C,this._setActiveObject(C,g),this._fireSelectionEvents([x],g)}return!0}return!1}handleSelection(g){if(!this.selection||!this._groupSelector)return!1;const{x:f,y:x,deltaX:C,deltaY:w}=this._groupSelector,S=new U(f,x),T=S.add(new U(C,w)),O=S.min(T),k=S.max(T).subtract(O),D=this.collectObjects({left:O.x,top:O.y,width:k.x,height:k.y},{includeIntersecting:!this.selectionFullyContained}),M=S.eq(T)?D[0]?[D[0]]:[]:D.length>1?D.filter((f=>!f.onSelect({e:g}))).reverse():D;if(1===M.length)this.setActiveObject(M[0],g);else if(M.length>1){const f=X.getClass("ActiveSelection");this.setActiveObject(new f(M,{canvas:this}),g)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const yn={x1:0,y1:0,x2:0,y2:0},_n=e(e({},yn),{},{r1:0,r2:0}),bn=/^(\d+\.\d+)%|(\d+)%$/;function xn(g){return g&&bn.test(g)}function Cn(g,f){const x="number"==typeof g?g:"string"==typeof g?parseFloat(g)/(xn(g)?100:1):NaN;return Ie(0,V(x,f),1)}const wn=/\s*;\s*/,En=/\s*:\s*/;function Sn(g,f){let x,C;const w=g.getAttribute("style");if(w){const g=w.split(wn);""===g[g.length-1]&&g.pop();for(let f=g.length;f--;){const[w,S]=g[f].split(En).map((g=>g.trim()));"stop-color"===w?x=S:"stop-opacity"===w&&(C=S)}}const S=new At(x||g.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:Cn(g.getAttribute("offset"),0),color:S.toRgb(),opacity:V(parseFloat(C||g.getAttribute("stop-opacity")||""),1)*S.getAlpha()*f}}function Tn(g,f){const x=[],C=g.getElementsByTagName("stop"),w=Cn(f,1);for(let g=C.length;g--;)x.push(Sn(C[g],w));return x}function On(g){return"linearGradient"===g.nodeName||"LINEARGRADIENT"===g.nodeName?"linear":"radial"}function kn(g){return"userSpaceOnUse"===g.getAttribute("gradientUnits")?"pixels":"percentage"}function Dn(g,f){return g.getAttribute(f)}function Mn(g,f){return function(g,f){let x,{width:C,height:w,gradientUnits:S}=f;return Object.keys(g).reduce(((f,T)=>{const O=g[T];return"Infinity"===O?x=1:"-Infinity"===O?x=0:(x="string"==typeof O?parseFloat(O):O,"string"==typeof O&&xn(O)&&(x*=.01,"pixels"===S&&("x1"!==T&&"x2"!==T&&"r2"!==T||(x*=C),"y1"!==T&&"y2"!==T||(x*=w)))),f[T]=x,f}),{})}("linear"===On(g)?function(g){return{x1:Dn(g,"x1")||0,y1:Dn(g,"y1")||0,x2:Dn(g,"x2")||"100%",y2:Dn(g,"y2")||0}}(g):function(g){return{x1:Dn(g,"fx")||Dn(g,"cx")||"50%",y1:Dn(g,"fy")||Dn(g,"cy")||"50%",r1:0,x2:Dn(g,"cx")||"50%",y2:Dn(g,"cy")||"50%",r2:Dn(g,"r")||"50%"}}(g),e(e({},f),{},{gradientUnits:kn(g)}))}class Pn{constructor(g){let{type:f="linear",gradientUnits:x="pixels",coords:C={},colorStops:w=[],offsetX:S=0,offsetY:T=0,gradientTransform:O,id:k}=g;this.id=k?"".concat(k,"_").concat(tt()):tt(),this.type=f,this.gradientUnits=x,this.gradientTransform=O,this.offsetX=S,this.offsetY=T,this.coords=e(e({},"radial"===this.type?_n:yn),C),this.colorStops=w.slice()}addColorStop(g){for(const f in g){const x=new At(g[f]);this.colorStops.push({offset:parseFloat(f),color:x.toRgb(),opacity:x.getAlpha()})}return this}toObject(g){return e(e({},St(this,g)),{},{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(g){let{additionalTransform:f}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const x=[],C=this.gradientTransform?this.gradientTransform.concat():k.concat(),w="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox",S=this.colorStops.map((g=>e({},g))).sort(((g,f)=>g.offset-f.offset));let T=-this.offsetX,O=-this.offsetY;var D;"objectBoundingBox"===w?(T/=g.width,O/=g.height):(T+=g.width/2,O+=g.height/2),(D=g)&&"function"==typeof D._renderPathCommands&&"percentage"!==this.gradientUnits&&(T-=g.pathOffset.x,O-=g.pathOffset.y),C[4]-=T,C[5]-=O;const M=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(w,'"'),'gradientTransform="'.concat(f?f+" ":"").concat(Rt(C),'"'),""].join(" ");if("linear"===this.type){const{x1:g,y1:f,x2:C,y2:w}=this.coords;x.push("<linearGradient ",M,' x1="',g,'" y1="',f,'" x2="',C,'" y2="',w,'">\n')}else if("radial"===this.type){const{x1:g,y1:f,x2:C,y2:w,r1:T,r2:O}=this.coords,k=T>O;x.push("<radialGradient ",M,' cx="',k?g:C,'" cy="',k?f:w,'" r="',k?T:O,'" fx="',k?C:g,'" fy="',k?w:f,'">\n'),k&&(S.reverse(),S.forEach((g=>{g.offset=1-g.offset})));const D=Math.min(T,O);if(D>0){const g=D/Math.max(T,O);S.forEach((f=>{f.offset+=g*(1-f.offset)}))}}return S.forEach((g=>{let{color:f,offset:C,opacity:w}=g;x.push("<stop ",'offset="',100*C+"%",'" style="stop-color:',f,void 0!==w?";stop-opacity: "+w:";",'"/>\n')})),x.push("linear"===this.type?"</linearGradient>":"</radialGradient>","\n"),x.join("")}toLive(g){const f=this.coords,x="linear"===this.type?g.createLinearGradient(f.x1,f.y1,f.x2,f.y2):g.createRadialGradient(f.x1,f.y1,f.r1,f.x2,f.y2,f.r2);return this.colorStops.forEach((g=>{let{color:f,opacity:C,offset:w}=g;x.addColorStop(w,void 0!==C?new At(f).setAlpha(C).toRgba():f)})),x}static async fromObject(g){return new this(g)}static fromElement(g,f,x){const C=kn(g),w=f._findCenterFromElement();return new this(e({id:g.getAttribute("id")||void 0,type:On(g),coords:Mn(g,{width:x.viewBoxWidth||x.width,height:x.viewBoxHeight||x.height}),colorStops:Tn(g,x.opacity),gradientUnits:C,gradientTransform:Ji(g.getAttribute("gradientTransform")||"")},"pixels"===C?{offsetX:f.width/2-w.x,offsetY:f.height/2-w.y}:{offsetX:0,offsetY:0}))}}s(Pn,"type","Gradient"),X.setClass(Pn,"gradient"),X.setClass(Pn,"linear"),X.setClass(Pn,"radial");const Fn=["type","source"];class An{get type(){return"pattern"}set type(g){h("warn","Setting type has no effect",g)}constructor(g){s(this,"repeat","repeat"),s(this,"offsetX",0),s(this,"offsetY",0),s(this,"crossOrigin",""),s(this,"patternTransform",null),this.id=tt(),Object.assign(this,g)}isImageSource(){return!!this.source&&"string"==typeof this.source.src}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(g){return this.source&&(!this.isImageSource()||this.source.complete&&0!==this.source.naturalWidth&&0!==this.source.naturalHeight)?g.createPattern(this.source,this.repeat):null}toObject(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const{repeat:x,crossOrigin:C}=this;return e(e({},St(this,f)),{},{type:"pattern",source:this.sourceToString(),repeat:x,crossOrigin:C,offsetX:jt(this.offsetX,g.NUM_FRACTION_DIGITS),offsetY:jt(this.offsetY,g.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(g){let{width:f,height:x}=g;const{source:C,repeat:w,id:S}=this,T=V(this.offsetX/f,0),O=V(this.offsetY/x,0),k="repeat-y"===w||"no-repeat"===w?1+Math.abs(T||0):V(C.width/f,0),D="repeat-x"===w||"no-repeat"===w?1+Math.abs(O||0):V(C.height/x,0);return['<pattern id="SVGID_'.concat(S,'" x="').concat(T,'" y="').concat(O,'" width="').concat(k,'" height="').concat(D,'">'),'<image x="0" y="0" width="'.concat(C.width,'" height="').concat(C.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join("\n")}static async fromObject(g,f){let{type:x,source:C}=g,w=i(g,Fn);const S=await Ct(C,e(e({},f),{},{crossOrigin:w.crossOrigin}));return new this(e(e({},w),{},{source:S}))}}s(An,"type","Pattern"),X.setClass(An),X.setClass(An,"pattern");class jn{constructor(g){s(this,"color","rgb(0, 0, 0)"),s(this,"width",1),s(this,"shadow",null),s(this,"strokeLineCap","round"),s(this,"strokeLineJoin","round"),s(this,"strokeMiterLimit",10),s(this,"strokeDashArray",null),s(this,"limitedToCanvasSize",!1),this.canvas=g}_setBrushStyles(g){g.strokeStyle=this.color,g.lineWidth=this.width,g.lineCap=this.strokeLineCap,g.miterLimit=this.strokeMiterLimit,g.lineJoin=this.strokeLineJoin,g.setLineDash(this.strokeDashArray||[])}_saveAndTransform(g){const f=this.canvas.viewportTransform;g.save(),g.transform(f[0],f[1],f[2],f[3],f[4],f[5])}needsFullRender(){return new At(this.color).getAlpha()<1||!!this.shadow}_setShadow(){if(!this.shadow||!this.canvas)return;const g=this.canvas,f=this.shadow,x=g.contextTop,C=g.getZoom()*g.getRetinaScaling();x.shadowColor=f.color,x.shadowBlur=f.blur*C,x.shadowOffsetX=f.offsetX*C,x.shadowOffsetY=f.offsetY*C}_resetShadow(){const g=this.canvas.contextTop;g.shadowColor="",g.shadowBlur=g.shadowOffsetX=g.shadowOffsetY=0}_isOutSideCanvas(g){return g.x<0||g.x>this.canvas.getWidth()||g.y<0||g.y>this.canvas.getHeight()}}const Ln=["path","left","top"],In=["d"];class Rn extends li{constructor(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{path:x,left:C,top:w}=f,S=i(f,Ln);super(),Object.assign(this,Rn.ownDefaults),this.setOptions(S),this._setPath(g||[],!0),"number"==typeof C&&this.set(P,C),"number"==typeof w&&this.set(E,w)}_setPath(g,f){this.path=Xr(Array.isArray(g)?g:tn(g)),this.setBoundingBox(f)}_findCenterFromElement(){const g=this._calcBoundsFromPath();return new U(g.left+g.width/2,g.top+g.height/2)}_renderPathCommands(g){const f=-this.pathOffset.x,x=-this.pathOffset.y;g.beginPath();for(const C of this.path)switch(C[0]){case"L":g.lineTo(C[1]+f,C[2]+x);break;case"M":g.moveTo(C[1]+f,C[2]+x);break;case"C":g.bezierCurveTo(C[1]+f,C[2]+x,C[3]+f,C[4]+x,C[5]+f,C[6]+x);break;case"Q":g.quadraticCurveTo(C[1]+f,C[2]+x,C[3]+f,C[4]+x);break;case"Z":g.closePath()}}_render(g){this._renderPathCommands(g),this._renderPaintInOrder(g)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e(e({},super.toObject(g)),{},{path:this.path.map((g=>g.slice()))})}toDatalessObject(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const f=this.toObject(g);return this.sourcePath&&(delete f.path,f.sourcePath=this.sourcePath),f}_toSVG(){const f=sn(this.path,g.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(f,'" stroke-linecap="round" />\n')]}_getOffsetTransform(){const f=g.NUM_FRACTION_DIGITS;return" translate(".concat(jt(-this.pathOffset.x,f),", ").concat(jt(-this.pathOffset.y,f),")")}toClipPathSVG(g){const f=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:g,additionalTransform:f})}toSVG(g){const f=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:g,additionalTransform:f})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(g){const{width:f,height:x,pathOffset:C}=this._calcDimensions();this.set({width:f,height:x,pathOffset:C}),g&&this.setPositionByOrigin(C,A,A)}_calcBoundsFromPath(){const g=[];let f=0,x=0,C=0,w=0;for(const S of this.path)switch(S[0]){case"L":C=S[1],w=S[2],g.push(new U(f,x),new U(C,w));break;case"M":C=S[1],w=S[2],f=C,x=w;break;case"C":g.push(...Br(C,w,S[1],S[2],S[3],S[4],S[5],S[6])),C=S[5],w=S[6];break;case"Q":g.push(...Br(C,w,S[1],S[2],S[1],S[2],S[3],S[4])),C=S[3],w=S[4];break;case"Z":C=f,w=x}return ie(g)}_calcDimensions(){const g=this._calcBoundsFromPath();return e(e({},g),{},{pathOffset:new U(g.left+g.width/2,g.top+g.height/2)})}static fromObject(g){return this._fromObject(g,{extraParam:"path"})}static async fromElement(g,f,x){const C=er(g,this.ATTRIBUTE_NAMES,x),{d:w}=C;return new this(w,e(e(e({},i(C,In)),f),{},{left:void 0,top:void 0}))}}s(Rn,"type","Path"),s(Rn,"cacheProperties",[...ks,"path","fillRule"]),s(Rn,"ATTRIBUTE_NAMES",[...Di,"d"]),X.setClass(Rn),X.setSVGClass(Rn);class Bn extends jn{constructor(g){super(g),s(this,"decimate",.4),s(this,"drawStraightLine",!1),s(this,"straightLineKey","shiftKey"),this._points=[],this._hasStraightLine=!1}needsFullRender(){return super.needsFullRender()||this._hasStraightLine}static drawSegment(g,f,x){const C=f.midPointFrom(x);return g.quadraticCurveTo(f.x,f.y,C.x,C.y),C}onMouseDown(g,f){let{e:x}=f;this.canvas._isMainEvent(x)&&(this.drawStraightLine=!!this.straightLineKey&&x[this.straightLineKey],this._prepareForDrawing(g),this._addPoint(g),this._render())}onMouseMove(g,f){let{e:x}=f;if(this.canvas._isMainEvent(x)&&(this.drawStraightLine=!!this.straightLineKey&&x[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(g))&&this._addPoint(g)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{const g=this._points,f=g.length,x=this.canvas.contextTop;this._saveAndTransform(x),this.oldEnd&&(x.beginPath(),x.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=Bn.drawSegment(x,g[f-2],g[f-1]),x.stroke(),x.restore()}}onMouseUp(g){let{e:f}=g;return!this.canvas._isMainEvent(f)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)}_prepareForDrawing(g){this._reset(),this._addPoint(g),this.canvas.contextTop.moveTo(g.x,g.y)}_addPoint(g){return!(this._points.length>1&&g.eq(this._points[this._points.length-1]))&&(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(g),!0)}_reset(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1}_render(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.canvas.contextTop,f=this._points[0],x=this._points[1];if(this._saveAndTransform(g),g.beginPath(),2===this._points.length&&f.x===x.x&&f.y===x.y){const g=this.width/1e3;f.x-=g,x.x+=g}g.moveTo(f.x,f.y);for(let C=1;C<this._points.length;C++)Bn.drawSegment(g,f,x),f=this._points[C],x=this._points[C+1];g.lineTo(f.x,f.y),g.stroke(),g.restore()}convertPointsToSVGPath(g){const f=this.width/1e3;return en(g,f)}createPath(g){const f=new Rn(g,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,f.shadow=new ws(this.shadow)),f}decimatePoints(g,f){if(g.length<=2)return g;let x,C=g[0];const w=this.canvas.getZoom(),S=Math.pow(f/w,2),T=g.length-1,O=[C];for(let f=1;f<T-1;f++)x=Math.pow(C.x-g[f].x,2)+Math.pow(C.y-g[f].y,2),x>=S&&(C=g[f],O.push(C));return O.push(g[T]),O}_finalizeAndAddPath(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));const g=this.convertPointsToSVGPath(this._points);if(function(g){return"M 0 0 Q 0 0 0 0 L 0 0"===sn(g)}(g))return void this.canvas.requestRenderAll();const f=this.createPath(g);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:f}),this.canvas.add(f),this.canvas.requestRenderAll(),f.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:f})}}const Un=["left","top","radius"],Xn=["radius","startAngle","endAngle","counterClockwise"];class Yn extends li{static getDefaults(){return e(e({},super.getDefaults()),Yn.ownDefaults)}constructor(g){super(),Object.assign(this,Yn.ownDefaults),this.setOptions(g)}_set(g,f){return super._set(g,f),"radius"===g&&this.setRadius(f),this}_render(g){g.beginPath(),g.arc(0,0,this.radius,rt(this.startAngle),rt(this.endAngle),this.counterClockwise),this._renderPaintInOrder(g)}getRadiusX(){return this.get("radius")*this.get("scaleX")}getRadiusY(){return this.get("radius")*this.get("scaleY")}setRadius(g){this.radius=g,this.set({width:2*g,height:2*g})}toObject(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...Xn,...g])}_toSVG(){const g=(this.endAngle-this.startAngle)%360;if(0===g)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),'" />\n'];{const{radius:f}=this,x=rt(this.startAngle),C=rt(this.endAngle),w=H(x)*f,S=G(x)*f,T=H(C)*f,O=G(C)*f,k=g>180?1:0,D=this.counterClockwise?0:1;return['<path d="M '.concat(w," ").concat(S," A ").concat(f," ").concat(f," 0 ").concat(k," ").concat(D," ").concat(T," ").concat(O,'" '),"COMMON_PARTS"," />\n"]}}static async fromElement(g,f,x){const C=er(g,this.ATTRIBUTE_NAMES,x),{left:w=0,top:S=0,radius:T=0}=C;return new this(e(e({},i(C,Un)),{},{radius:T,left:w-T,top:S-T}))}static fromObject(g){return super._fromObject(g)}}s(Yn,"type","Circle"),s(Yn,"cacheProperties",[...ks,...Xn]),s(Yn,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),s(Yn,"ATTRIBUTE_NAMES",["cx","cy","r",...Di]),X.setClass(Yn),X.setSVGClass(Yn);class Wn extends jn{constructor(g){super(g),s(this,"width",10),this.points=[]}drawDot(g){const f=this.addPoint(g),x=this.canvas.contextTop;this._saveAndTransform(x),this.dot(x,f),x.restore()}dot(g,f){g.fillStyle=f.fill,g.beginPath(),g.arc(f.x,f.y,f.radius,0,2*Math.PI,!1),g.closePath(),g.fill()}onMouseDown(g){this.points=[],this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(g)}_render(){const g=this.canvas.contextTop,f=this.points;this._saveAndTransform(g);for(let x=0;x<f.length;x++)this.dot(g,f[x]);g.restore()}onMouseMove(g){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(g)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(g),this._render()):this.drawDot(g))}onMouseUp(){const g=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;const f=[];for(let g=0;g<this.points.length;g++){const x=this.points[g],C=new Yn({radius:x.radius,left:x.x,top:x.y,originX:A,originY:A,fill:x.fill});this.shadow&&(C.shadow=new ws(this.shadow)),f.push(C)}const x=new yr(f,{canvas:this.canvas});this.canvas.fire("before:path:created",{path:x}),this.canvas.add(x),this.canvas.fire("path:created",{path:x}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=g,this.canvas.requestRenderAll()}addPoint(g){let{x:f,y:x}=g;const C={x:f,y:x,radius:W(Math.max(0,this.width-20),this.width+20)/2,fill:new At(this.color).setAlpha(W(0,100)/100).toRgba()};return this.points.push(C),C}}class Vn extends jn{constructor(g){super(g),s(this,"width",10),s(this,"density",20),s(this,"dotWidth",1),s(this,"dotWidthVariance",1),s(this,"randomOpacity",!1),s(this,"optimizeOverlapping",!0),this.sprayChunks=[],this.sprayChunk=[]}onMouseDown(g){this.sprayChunks=[],this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(g),this.renderChunck(this.sprayChunk)}onMouseMove(g){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(g)||(this.addSprayChunk(g),this.renderChunck(this.sprayChunk))}onMouseUp(){const g=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;const f=[];for(let g=0;g<this.sprayChunks.length;g++){const x=this.sprayChunks[g];for(let g=0;g<x.length;g++){const C=x[g],w=new rr({width:C.width,height:C.width,left:C.x+1,top:C.y+1,originX:A,originY:A,fill:this.color});f.push(w)}}const x=new yr(this.optimizeOverlapping?function(g){const f={},x=[];for(let C,w=0;w<g.length;w++)C="".concat(g[w].left).concat(g[w].top),f[C]||(f[C]=!0,x.push(g[w]));return x}(f):f,{objectCaching:!0,subTargetCheck:!1,interactive:!1});this.shadow&&x.set("shadow",new ws(this.shadow)),this.canvas.fire("before:path:created",{path:x}),this.canvas.add(x),this.canvas.fire("path:created",{path:x}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=g,this.canvas.requestRenderAll()}renderChunck(g){const f=this.canvas.contextTop;f.fillStyle=this.color,this._saveAndTransform(f);for(let x=0;x<g.length;x++){const C=g[x];f.globalAlpha=C.opacity,f.fillRect(C.x,C.y,C.width,C.width)}f.restore()}_render(){const g=this.canvas.contextTop;g.fillStyle=this.color,this._saveAndTransform(g);for(let g=0;g<this.sprayChunks.length;g++)this.renderChunck(this.sprayChunks[g]);g.restore()}addSprayChunk(g){this.sprayChunk=[];const f=this.width/2;for(let x=0;x<this.density;x++)this.sprayChunk.push({x:W(g.x-f,g.x+f),y:W(g.y-f,g.y+f),width:this.dotWidthVariance?W(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,opacity:this.randomOpacity?W(0,100)/100:1});this.sprayChunks.push(this.sprayChunk)}}class zn extends Bn{constructor(g){super(g)}getPatternSrc(){const g=et(),f=g.getContext("2d");return g.width=g.height=25,f&&(f.fillStyle=this.color,f.beginPath(),f.arc(10,10,10,0,2*Math.PI,!1),f.closePath(),f.fill()),g}getPattern(g){return g.createPattern(this.source||this.getPatternSrc(),"repeat")}_setBrushStyles(g){super._setBrushStyles(g);const f=this.getPattern(g);f&&(g.strokeStyle=f)}createPath(g){const f=super.createPath(g),x=f._getLeftTopCoords().scalarAdd(f.strokeWidth/2);return f.stroke=new An({source:this.source||this.getPatternSrc(),offsetX:-x.x,offsetY:-x.y}),f}}const Hn=["x1","y1","x2","y2"],Gn=["x1","y1","x2","y2"],Kn=["x1","x2","y1","y2"];class Nn extends li{constructor(){let[g,f,x,C]=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0],w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,Nn.ownDefaults),this.setOptions(w),this.x1=g,this.x2=x,this.y1=f,this.y2=C,this._setWidthHeight();const{left:S,top:T}=w;"number"==typeof S&&this.set(P,S),"number"==typeof T&&this.set(E,T)}_setWidthHeight(){const{x1:g,y1:f,x2:x,y2:C}=this;this.width=Math.abs(x-g),this.height=Math.abs(C-f);const{left:w,top:S,width:T,height:O}=ie([{x:g,y:f},{x:x,y:C}]),k=new U(w+T/2,S+O/2);this.setPositionByOrigin(k,A,A)}_set(g,f){return super._set(g,f),Kn.includes(g)&&this._setWidthHeight(),this}_render(g){g.beginPath();const f=this.calcLinePoints();g.moveTo(f.x1,f.y1),g.lineTo(f.x2,f.y2),g.lineWidth=this.strokeWidth;const x=g.strokeStyle;var C;It(this.stroke)?g.strokeStyle=this.stroke.toLive(g):g.strokeStyle=null!==(C=this.stroke)&&void 0!==C?C:g.fillStyle;this.stroke&&this._renderStroke(g),g.strokeStyle=x}_findCenterFromElement(){return new U((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e(e({},super.toObject(g)),this.calcLinePoints())}_getNonTransformedDimensions(){const g=super._getNonTransformedDimensions();return"butt"===this.strokeLineCap&&(0===this.width&&(g.y-=this.strokeWidth),0===this.height&&(g.x-=this.strokeWidth)),g}calcLinePoints(){const{x1:g,x2:f,y1:x,y2:C,width:w,height:S}=this,T=g<=f?-1:1,O=x<=C?-1:1;return{x1:T*w/2,x2:T*-w/2,y1:O*S/2,y2:O*-S/2}}_toSVG(){const{x1:g,x2:f,y1:x,y2:C}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(g,'" y1="').concat(x,'" x2="').concat(f,'" y2="').concat(C,'" />\n')]}static async fromElement(g,f,x){const C=er(g,this.ATTRIBUTE_NAMES,x),{x1:w=0,y1:S=0,x2:T=0,y2:O=0}=C;return new this([w,S,T,O],i(C,Hn))}static fromObject(g){let{x1:f,y1:x,x2:C,y2:w}=g,S=i(g,Gn);return this._fromObject(e(e({},S),{},{points:[f,x,C,w]}),{extraParam:"points"})}}s(Nn,"type","Line"),s(Nn,"cacheProperties",[...ks,...Kn]),s(Nn,"ATTRIBUTE_NAMES",Di.concat(Kn)),X.setClass(Nn),X.setSVGClass(Nn);class qn extends li{static getDefaults(){return e(e({},super.getDefaults()),qn.ownDefaults)}constructor(g){super(),Object.assign(this,qn.ownDefaults),this.setOptions(g)}_render(g){const f=this.width/2,x=this.height/2;g.beginPath(),g.moveTo(-f,x),g.lineTo(0,-x),g.lineTo(f,x),g.closePath(),this._renderPaintInOrder(g)}_toSVG(){const g=this.width/2,f=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-g," ").concat(f,",0 ").concat(-f,",").concat(g," ").concat(f),'" />']}}s(qn,"type","Triangle"),s(qn,"ownDefaults",{width:100,height:100}),X.setClass(qn),X.setSVGClass(qn);const Qn=["rx","ry"];class Jn extends li{static getDefaults(){return e(e({},super.getDefaults()),Jn.ownDefaults)}constructor(g){super(),Object.assign(this,Jn.ownDefaults),this.setOptions(g)}_set(g,f){switch(super._set(g,f),g){case"rx":this.rx=f,this.set("width",2*f);break;case"ry":this.ry=f,this.set("height",2*f)}return this}getRx(){return this.get("rx")*this.get("scaleX")}getRy(){return this.get("ry")*this.get("scaleY")}toObject(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...Qn,...g])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,'" />\n')]}_render(g){g.beginPath(),g.save(),g.transform(1,0,0,this.ry/this.rx,0,0),g.arc(0,0,this.rx,0,T,!1),g.restore(),this._renderPaintInOrder(g)}static async fromElement(g,f,x){const C=er(g,this.ATTRIBUTE_NAMES,x);return C.left=(C.left||0)-C.rx,C.top=(C.top||0)-C.ry,new this(C)}}function Zn(g){if(!g)return[];const f=g.replace(/,/g," ").trim().split(/\s+/),x=[];for(let g=0;g<f.length;g+=2)x.push({x:parseFloat(f[g]),y:parseFloat(f[g+1])});return x}s(Jn,"type","Ellipse"),s(Jn,"cacheProperties",[...ks,...Qn]),s(Jn,"ownDefaults",{rx:0,ry:0}),s(Jn,"ATTRIBUTE_NAMES",[...Di,"cx","cy","rx","ry"]),X.setClass(Jn),X.setSVGClass(Jn);const $n=["left","top"],so={exactBoundingBox:!1};class to extends li{static getDefaults(){return e(e({},super.getDefaults()),to.ownDefaults)}constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),s(this,"strokeDiff",void 0),Object.assign(this,to.ownDefaults),this.setOptions(f),this.points=g;const{left:x,top:C}=f;this.initialized=!0,this.setBoundingBox(!0),"number"==typeof x&&this.set(P,x),"number"==typeof C&&this.set(E,C)}isOpen(){return!0}_projectStrokeOnPoints(g){return mi(this.points,g,this.isOpen())}_calcDimensions(g){g=e({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},g||{});const f=this.exactBoundingBox?this._projectStrokeOnPoints(g).map((g=>g.projectedPoint)):this.points;if(0===f.length)return{left:0,top:0,width:0,height:0,pathOffset:new U,strokeOffset:new U,strokeDiff:new U};const x=ie(f),C=_t(e(e({},g),{},{scaleX:1,scaleY:1})),w=ie(this.points.map((g=>at(g,C,!0)))),S=new U(this.scaleX,this.scaleY);let T=x.left+x.width/2,O=x.top+x.height/2;return this.exactBoundingBox&&(T-=O*Math.tan(rt(this.skewX)),O-=T*Math.tan(rt(this.skewY))),e(e({},x),{},{pathOffset:new U(T,O),strokeOffset:new U(w.left,w.top).subtract(new U(x.left,x.top)).multiply(S),strokeDiff:new U(x.width,x.height).subtract(new U(w.width,w.height)).multiply(S)})}_findCenterFromElement(){const g=ie(this.points);return new U(g.left+g.width/2,g.top+g.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(g){const{left:f,top:x,width:C,height:w,pathOffset:S,strokeOffset:T,strokeDiff:O}=this._calcDimensions();this.set({width:C,height:w,pathOffset:S,strokeOffset:T,strokeDiff:O}),g&&this.setPositionByOrigin(new U(f+C/2,x+w/2),A,A)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new U(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.exactBoundingBox){let S;if(Object.keys(g).some((g=>this.strokeUniform||this.constructor.layoutProperties.includes(g)))){var f,x;const{width:C,height:w}=this._calcDimensions(g);S=new U(null!==(f=g.width)&&void 0!==f?f:C,null!==(x=g.height)&&void 0!==x?x:w)}else{var C,w;S=new U(null!==(C=g.width)&&void 0!==C?C:this.width,null!==(w=g.height)&&void 0!==w?w:this.height)}return S.multiply(new U(g.scaleX||this.scaleX,g.scaleY||this.scaleY))}return super._getTransformedDimensions(g)}_set(g,f){const x=this.initialized&&this[g]!==f,C=super._set(g,f);return this.exactBoundingBox&&x&&(("scaleX"===g||"scaleY"===g)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(g))&&this.setDimensions(),C}toObject(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e(e({},super.toObject(g)),{},{points:Ss(this.points)})}_toSVG(){const f=[],x=this.pathOffset.x,C=this.pathOffset.y,w=g.NUM_FRACTION_DIGITS;for(let g=0,S=this.points.length;g<S;g++)f.push(jt(this.points[g].x-x,w),",",jt(this.points[g].y-C,w)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(f.join(""),'" />\n')]}_render(g){const f=this.points.length,x=this.pathOffset.x,C=this.pathOffset.y;if(f&&!isNaN(this.points[f-1].y)){g.beginPath(),g.moveTo(this.points[0].x-x,this.points[0].y-C);for(let w=0;w<f;w++){const f=this.points[w];g.lineTo(f.x-x,f.y-C)}!this.isOpen()&&g.closePath(),this._renderPaintInOrder(g)}}complexity(){return this.points.length}static async fromElement(g,f,x){return new this(Zn(g.getAttribute("points")),e(e({},i(er(g,this.ATTRIBUTE_NAMES,x),$n)),f))}static fromObject(g){return this._fromObject(g,{extraParam:"points"})}}s(to,"ownDefaults",so),s(to,"type","Polyline"),s(to,"layoutProperties",["skewX","skewY","strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),s(to,"cacheProperties",[...ks,"points"]),s(to,"ATTRIBUTE_NAMES",[...Di]),X.setClass(to),X.setSVGClass(to);class eo extends to{isOpen(){return!1}}s(eo,"ownDefaults",so),s(eo,"type","Polygon"),X.setClass(eo),X.setSVGClass(eo);const io=["fontSize","fontWeight","fontFamily","fontStyle"],ro=["underline","overline","linethrough"],no=[...io,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],oo=[...no,...ro,"textBackgroundColor","direction"],ao=[...io,...ro,"stroke","strokeWidth","fill","deltaY","textBackgroundColor"],ho={_reNewline:R,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:P,fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:P,pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2},co="justify",lo="justify-left",uo="justify-right",fo="justify-center";class go extends li{isEmptyStyles(g){if(!this.styles)return!0;if(void 0!==g&&!this.styles[g])return!0;const f=void 0===g?this.styles:{line:this.styles[g]};for(const g in f)for(const x in f[g])for(const C in f[g][x])return!1;return!0}styleHas(g,f){if(!this.styles)return!1;if(void 0!==f&&!this.styles[f])return!1;const x=void 0===f?this.styles:{0:this.styles[f]};for(const f in x)for(const C in x[f])if(void 0!==x[f][C][g])return!0;return!1}cleanStyle(g){if(!this.styles)return!1;const f=this.styles;let x,C,w=0,S=!0,T=0;for(const T in f){x=0;for(const O in f[T]){const k=f[T][O]||{};w++,void 0!==k[g]?(C?k[g]!==C&&(S=!1):C=k[g],k[g]===this[g]&&delete k[g]):S=!1,0!==Object.keys(k).length?x++:delete f[T][O]}0===x&&delete f[T]}for(let g=0;g<this._textLines.length;g++)T+=this._textLines[g].length;S&&w===T&&(this[g]=C,this.removeStyle(g))}removeStyle(g){if(!this.styles)return;const f=this.styles;let x,C,w;for(C in f){for(w in x=f[C],x)delete x[w][g],0===Object.keys(x[w]).length&&delete x[w];0===Object.keys(x).length&&delete f[C]}}_extendStyles(g,f){const{lineIndex:x,charIndex:C}=this.get2DCursorLocation(g);this._getLineStyle(x)||this._setLineStyle(x);const w=Tt(e(e({},this._getStyleDeclaration(x,C)),f),(g=>void 0!==g));this._setStyleDeclaration(x,C,w)}getSelectionStyles(g,f,x){const C=[];for(let w=g;w<(f||g);w++)C.push(this.getStyleAtPosition(w,x));return C}getStyleAtPosition(g,f){const{lineIndex:x,charIndex:C}=this.get2DCursorLocation(g);return f?this.getCompleteStyleDeclaration(x,C):this._getStyleDeclaration(x,C)}setSelectionStyles(g,f,x){for(let C=f;C<(x||f);C++)this._extendStyles(C,g);this._forceClearCache=!0}_getStyleDeclaration(g,f){var x;const C=this.styles&&this.styles[g];return C&&null!==(x=C[f])&&void 0!==x?x:{}}getCompleteStyleDeclaration(g,f){return e(e({},St(this,this.constructor._styleProperties)),this._getStyleDeclaration(g,f))}_setStyleDeclaration(g,f,x){this.styles[g][f]=x}_deleteStyleDeclaration(g,f){delete this.styles[g][f]}_getLineStyle(g){return!!this.styles[g]}_setLineStyle(g){this.styles[g]={}}_deleteLineStyle(g){delete this.styles[g]}}s(go,"_styleProperties",ao);const po=/  +/g,vo=/"/g;function mo(f,x,C,w,S){return"\t\t".concat(function(f,x){let{left:C,top:w,width:S,height:T}=x,O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.NUM_FRACTION_DIGITS;const k=Bt("fill",f,!1),[D,M,A,P]=[C,w,S,T].map((g=>jt(g,O)));return"<rect ".concat(k,' x="').concat(D,'" y="').concat(M,'" width="').concat(A,'" height="').concat(P,'"></rect>')}(f,{left:x,top:C,width:w,height:S}),"\n")}const yo=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let Co;class _o extends go{static getDefaults(){return e(e({},super.getDefaults()),_o.ownDefaults)}constructor(g,f){super(),s(this,"__charBounds",[]),Object.assign(this,_o.ownDefaults),this.setOptions(f),this.styles||(this.styles={}),this.text=g,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const g=this.path;g&&(g.segmentsInfo=Jr(g.path))}_splitText(){const g=this._splitTextIntoLines(this.text);return this.textLines=g.lines,this._textLines=g.graphemeLines,this._unwrappedTextLines=g._unwrappedLines,this._text=g.graphemeText,g}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(co)&&this.enlargeSpaces()}enlargeSpaces(){let g,f,x,C,w,S,T;for(let O=0,k=this._textLines.length;O<k;O++)if((this.textAlign===co||O!==k-1&&!this.isEndOfWrapping(O))&&(C=0,w=this._textLines[O],f=this.getLineWidth(O),f<this.width&&(T=this.textLines[O].match(this._reSpacesAndTabs)))){x=T.length,g=(this.width-f)/x;for(let f=0;f<=w.length;f++)S=this.__charBounds[O][f],this._reSpaceAndTab.test(w[f])?(S.width+=g,S.kernedWidth+=g,S.left+=C,C+=g):S.left+=C}}isEndOfWrapping(g){return g===this._textLines.length-1}missingNewlineOffset(g){return 1}get2DCursorLocation(g,f){const x=f?this._unwrappedTextLines:this._textLines;let C;for(C=0;C<x.length;C++){if(g<=x[C].length)return{lineIndex:C,charIndex:g};g-=x[C].length+this.missingNewlineOffset(C,f)}return{lineIndex:C-1,charIndex:x[C-1].length<g?x[C-1].length:g}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const g=super._getCacheCanvasDimensions(),f=this.fontSize;return g.width+=f*g.zoomX,g.height+=f*g.zoomY,g}_render(g){const f=this.path;f&&!f.isNotVisible()&&f._render(g),this._setTextStyles(g),this._renderTextLinesBackground(g),this._renderTextDecoration(g,"underline"),this._renderText(g),this._renderTextDecoration(g,"overline"),this._renderTextDecoration(g,"linethrough")}_renderText(g){"stroke"===this.paintFirst?(this._renderTextStroke(g),this._renderTextFill(g)):(this._renderTextFill(g),this._renderTextStroke(g))}_setTextStyles(g,f,x){if(g.textBaseline="alphabetic",this.path)switch(this.pathAlign){case A:g.textBaseline="middle";break;case"ascender":g.textBaseline=E;break;case"descender":g.textBaseline=j}g.font=this._getFontDeclaration(f,x)}calcTextWidth(){let g=this.getLineWidth(0);for(let f=1,x=this._textLines.length;f<x;f++){const x=this.getLineWidth(f);x>g&&(g=x)}return g}_renderTextLine(g,f,x,C,w,S){this._renderChars(g,f,x,C,w,S)}_renderTextLinesBackground(g){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const f=g.fillStyle,x=this._getLeftOffset();let C=this._getTopOffset();for(let f=0,w=this._textLines.length;f<w;f++){const w=this.getHeightOfLine(f);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",f)){C+=w;continue}const S=this._textLines[f].length,T=this._getLineLeftOffset(f);let O,k,D=0,M=0,A=this.getValueOfPropertyAt(f,0,"textBackgroundColor");for(let P=0;P<S;P++){const S=this.__charBounds[f][P];k=this.getValueOfPropertyAt(f,P,"textBackgroundColor"),this.path?(g.save(),g.translate(S.renderLeft,S.renderTop),g.rotate(S.angle),g.fillStyle=k,k&&g.fillRect(-S.width/2,-w/this.lineHeight*(1-this._fontSizeFraction),S.width,w/this.lineHeight),g.restore()):k!==A?(O=x+T+M,"rtl"===this.direction&&(O=this.width-O-D),g.fillStyle=A,A&&g.fillRect(O,C,D,w/this.lineHeight),M=S.left,D=S.width,A=k):D+=S.kernedWidth}k&&!this.path&&(O=x+T+M,"rtl"===this.direction&&(O=this.width-O-D),g.fillStyle=k,g.fillRect(O,C,D,w/this.lineHeight)),C+=w}g.fillStyle=f,this._removeShadow(g)}_measureChar(g,f,x,w){const S=C.getFontCache(f),T=this._getFontDeclaration(f),O=x+g,k=x&&T===this._getFontDeclaration(w),D=f.fontSize/this.CACHE_FONT_SIZE;let M,A,P,E;if(x&&void 0!==S[x]&&(P=S[x]),void 0!==S[g]&&(E=M=S[g]),k&&void 0!==S[O]&&(A=S[O],E=A-P),void 0===M||void 0===P||void 0===A){const C=function(){if(!Co){const g=et();g.width=g.height=0,Co=g.getContext("2d")}return Co}();this._setTextStyles(C,f,!0),void 0===M&&(E=M=C.measureText(g).width,S[g]=M),void 0===P&&k&&x&&(P=C.measureText(x).width,S[x]=P),k&&void 0===A&&(A=C.measureText(O).width,S[O]=A,E=A-P)}return{width:M*D,kernedWidth:E*D}}getHeightOfChar(g,f){return this.getValueOfPropertyAt(g,f,"fontSize")}measureLine(g){const f=this._measureLine(g);return 0!==this.charSpacing&&(f.width-=this._getWidthOfCharSpacing()),f.width<0&&(f.width=0),f}_measureLine(g){let f,x,C=0;const w=this.pathSide===F,S=this.path,T=this._textLines[g],O=T.length,k=new Array(O);this.__charBounds[g]=k;for(let w=0;w<O;w++){const S=T[w];x=this._getGraphemeBox(S,g,w,f),k[w]=x,C+=x.kernedWidth,f=S}if(k[O]={left:x?x.left+x.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},S&&S.segmentsInfo){let g=0;const f=S.segmentsInfo[S.segmentsInfo.length-1].length;switch(this.textAlign){case P:g=w?f-C:0;break;case A:g=(f-C)/2;break;case F:g=w?0:f-C}g+=this.pathStartOffset*(w?-1:1);for(let C=w?O-1:0;w?C>=0:C<O;w?C--:C++)x=k[C],g>f?g%=f:g<0&&(g+=f),this._setGraphemeOnPath(g,x),g+=x.kernedWidth}return{width:C,numOfSpaces:0}}_setGraphemeOnPath(g,f){const x=g+f.kernedWidth/2,C=this.path,w=Zr(C.path,x,C.segmentsInfo);f.renderLeft=w.x-C.pathOffset.x,f.renderTop=w.y-C.pathOffset.y,f.angle=w.angle+(this.pathSide===F?Math.PI:0)}_getGraphemeBox(g,f,x,C,w){const S=this.getCompleteStyleDeclaration(f,x),T=C?this.getCompleteStyleDeclaration(f,x-1):{},O=this._measureChar(g,S,C,T);let k,D=O.kernedWidth,M=O.width;0!==this.charSpacing&&(k=this._getWidthOfCharSpacing(),M+=k,D+=k);const A={width:M,left:0,height:S.fontSize,kernedWidth:D,deltaY:S.deltaY};if(x>0&&!w){const g=this.__charBounds[f][x-1];A.left=g.left+g.width+O.kernedWidth-O.width}return A}getHeightOfLine(g){if(this.__lineHeights[g])return this.__lineHeights[g];let f=this.getHeightOfChar(g,0);for(let x=1,C=this._textLines[g].length;x<C;x++)f=Math.max(this.getHeightOfChar(g,x),f);return this.__lineHeights[g]=f*this.lineHeight*this._fontSizeMult}calcTextHeight(){let g,f=0;for(let x=0,C=this._textLines.length;x<C;x++)g=this.getHeightOfLine(x),f+=x===C-1?g/this.lineHeight:g;return f}_getLeftOffset(){return"ltr"===this.direction?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(g,f){g.save();let x=0;const C=this._getLeftOffset(),w=this._getTopOffset();for(let S=0,T=this._textLines.length;S<T;S++){const T=this.getHeightOfLine(S),O=T/this.lineHeight,k=this._getLineLeftOffset(S);this._renderTextLine(f,g,this._textLines[S],C+k,w+x+O,S),x+=T}g.restore()}_renderTextFill(g){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(g,"fillText")}_renderTextStroke(g){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(g),g.save(),this._setLineDash(g,this.strokeDashArray),g.beginPath(),this._renderTextCommon(g,"strokeText"),g.closePath(),g.restore())}_renderChars(g,f,x,C,w,S){const T=this.getHeightOfLine(S),O=this.textAlign.includes(co),k=this.path,D=!O&&0===this.charSpacing&&this.isEmptyStyles(S)&&!k,M="ltr"===this.direction,A="ltr"===this.direction?1:-1,E=f.direction;let j,L,R,B,I,X="",N=0;if(f.save(),E!==this.direction&&(f.canvas.setAttribute("dir",M?"ltr":"rtl"),f.direction=M?"ltr":"rtl",f.textAlign=M?P:F),w-=T*this._fontSizeFraction/this.lineHeight,D)return this._renderChar(g,f,S,0,x.join(""),C,w),void f.restore();for(let T=0,D=x.length-1;T<=D;T++)B=T===D||this.charSpacing||k,X+=x[T],R=this.__charBounds[S][T],0===N?(C+=A*(R.kernedWidth-R.width),N+=R.width):N+=R.kernedWidth,O&&!B&&this._reSpaceAndTab.test(x[T])&&(B=!0),B||(j=j||this.getCompleteStyleDeclaration(S,T),L=this.getCompleteStyleDeclaration(S,T+1),B=Ci(j,L,!1)),B&&(k?(f.save(),f.translate(R.renderLeft,R.renderTop),f.rotate(R.angle),this._renderChar(g,f,S,T,X,-N/2,0),f.restore()):(I=C,this._renderChar(g,f,S,T,X,I,w)),X="",j=L,C+=A*N,N=0);f.restore()}_applyPatternGradientTransformText(g){const f=et(),x=this.width+this.strokeWidth,C=this.height+this.strokeWidth,w=f.getContext("2d");return f.width=x,f.height=C,w.beginPath(),w.moveTo(0,0),w.lineTo(x,0),w.lineTo(x,C),w.lineTo(0,C),w.closePath(),w.translate(x/2,C/2),w.fillStyle=g.toLive(w),this._applyPatternGradientTransform(w,g),w.fill(),w.createPattern(f,"no-repeat")}handleFiller(g,f,x){let C,w;return It(x)?"percentage"===x.gradientUnits||x.gradientTransform||x.patternTransform?(C=-this.width/2,w=-this.height/2,g.translate(C,w),g[f]=this._applyPatternGradientTransformText(x),{offsetX:C,offsetY:w}):(g[f]=x.toLive(g),this._applyPatternGradientTransform(g,x)):(g[f]=x,{offsetX:0,offsetY:0})}_setStrokeStyles(g,f){let{stroke:x,strokeWidth:C}=f;return g.lineWidth=C,g.lineCap=this.strokeLineCap,g.lineDashOffset=this.strokeDashOffset,g.lineJoin=this.strokeLineJoin,g.miterLimit=this.strokeMiterLimit,this.handleFiller(g,"strokeStyle",x)}_setFillStyles(g,f){let{fill:x}=f;return this.handleFiller(g,"fillStyle",x)}_renderChar(g,f,x,C,w,S,T){const O=this._getStyleDeclaration(x,C),k=this.getCompleteStyleDeclaration(x,C),D="fillText"===g&&k.fill,M="strokeText"===g&&k.stroke&&k.strokeWidth;if(M||D){if(f.save(),f.font=this._getFontDeclaration(k),O.textBackgroundColor&&this._removeShadow(f),O.deltaY&&(T+=O.deltaY),D){const g=this._setFillStyles(f,k);f.fillText(w,S-g.offsetX,T-g.offsetY)}if(M){const g=this._setStrokeStyles(f,k);f.strokeText(w,S-g.offsetX,T-g.offsetY)}f.restore()}}setSuperscript(g,f){this._setScript(g,f,this.superscript)}setSubscript(g,f){this._setScript(g,f,this.subscript)}_setScript(g,f,x){const C=this.get2DCursorLocation(g,!0),w=this.getValueOfPropertyAt(C.lineIndex,C.charIndex,"fontSize"),S=this.getValueOfPropertyAt(C.lineIndex,C.charIndex,"deltaY"),T={fontSize:w*x.size,deltaY:S+w*x.baseline};this.setSelectionStyles(T,g,f)}_getLineLeftOffset(g){const f=this.getLineWidth(g),x=this.width-f,C=this.textAlign,w=this.direction,S=this.isEndOfWrapping(g);let T=0;return C===co||C===fo&&!S||C===uo&&!S||C===lo&&!S?0:(C===A&&(T=x/2),C===F&&(T=x),C===fo&&(T=x/2),C===uo&&(T=x),"rtl"===w&&(C===F||C===co||C===uo?T=0:C===P||C===lo?T=-x:C!==A&&C!==fo||(T=-x/2)),T)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(g){if(void 0!==this.__lineWidths[g])return this.__lineWidths[g];const{width:f}=this.measureLine(g);return this.__lineWidths[g]=f,f}_getWidthOfCharSpacing(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(g,f,x){var C;return null!==(C=this._getStyleDeclaration(g,f)[x])&&void 0!==C?C:this[x]}_renderTextDecoration(g,f){if(!this[f]&&!this.styleHas(f))return;let x=this._getTopOffset();const C=this._getLeftOffset(),w=this.path,S=this._getWidthOfCharSpacing(),T=this.offsets[f];for(let O=0,k=this._textLines.length;O<k;O++){const k=this.getHeightOfLine(O);if(!this[f]&&!this.styleHas(f,O)){x+=k;continue}const D=this._textLines[O],M=k/this.lineHeight,A=this._getLineLeftOffset(O);let P,E,j=0,F=0,L=this.getValueOfPropertyAt(O,0,f),R=this.getValueOfPropertyAt(O,0,"fill");const B=x+M*(1-this._fontSizeFraction);let I=this.getHeightOfChar(O,0),X=this.getValueOfPropertyAt(O,0,"deltaY");for(let x=0,S=D.length;x<S;x++){const S=this.__charBounds[O][x];P=this.getValueOfPropertyAt(O,x,f),E=this.getValueOfPropertyAt(O,x,"fill");const k=this.getHeightOfChar(O,x),D=this.getValueOfPropertyAt(O,x,"deltaY");if(w&&P&&E)g.save(),g.fillStyle=R,g.translate(S.renderLeft,S.renderTop),g.rotate(S.angle),g.fillRect(-S.kernedWidth/2,T*k+D,S.kernedWidth,this.fontSize/15),g.restore();else if((P!==L||E!==R||k!==I||D!==X)&&F>0){let f=C+A+j;"rtl"===this.direction&&(f=this.width-f-F),L&&R&&(g.fillStyle=R,g.fillRect(f,B+T*I+X,F,this.fontSize/15)),j=S.left,F=S.width,L=P,R=E,I=k,X=D}else F+=S.kernedWidth}let N=C+A+j;"rtl"===this.direction&&(N=this.width-N-F),g.fillStyle=E,P&&E&&g.fillRect(N,B+T*I+X,F-S,this.fontSize/15),x+=k}this._removeShadow(g)}_getFontDeclaration(){let{fontFamily:g=this.fontFamily,fontStyle:f=this.fontStyle,fontWeight:x=this.fontWeight,fontSize:C=this.fontSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},w=arguments.length>1?arguments[1]:void 0;const S=g.includes("'")||g.includes('"')||g.includes(",")||_o.genericFonts.includes(g.toLowerCase())?g:'"'.concat(g,'"');return[f,x,"".concat(w?this.CACHE_FONT_SIZE:C,"px"),S].join(" ")}render(g){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(g)))}graphemeSplit(g){return yi(g)}_splitTextIntoLines(g){const f=g.split(this._reNewline),x=new Array(f.length),C=["\n"];let w=[];for(let g=0;g<f.length;g++)x[g]=this.graphemeSplit(f[g]),w=w.concat(x[g],C);return w.pop(),{_unwrappedLines:x,lines:f,graphemeText:w,graphemeLines:x}}toObject(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e(e({},super.toObject([...oo,...g])),{},{styles:bi(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(g,f){const{textLayoutProperties:x}=this.constructor;super.set(g,f);let C=!1,w=!1;if("object"==typeof g)for(const f in g)"path"===f&&this.setPathInfo(),C=C||x.includes(f),w=w||"path"===f;else C=x.includes(g),w="path"===g;return w&&this.setPathInfo(),C&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(g,f,x){const C=er(g,_o.ATTRIBUTE_NAMES,x),w=e(e({},f),C),{textAnchor:S=P,textDecoration:T="",dx:O=0,dy:k=0,top:M=0,left:E=0,fontSize:j=D,strokeWidth:L=1}=w,R=i(w,yo),B=new this((g.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),e({left:E+O,top:M+k,underline:T.includes("underline"),overline:T.includes("overline"),linethrough:T.includes("line-through"),strokeWidth:0,fontSize:j},R)),I=B.getScaledHeight()/B.height,X=((B.height+B.strokeWidth)*B.lineHeight-B.height)*I,N=B.getScaledHeight()+X;let $=0;return S===A&&($=B.getScaledWidth()/2),S===F&&($=B.getScaledWidth()),B.set({left:B.left-$,top:B.top-(N-B.fontSize*(.07+B._fontSizeFraction))/B.lineHeight,strokeWidth:L}),B}static fromObject(g){return this._fromObject(e(e({},g),{},{styles:wi(g.styles||{},g.text)}),{extraParam:"text"})}}s(_o,"textLayoutProperties",no),s(_o,"cacheProperties",[...ks,...oo]),s(_o,"ownDefaults",ho),s(_o,"type","Text"),s(_o,"genericFonts",["sans-serif","serif","cursive","fantasy","monospace"]),s(_o,"ATTRIBUTE_NAMES",Di.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),ci(_o,[class extends Te{_toSVG(){const g=this._getSVGLeftTopOffsets(),f=this._getSVGTextAndBg(g.textTop,g.textLeft);return this._wrapSVGTextAndBg(f)}toSVG(g){return this._createBaseSVGMarkup(this._toSVG(),{reviver:g,noStyle:!0,withShadow:!0})}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(g){let{textBgRects:f,textSpans:x}=g;const C=this.getSvgTextDecoration(this);return[f.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'.concat(this.fontFamily.replace(vo,"'"),'" '):"",this.fontSize?'font-size="'.concat(this.fontSize,'" '):"",this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",C?'text-decoration="'.concat(C,'" '):"","rtl"===this.direction?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",x.join(""),"</text>\n"]}_getSVGTextAndBg(g,f){const x=[],C=[];let w,S=g;this.backgroundColor&&C.push(...mo(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let g=0,T=this._textLines.length;g<T;g++)w=this._getLineLeftOffset(g),"rtl"===this.direction&&(w+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",g))&&this._setSVGTextLineBg(C,g,f+w,S),this._setSVGTextLineText(x,g,f+w,S),S+=this.getHeightOfLine(g);return{textSpans:x,textBgRects:C}}_createTextCharSpan(f,x,C,w){const S=this.getSvgSpanStyles(x,f!==f.trim()||!!f.match(po)),T=S?'style="'.concat(S,'"'):"",O=x.deltaY,k=O?' dy="'.concat(jt(O,g.NUM_FRACTION_DIGITS),'" '):"";return'<tspan x="'.concat(jt(C,g.NUM_FRACTION_DIGITS),'" y="').concat(jt(w,g.NUM_FRACTION_DIGITS),'" ').concat(k).concat(T,">").concat(vi(f),"</tspan>")}_setSVGTextLineText(g,f,x,C){const w=this.getHeightOfLine(f),S=this.textAlign.includes(co),T=this._textLines[f];let O,k,D,M,A,P="",E=0;C+=w*(1-this._fontSizeFraction)/this.lineHeight;for(let w=0,j=T.length-1;w<=j;w++)A=w===j||this.charSpacing,P+=T[w],D=this.__charBounds[f][w],0===E?(x+=D.kernedWidth-D.width,E+=D.width):E+=D.kernedWidth,S&&!A&&this._reSpaceAndTab.test(T[w])&&(A=!0),A||(O=O||this.getCompleteStyleDeclaration(f,w),k=this.getCompleteStyleDeclaration(f,w+1),A=Ci(O,k,!0)),A&&(M=this._getStyleDeclaration(f,w),g.push(this._createTextCharSpan(P,M,x,C)),P="",O=k,"rtl"===this.direction?x-=E:x+=E,E=0)}_setSVGTextLineBg(g,f,x,C){const w=this._textLines[f],S=this.getHeightOfLine(f)/this.lineHeight;let T,O=0,k=0,D=this.getValueOfPropertyAt(f,0,"textBackgroundColor");for(let M=0;M<w.length;M++){const{left:w,width:A,kernedWidth:P}=this.__charBounds[f][M];T=this.getValueOfPropertyAt(f,M,"textBackgroundColor"),T!==D?(D&&g.push(...mo(D,x+k,C,O,S)),k=w,O=A,D=T):O+=P}T&&g.push(...mo(D,x+k,C,O,S))}_getSVGLineTopOffset(g){let f,x=0;for(f=0;f<g;f++)x+=this.getHeightOfLine(f);const C=this.getHeightOfLine(f);return{lineTop:x,offset:(this._fontSizeMult-this._fontSizeFraction)*C/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(g){return"".concat(super.getSvgStyles(g)," white-space: pre;")}getSvgSpanStyles(g,f){const{fontFamily:x,strokeWidth:C,stroke:w,fill:S,fontSize:T,fontStyle:O,fontWeight:k,deltaY:D}=g,M=this.getSvgTextDecoration(g);return[w?Bt("stroke",w):"",C?"stroke-width: ".concat(C,"; "):"",x?"font-family: ".concat(x.includes("'")||x.includes('"')?x:"'".concat(x,"'"),"; "):"",T?"font-size: ".concat(T,"px; "):"",O?"font-style: ".concat(O,"; "):"",k?"font-weight: ".concat(k,"; "):"",M?"text-decoration: ".concat(M,"; "):M,S?Bt("fill",S):"",D?"baseline-shift: ".concat(-D,"; "):"",f?"white-space: pre; ":""].join("")}getSvgTextDecoration(g){return["overline","underline","line-through"].filter((f=>g[f.replace("-","")])).join(" ")}}]),X.setClass(_o),X.setSVGClass(_o);class xo{constructor(g){s(this,"target",void 0),s(this,"__mouseDownInPlace",!1),s(this,"__dragStartFired",!1),s(this,"__isDraggingOver",!1),s(this,"__dragStartSelection",void 0),s(this,"__dragImageDisposer",void 0),s(this,"_dispose",void 0),this.target=g;const f=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{f.forEach((g=>g())),this._dispose=void 0}}isPointerOverSelection(g){const f=this.target,x=f.getSelectionStartFromPointer(g);return f.isEditing&&x>=f.selectionStart&&x<=f.selectionEnd&&f.selectionStart<f.selectionEnd}start(g){return this.__mouseDownInPlace=this.isPointerOverSelection(g)}isActive(){return this.__mouseDownInPlace}end(g){const f=this.isActive();return f&&!this.__dragStartFired&&(this.target.setCursorByClick(g),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,f}getDragStartSelection(){return this.__dragStartSelection}setDragImage(g,f){var x;let{selectionStart:C,selectionEnd:w}=f;const S=this.target,T=S.canvas,O=new U(S.flipX?-1:1,S.flipY?-1:1),k=S._getCursorBoundaries(C),D=new U(k.left+k.leftOffset,k.top+k.topOffset).multiply(O).transform(S.calcTransformMatrix()),M=T.getScenePoint(g).subtract(D),A=S.getCanvasRetinaScaling(),P=S.getBoundingRect(),E=D.subtract(new U(P.left,P.top)),j=T.viewportTransform,F=E.add(M).transform(j,!0),R=S.backgroundColor,B=Ss(S.styles);S.backgroundColor="";const I={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};S.setSelectionStyles(I,0,C),S.setSelectionStyles(I,w,S.text.length),S.dirty=!0;const X=S.toCanvasElement({enableRetinaScaling:T.enableRetinaScaling,viewportTransform:!0});S.backgroundColor=R,S.styles=B,S.dirty=!0,Ut(X,{position:"fixed",left:"".concat(-X.width,"px"),border:L,width:"".concat(X.width/A,"px"),height:"".concat(X.height/A,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{X.remove()},Ht(g.target||this.target.hiddenTextarea).body.appendChild(X),null===(x=g.dataTransfer)||void 0===x||x.setDragImage(X,F.x,F.y)}onDragStart(g){this.__dragStartFired=!0;const f=this.target,x=this.isActive();if(x&&g.dataTransfer){const x=this.__dragStartSelection={selectionStart:f.selectionStart,selectionEnd:f.selectionEnd},C=f._text.slice(x.selectionStart,x.selectionEnd).join(""),w=e({text:f.text,value:C},x);g.dataTransfer.setData("text/plain",C),g.dataTransfer.setData("application/fabric",JSON.stringify({value:C,styles:f.getSelectionStyles(x.selectionStart,x.selectionEnd,!0)})),g.dataTransfer.effectAllowed="copyMove",this.setDragImage(g,w)}return f.abortCursorAnimation(),x}canDrop(g){if(this.target.editable&&!this.target.getActiveControl()&&!g.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const f=this.target.getSelectionStartFromPointer(g),x=this.__dragStartSelection;return f<x.selectionStart||f>x.selectionEnd}return!0}return!1}targetCanDrop(g){return this.target.canDrop(g)}dragEnterHandler(g){let{e:f}=g;const x=this.targetCanDrop(f);!this.__isDraggingOver&&x&&(this.__isDraggingOver=!0)}dragOverHandler(g){const{e:f}=g,x=this.targetCanDrop(f);!this.__isDraggingOver&&x?this.__isDraggingOver=!0:this.__isDraggingOver&&!x&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(f.preventDefault(),g.canDrop=!0,g.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(g){var f;const{e:x}=g,C=x.defaultPrevented;this.__isDraggingOver=!1,x.preventDefault();let w=null===(f=x.dataTransfer)||void 0===f?void 0:f.getData("text/plain");if(w&&!C){const f=this.target,C=f.canvas;let S=f.getSelectionStartFromPointer(x);const{styles:T}=x.dataTransfer.types.includes("application/fabric")?JSON.parse(x.dataTransfer.getData("application/fabric")):{},O=w[Math.max(0,w.length-1)],k=0;if(this.__dragStartSelection){const g=this.__dragStartSelection.selectionStart,x=this.__dragStartSelection.selectionEnd;S>g&&S<=x?S=g:S>x&&(S-=x-g),f.removeChars(g,x),delete this.__dragStartSelection}f._reNewline.test(O)&&(f._reNewline.test(f._text[S])||S===f._text.length)&&(w=w.trimEnd()),g.didDrop=!0,g.dropTarget=f,f.insertChars(w,T,S),C.setActiveObject(f),f.enterEditing(x),f.selectionStart=Math.min(S+k,f._text.length),f.selectionEnd=Math.min(f.selectionStart+w.length,f._text.length),f.hiddenTextarea.value=f.text,f._updateTextarea(),f.hiddenTextarea.focus(),f.fire("changed",{index:S+k,action:"drop"}),C.fire("text:changed",{target:f}),C.contextTopDirty=!0,C.requestRenderAll()}}dragEndHandler(g){let{e:f}=g;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var x;const g=this.target,C=this.target.canvas,{selectionStart:w,selectionEnd:S}=this.__dragStartSelection,T=(null===(x=f.dataTransfer)||void 0===x?void 0:x.dropEffect)||L;T===L?(g.selectionStart=w,g.selectionEnd=S,g._updateTextarea(),g.hiddenTextarea.focus()):(g.clearContextTop(),"move"===T&&(g.removeChars(w,S),g.selectionStart=g.selectionEnd=w,g.hiddenTextarea&&(g.hiddenTextarea.value=g.text),g._updateTextarea(),g.fire("changed",{index:w,action:"dragend"}),C.fire("text:changed",{target:g}),C.requestRenderAll()),g.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const Oo=/[ \n\.,;!\?\-]/;class bo extends _o{constructor(){super(...arguments),s(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(g){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(g)}_animateCursor(g){let{toValue:f,duration:x,delay:C,onComplete:w}=g;return ze({startValue:this._currentCursorOpacity,endValue:f,duration:x,delay:C,onComplete:w,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:g=>{this._currentCursorOpacity=g,this.renderCursorOrSelection()}})}_tick(g){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(g||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var g;null===(g=this._currentTickCompleteState)||void 0===g||g.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(g){this.abortCursorAnimation(),this._tick(g?0:this.cursorDelay)}abortCursorAnimation(){let g=!1;[this._currentTickState,this._currentTickCompleteState].forEach((f=>{f&&!f.isDone()&&(g=!0,f.abort())})),this._currentCursorOpacity=1,g&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some((g=>!g||g.isDone()))&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(g){let f=0,x=g-1;if(this._reSpace.test(this._text[x]))for(;this._reSpace.test(this._text[x]);)f++,x--;for(;/\S/.test(this._text[x])&&x>-1;)f++,x--;return g-f}findWordBoundaryRight(g){let f=0,x=g;if(this._reSpace.test(this._text[x]))for(;this._reSpace.test(this._text[x]);)f++,x++;for(;/\S/.test(this._text[x])&&x<this._text.length;)f++,x++;return g+f}findLineBoundaryLeft(g){let f=0,x=g-1;for(;!/\n/.test(this._text[x])&&x>-1;)f++,x--;return g-f}findLineBoundaryRight(g){let f=0,x=g;for(;!/\n/.test(this._text[x])&&x<this._text.length;)f++,x++;return g+f}searchWordBoundary(g,f){const x=this._text;let C=g>0&&this._reSpace.test(x[g])&&(-1===f||!R.test(x[g-1]))?g-1:g,w=x[C];for(;C>0&&C<x.length&&!Oo.test(w);)C+=f,w=x[C];return-1===f&&Oo.test(w)&&C++,C}selectWord(g){g=g||this.selectionStart;const f=this.searchWordBoundary(g,-1),x=Math.max(f,this.searchWordBoundary(g,1));this.selectionStart=f,this.selectionEnd=x,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(g){g=g||this.selectionStart;const f=this.findLineBoundaryLeft(g),x=this.findLineBoundaryRight(g);return this.selectionStart=f,this.selectionEnd=x,this._fireSelectionChanged(),this._updateTextarea(),this}enterEditing(g){!this.isEditing&&this.editable&&(this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered",g?{e:g}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:g}),this.canvas.requestRenderAll()))}updateSelectionOnMouseMove(g){if(this.getActiveControl())return;const f=this.hiddenTextarea;Ht(f).activeElement!==f&&f.focus();const x=this.getSelectionStartFromPointer(g),C=this.selectionStart,w=this.selectionEnd;(x===this.__selectionStartOnMouseDown&&C!==w||C!==x&&w!==x)&&(x>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=x):(this.selectionStart=x,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===C&&this.selectionEnd===w||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(g,f,x){const C=x.slice(0,g),w=this.graphemeSplit(C).length;if(g===f)return{selectionStart:w,selectionEnd:w};const S=x.slice(g,f);return{selectionStart:w,selectionEnd:w+this.graphemeSplit(S).length}}fromGraphemeToStringSelection(g,f,x){const C=x.slice(0,g).join("").length;return g===f?{selectionStart:C,selectionEnd:C}:{selectionStart:C,selectionEnd:C+x.slice(g,f).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const g=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=g.selectionStart,this.hiddenTextarea.selectionEnd=g.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const g=this.hiddenTextarea;this.text=g.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const f=this.fromStringToGraphemeSelection(g.selectionStart,g.selectionEnd,g.value);this.selectionEnd=this.selectionStart=f.selectionEnd,this.inCompositionMode||(this.selectionStart=f.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const g=this._calcTextareaPosition();this.hiddenTextarea.style.left=g.left,this.hiddenTextarea.style.top=g.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const g=this.inCompositionMode?this.compositionStart:this.selectionStart,f=this._getCursorBoundaries(g),x=this.get2DCursorLocation(g),C=x.lineIndex,w=x.charIndex,S=this.getValueOfPropertyAt(C,w,"fontSize")*this.lineHeight,T=f.leftOffset,O=this.getCanvasRetinaScaling(),k=this.canvas.upperCanvasEl,D=k.width/O,M=k.height/O,A=D-S,P=M-S,E=new U(f.left+T,f.top+f.topOffset+S).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new U(k.clientWidth/D,k.clientHeight/M));return E.x<0&&(E.x=0),E.x>A&&(E.x=A),E.y<0&&(E.y=0),E.y>P&&(E.y=P),E.x+=this.canvas._offset.left,E.y+=this.canvas._offset.top,{left:"".concat(E.x,"px"),top:"".concat(E.y,"px"),fontSize:"".concat(S,"px"),charHeight:S}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const g=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,g&&(g.blur&&g.blur(),g.parentNode&&g.parentNode.removeChild(g)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditing(){const g=this._textBeforeEdit!==this.text;return this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),g&&this.fire("modified"),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),g&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const g in this.styles)this._textLines[g]||delete this.styles[g]}removeStyleFromTo(g,f){const{lineIndex:x,charIndex:C}=this.get2DCursorLocation(g,!0),{lineIndex:w,charIndex:S}=this.get2DCursorLocation(f,!0);if(x!==w){if(this.styles[x])for(let g=C;g<this._unwrappedTextLines[x].length;g++)delete this.styles[x][g];if(this.styles[w])for(let g=S;g<this._unwrappedTextLines[w].length;g++){const f=this.styles[w][g];f&&(this.styles[x]||(this.styles[x]={}),this.styles[x][C+g-S]=f)}for(let g=x+1;g<=w;g++)delete this.styles[g];this.shiftLineStyles(w,x-w)}else if(this.styles[x]){const g=this.styles[x],f=S-C;for(let f=C;f<S;f++)delete g[f];for(const C in this.styles[x]){const x=parseInt(C,10);x>=S&&(g[x-f]=g[C],delete g[C])}}}shiftLineStyles(g,f){const x=Object.assign({},this.styles);for(const C in this.styles){const w=parseInt(C,10);w>g&&(this.styles[w+f]=x[w],x[w-f]||delete this.styles[w])}}insertNewlineStyleObject(g,f,x,C){const w={},S=this._unwrappedTextLines[g].length,T=S===f;let O=!1;x||(x=1),this.shiftLineStyles(g,x);const k=this.styles[g]?this.styles[g][0===f?f:f-1]:void 0;for(const x in this.styles[g]){const C=parseInt(x,10);C>=f&&(O=!0,w[C-f]=this.styles[g][x],T&&0===f||delete this.styles[g][x])}let D=!1;for(O&&!T&&(this.styles[g+x]=w,D=!0),(D||S>f)&&x--;x>0;)C&&C[x-1]?this.styles[g+x]={0:e({},C[x-1])}:k?this.styles[g+x]={0:e({},k)}:delete this.styles[g+x],x--;this._forceClearCache=!0}insertCharStyleObject(g,f,x,C){this.styles||(this.styles={});const w=this.styles[g],S=w?e({},w):{};x||(x=1);for(const g in S){const C=parseInt(g,10);C>=f&&(w[C+x]=S[C],S[C-x]||delete w[C])}if(this._forceClearCache=!0,C){for(;x--;)Object.keys(C[x]).length&&(this.styles[g]||(this.styles[g]={}),this.styles[g][f+x]=e({},C[x]));return}if(!w)return;const T=w[f?f-1:1];for(;T&&x--;)this.styles[g][f+x]=e({},T)}insertNewStyleBlock(g,f,x){const C=this.get2DCursorLocation(f,!0),w=[0];let S,T=0;for(let f=0;f<g.length;f++)"\n"===g[f]?(T++,w[T]=0):w[T]++;for(w[0]>0&&(this.insertCharStyleObject(C.lineIndex,C.charIndex,w[0],x),x=x&&x.slice(w[0]+1)),T&&this.insertNewlineStyleObject(C.lineIndex,C.charIndex+w[0],T),S=1;S<T;S++)w[S]>0?this.insertCharStyleObject(C.lineIndex+S,0,w[S],x):x&&this.styles[C.lineIndex+S]&&x[0]&&(this.styles[C.lineIndex+S][0]=x[0]),x=x&&x.slice(w[S]+1);w[S]>0&&this.insertCharStyleObject(C.lineIndex+S,0,w[S],x)}removeChars(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g+1;this.removeStyleFromTo(g,f),this._text.splice(g,f-g),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(g,f,x){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x;C>x&&this.removeStyleFromTo(x,C);const w=this.graphemeSplit(g);this.insertNewStyleBlock(w,x,f),this._text=[...this._text.slice(0,x),...w,...this._text.slice(C)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(g,f,x){x<=g?(f===g?this._selectionDirection=P:this._selectionDirection===F&&(this._selectionDirection=P,this.selectionEnd=g),this.selectionStart=x):x>g&&x<f?this._selectionDirection===F?this.selectionEnd=x:this.selectionStart=x:(f===g?this._selectionDirection=F:this._selectionDirection===P&&(this._selectionDirection=F,this.selectionStart=f),this.selectionEnd=x)}}class wo extends bo{initHiddenTextarea(){const g=this.canvas&&Ht(this.canvas.getElement())||v(),f=g.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map((g=>{let[x,C]=g;return f.setAttribute(x,C)}));const{top:x,left:C,fontSize:w}=this._calcTextareaPosition();f.style.cssText="position: absolute; top: ".concat(x,"; left: ").concat(C,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(w,";"),(this.hiddenTextareaContainer||g.body).appendChild(f),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map((g=>{let[x,C]=g;return f.addEventListener(x,this[C].bind(this))})),this.hiddenTextarea=f}blur(){this.abortCursorAnimation()}onKeyDown(g){if(!this.isEditing)return;const f="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(g.keyCode in f)this[f[g.keyCode]](g);else{if(!(g.keyCode in this.ctrlKeysMapDown)||!g.ctrlKey&&!g.metaKey)return;this[this.ctrlKeysMapDown[g.keyCode]](g)}g.stopImmediatePropagation(),g.preventDefault(),g.keyCode>=33&&g.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(g){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:g.keyCode in this.ctrlKeysMapUp&&(g.ctrlKey||g.metaKey)&&(this[this.ctrlKeysMapUp[g.keyCode]](g),g.stopImmediatePropagation(),g.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(f){const x=this.fromPaste;if(this.fromPaste=!1,f&&f.stopPropagation(),!this.isEditing)return;const s=()=>{this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(""===this.hiddenTextarea.value)return this.styles={},void s();const C=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,w=this._text.length,S=C.length,T=this.selectionStart,O=this.selectionEnd,k=T!==O;let D,M,A,P,E=S-w;const j=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),F=T>j.selectionStart;k?(M=this._text.slice(T,O),E+=O-T):S<w&&(M=F?this._text.slice(O+E,O):this._text.slice(T,T-E));const L=C.slice(j.selectionEnd-E,j.selectionEnd);if(M&&M.length&&(L.length&&(D=this.getSelectionStyles(T,T+1,!1),D=L.map((()=>D[0]))),k?(A=T,P=O):F?(A=O-M.length,P=O):(A=O,P=O+M.length),this.removeStyleFromTo(A,P)),L.length){const{copyPasteData:f}=m();x&&L.join("")===f.copiedText&&!g.disableStyleCopyPaste&&(D=f.copiedTextStyle),this.insertNewStyleBlock(L,T,D)}s()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(g){let{target:f}=g;const{selectionStart:x,selectionEnd:C}=f;this.compositionStart=x,this.compositionEnd=C,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:f}=m();f.copiedText=this.getSelectedText(),g.disableStyleCopyPaste?f.copiedTextStyle=void 0:f.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(g,f){let x,C=this._getLineLeftOffset(g);return f>0&&(x=this.__charBounds[g][f-1],C+=x.left+x.width),C}getDownCursorOffset(g,f){const x=this._getSelectionForOffset(g,f),C=this.get2DCursorLocation(x),w=C.lineIndex;if(w===this._textLines.length-1||g.metaKey||34===g.keyCode)return this._text.length-x;const S=C.charIndex,T=this._getWidthBeforeCursor(w,S),O=this._getIndexOnLine(w+1,T);return this._textLines[w].slice(S).length+O+1+this.missingNewlineOffset(w)}_getSelectionForOffset(g,f){return g.shiftKey&&this.selectionStart!==this.selectionEnd&&f?this.selectionEnd:this.selectionStart}getUpCursorOffset(g,f){const x=this._getSelectionForOffset(g,f),C=this.get2DCursorLocation(x),w=C.lineIndex;if(0===w||g.metaKey||33===g.keyCode)return-x;const S=C.charIndex,T=this._getWidthBeforeCursor(w,S),O=this._getIndexOnLine(w-1,T),k=this._textLines[w].slice(0,S),D=this.missingNewlineOffset(w-1);return-this._textLines[w-1].length+O-k.length+(1-D)}_getIndexOnLine(g,f){const x=this._textLines[g];let C,w,S=this._getLineLeftOffset(g),T=0;for(let O=0,k=x.length;O<k;O++)if(C=this.__charBounds[g][O].width,S+=C,S>f){w=!0;const g=S-C,x=S,k=Math.abs(g-f);T=Math.abs(x-f)<k?O:O-1;break}return w||(T=x.length-1),T}moveCursorDown(g){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",g)}moveCursorUp(g){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",g)}_moveCursorUpOrDown(g,f){const x=this["get".concat(g,"CursorOffset")](f,this._selectionDirection===F);if(f.shiftKey?this.moveCursorWithShift(x):this.moveCursorWithoutShift(x),0!==x){const g=this.text.length;this.selectionStart=Ie(0,this.selectionStart,g),this.selectionEnd=Ie(0,this.selectionEnd,g),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(g){const f=this._selectionDirection===P?this.selectionStart+g:this.selectionEnd+g;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,f),0!==g}moveCursorWithoutShift(g){return g<0?(this.selectionStart+=g,this.selectionEnd=this.selectionStart):(this.selectionEnd+=g,this.selectionStart=this.selectionEnd),0!==g}moveCursorLeft(g){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",g)}_move(g,f,x){let C;if(g.altKey)C=this["findWordBoundary".concat(x)](this[f]);else{if(!g.metaKey&&35!==g.keyCode&&36!==g.keyCode)return this[f]+="Left"===x?-1:1,!0;C=this["findLineBoundary".concat(x)](this[f])}return void 0!==C&&this[f]!==C&&(this[f]=C,!0)}_moveLeft(g,f){return this._move(g,f,"Left")}_moveRight(g,f){return this._move(g,f,"Right")}moveCursorLeftWithoutShift(g){let f=!0;return this._selectionDirection=P,this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(f=this._moveLeft(g,"selectionStart")),this.selectionEnd=this.selectionStart,f}moveCursorLeftWithShift(g){return this._selectionDirection===F&&this.selectionStart!==this.selectionEnd?this._moveLeft(g,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection=P,this._moveLeft(g,"selectionStart")):void 0}moveCursorRight(g){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",g)}_moveCursorLeftOrRight(g,f){const x="moveCursor".concat(g).concat(f.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[x](f)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(g){return this._selectionDirection===P&&this.selectionStart!==this.selectionEnd?this._moveRight(g,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=F,this._moveRight(g,"selectionEnd")):void 0}moveCursorRightWithoutShift(g){let f=!0;return this._selectionDirection=F,this.selectionStart===this.selectionEnd?(f=this._moveRight(g,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,f}}const So=g=>!!g.button;class To extends wo{constructor(){super(...arguments),s(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler),this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown),this.draggableTextDelegate=new xo(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(g){return this.draggableTextDelegate.onDragStart(g)}canDrop(g){return this.draggableTextDelegate.canDrop(g)}onMouseDown(g){if(!this.canvas)return;this.__newClickTime=+new Date;const f=g.pointer;this.isTripleClick(f)&&(this.fire("tripleclick",g),se(g.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=f,this.__lastSelected=this.selected&&!this.getActiveControl()}isTripleClick(g){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===g.x&&this.__lastPointer.y===g.y}doubleClickHandler(g){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(g.e))}tripleClickHandler(g){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(g.e))}_mouseDownHandler(g){let{e:f}=g;this.canvas&&this.editable&&!So(f)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(f)||(this.canvas.textEditingManager.register(this),this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(f)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())))}_mouseDownHandlerBefore(g){let{e:f}=g;this.canvas&&this.editable&&!So(f)&&(this.selected=this===this.canvas._activeObject)}mouseUpHandler(g){let{e:f,transform:x}=g;const C=this.draggableTextDelegate.end(f);if(this.canvas){this.canvas.textEditingManager.unregister(this);const g=this.canvas._activeObject;if(g&&g!==this)return}!this.editable||this.group&&!this.group.interactive||x&&x.actionPerformed||So(f)||C||(this.__lastSelected&&!this.getActiveControl()?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(f),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0)}setCursorByClick(g){const f=this.getSelectionStartFromPointer(g),x=this.selectionStart,C=this.selectionEnd;g.shiftKey?this.setSelectionStartEndWithShift(x,C,f):(this.selectionStart=f,this.selectionEnd=f),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(g){const f=this.canvas.getScenePoint(g).transform(ht(this.calcTransformMatrix())).add(new U(-this._getLeftOffset(),-this._getTopOffset()));let x=0,C=0,w=0;for(let g=0;g<this._textLines.length&&x<=f.y;g++)x+=this.getHeightOfLine(g),w=g,g>0&&(C+=this._textLines[g-1].length+this.missingNewlineOffset(g-1));let S=Math.abs(this._getLineLeftOffset(w));const T=this._textLines[w].length,O=this.__charBounds[w];for(let g=0;g<T;g++){const x=S+O[g].kernedWidth;if(f.x<=x){Math.abs(f.x-x)<=Math.abs(f.x-S)&&C++;break}S=x,C++}return Math.min(this.flipX?T-C:C,this._text.length)}}const ko="moveCursorUp",Do="moveCursorDown",Mo="moveCursorLeft",Po="moveCursorRight",Eo="exitEditing",Bo=e({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:Eo,27:Eo,33:ko,34:Do,35:Po,36:Mo,37:Mo,38:ko,39:Po,40:Do},keysMapRtl:{9:Eo,27:Eo,33:ko,34:Do,35:Mo,36:Po,37:Po,38:ko,39:Mo,40:Do},ctrlKeysMapDown:{65:"selectAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class Ao extends To{static getDefaults(){return e(e({},super.getDefaults()),Ao.ownDefaults)}get type(){const g=super.type;return"itext"===g?"i-text":g}constructor(g,f){super(g,e(e({},Ao.ownDefaults),f)),this.initBehavior()}_set(g,f){return this.isEditing&&this._savedProps&&g in this._savedProps?(this._savedProps[g]=f,this):("canvas"===g&&(this.canvas instanceof mn&&this.canvas.textEditingManager.remove(this),f instanceof mn&&f.textEditingManager.add(this)),super._set(g,f))}setSelectionStart(g){g=Math.max(g,0),this._updateAndFire("selectionStart",g)}setSelectionEnd(g){g=Math.min(g,this.text.length),this._updateAndFire("selectionEnd",g)}_updateAndFire(g,f){this[g]!==f&&(this._fireSelectionChanged(),this[g]=f),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart||0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionEnd,x=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(g,f,x)}setSelectionStyles(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionStart||0,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.selectionEnd;return super.setSelectionStyles(g,f,x)}get2DCursorLocation(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,f=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(g,f)}render(g){super.render(g),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(g){const f=this.isEditing;this.isEditing=!1;const x=super.toCanvasElement(g);return this.isEditing=f,x}renderCursorOrSelection(){if(!this.isEditing)return;const g=this.clearContextTop(!0);if(!g)return;const f=this._getCursorBoundaries();this.selectionStart===this.selectionEnd?this.renderCursor(g,f):this.renderSelection(g,f),this.canvas.contextTopDirty=!0,g.restore()}_getCursorBoundaries(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,f=arguments.length>1?arguments[1]:void 0;const x=this._getLeftOffset(),C=this._getTopOffset(),w=this._getCursorBoundariesOffsets(g,f);return{left:x,top:C,leftOffset:w.left,topOffset:w.top}}_getCursorBoundariesOffsets(g,f){return f?this.__getCursorBoundariesOffsets(g):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(g)}__getCursorBoundariesOffsets(g){let f=0,x=0;const{charIndex:C,lineIndex:w}=this.get2DCursorLocation(g);for(let g=0;g<w;g++)f+=this.getHeightOfLine(g);const S=this._getLineLeftOffset(w),T=this.__charBounds[w][C];T&&(x=T.left),0!==this.charSpacing&&C===this._textLines[w].length&&(x-=this._getWidthOfCharSpacing());const O={top:f,left:S+(x>0?x:0)};return"rtl"===this.direction&&(this.textAlign===F||this.textAlign===co||this.textAlign===uo?O.left*=-1:this.textAlign===P||this.textAlign===lo?O.left=S-(x>0?x:0):this.textAlign!==A&&this.textAlign!==fo||(O.left=S-(x>0?x:0))),O}renderCursorAt(g){const f=this._getCursorBoundaries(g,!0);this._renderCursor(this.canvas.contextTop,f,g)}renderCursor(g,f){this._renderCursor(g,f,this.selectionStart)}_renderCursor(g,f,x){const C=this.get2DCursorLocation(x),w=C.lineIndex,S=C.charIndex>0?C.charIndex-1:0,T=this.getValueOfPropertyAt(w,S,"fontSize"),O=this.getObjectScaling().x*this.canvas.getZoom(),k=this.cursorWidth/O,D=this.getValueOfPropertyAt(w,S,"deltaY"),M=f.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(w)/this.lineHeight-T*(1-this._fontSizeFraction);this.inCompositionMode&&this.renderSelection(g,f),g.fillStyle=this.cursorColor||this.getValueOfPropertyAt(w,S,"fill"),g.globalAlpha=this._currentCursorOpacity,g.fillRect(f.left+f.leftOffset-k/2,M+f.top+D,k,T)}renderSelection(g,f){const x={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(g,x,f)}renderDragSourceEffect(){const g=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,g,this._getCursorBoundaries(g.selectionStart,!0))}renderDropTargetEffect(g){const f=this.getSelectionStartFromPointer(g);this.renderCursorAt(f)}_renderSelection(g,f,x){const C=f.selectionStart,w=f.selectionEnd,S=this.textAlign.includes(co),T=this.get2DCursorLocation(C),O=this.get2DCursorLocation(w),k=T.lineIndex,D=O.lineIndex,M=T.charIndex<0?0:T.charIndex,E=O.charIndex<0?0:O.charIndex;for(let f=k;f<=D;f++){const C=this._getLineLeftOffset(f)||0;let w=this.getHeightOfLine(f),T=0,O=0,j=0;if(f===k&&(O=this.__charBounds[k][M].left),f>=k&&f<D)j=S&&!this.isEndOfWrapping(f)?this.width:this.getLineWidth(f)||5;else if(f===D)if(0===E)j=this.__charBounds[D][E].left;else{const g=this._getWidthOfCharSpacing();j=this.__charBounds[D][E-1].left+this.__charBounds[D][E-1].width-g}T=w,(this.lineHeight<1||f===D&&this.lineHeight>1)&&(w/=this.lineHeight);let L=x.left+C+O,R=w,B=0;const I=j-O;this.inCompositionMode?(g.fillStyle=this.compositionColor||"black",R=1,B=w):g.fillStyle=this.selectionColor,"rtl"===this.direction&&(this.textAlign===F||this.textAlign===co||this.textAlign===uo?L=this.width-L-I:this.textAlign===P||this.textAlign===lo?L=x.left+C-j:this.textAlign!==A&&this.textAlign!==fo||(L=x.left+C-j)),g.fillRect(L,x.top+x.topOffset+B,I,R),x.topOffset+=T}}getCurrentCharFontSize(){const g=this._getCurrentCharIndex();return this.getValueOfPropertyAt(g.l,g.c,"fontSize")}getCurrentCharColor(){const g=this._getCurrentCharIndex();return this.getValueOfPropertyAt(g.l,g.c,"fill")}_getCurrentCharIndex(){const g=this.get2DCursorLocation(this.selectionStart,!0),f=g.charIndex>0?g.charIndex-1:0;return{l:g.lineIndex,c:f}}dispose(){this._exitEditing(),this.draggableTextDelegate.dispose(),super.dispose()}}s(Ao,"ownDefaults",Bo),s(Ao,"type","IText"),X.setClass(Ao),X.setClass(Ao,"i-text");class jo extends Ao{static getDefaults(){return e(e({},super.getDefaults()),jo.ownDefaults)}constructor(g,f){super(g,e(e({},jo.ownDefaults),f))}static createControls(){return{controls:ai()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(co)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(g){let f=0,x=0,C=0;const w={};for(let S=0;S<g.graphemeLines.length;S++)"\n"===g.graphemeText[C]&&S>0?(x=0,C++,f++):!this.splitByGrapheme&&this._reSpaceAndTab.test(g.graphemeText[C])&&S>0&&(x++,C++),w[S]={line:f,offset:x},C+=g.graphemeLines[S].length,x+=g.graphemeLines[S].length;return w}styleHas(g,f){if(this._styleMap&&!this.isWrapping){const g=this._styleMap[f];g&&(f=g.line)}return super.styleHas(g,f)}isEmptyStyles(g){if(!this.styles)return!0;let f,x=0,C=g+1,w=!1;const S=this._styleMap[g],T=this._styleMap[g+1];S&&(g=S.line,x=S.offset),T&&(C=T.line,w=C===g,f=T.offset);const O=void 0===g?this.styles:{line:this.styles[g]};for(const g in O)for(const C in O[g]){const S=parseInt(C,10);if(S>=x&&(!w||S<f))for(const f in O[g][C])return!1}return!0}_getStyleDeclaration(g,f){if(this._styleMap&&!this.isWrapping){const x=this._styleMap[g];if(!x)return{};g=x.line,f=x.offset+f}return super._getStyleDeclaration(g,f)}_setStyleDeclaration(g,f,x){const C=this._styleMap[g];super._setStyleDeclaration(C.line,C.offset+f,x)}_deleteStyleDeclaration(g,f){const x=this._styleMap[g];super._deleteStyleDeclaration(x.line,x.offset+f)}_getLineStyle(g){const f=this._styleMap[g];return!!this.styles[f.line]}_setLineStyle(g){const f=this._styleMap[g];super._setLineStyle(f.line)}_wrapText(g,f){this.isWrapping=!0;const x=this.getGraphemeDataForRender(g),C=[];for(let g=0;g<x.wordsData.length;g++)C.push(...this._wrapLine(g,f,x));return this.isWrapping=!1,C}getGraphemeDataForRender(g){const f=this.splitByGrapheme,x=f?"":" ";let C=0;return{wordsData:g.map(((g,w)=>{let S=0;const T=f?this.graphemeSplit(g):this.wordSplit(g);return 0===T.length?[{word:[],width:0}]:T.map((g=>{const T=f?[g]:this.graphemeSplit(g),O=this._measureWord(T,w,S);return C=Math.max(O,C),S+=T.length+x.length,{word:T,width:O}}))})),largestWordWidth:C}}_measureWord(g,f){let x,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=0;for(let S=0,T=g.length;S<T;S++)w+=this._getGraphemeBox(g[S],f,S+C,x,true).kernedWidth,x=g[S];return w}wordSplit(g){return g.split(this._wordJoiners)}_wrapLine(g,f,x){let{largestWordWidth:C,wordsData:w}=x,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const T=this._getWidthOfCharSpacing(),O=this.splitByGrapheme,k=[],D=O?"":" ";let M=0,A=[],P=0,E=0,j=!0;f-=S;const F=Math.max(f,C,this.dynamicMinWidth),L=w[g];let R;for(P=0,R=0;R<L.length;R++){const{word:f,width:x}=L[R];P+=f.length,M+=E+x-T,M>F&&!j?(k.push(A),A=[],M=x,j=!0):M+=T,j||O||A.push(D),A=A.concat(f),E=O?0:this._measureWord([D],g,P),P++,j=!1}return R&&k.push(A),C+S>this.dynamicMinWidth&&(this.dynamicMinWidth=C-T+S),k}isEndOfWrapping(g){return!this._styleMap[g+1]||this._styleMap[g+1].line!==this._styleMap[g].line}missingNewlineOffset(g,f){return this.splitByGrapheme&&!f?this.isEndOfWrapping(g)?1:0:1}_splitTextIntoLines(g){const f=super._splitTextIntoLines(g),x=this._wrapText(f.lines,this.width),C=new Array(x.length);for(let g=0;g<x.length;g++)C[g]=x[g].join("");return f.lines=C,f.graphemeLines=x,f}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const g=new Map;for(const f in this._styleMap){const x=parseInt(f,10);if(this._textLines[x]){const x=this._styleMap[f].line;g.set("".concat(x),!0)}}for(const f in this.styles)g.has(f)||delete this.styles[f]}toObject(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...g])}}s(jo,"type","Textbox"),s(jo,"textLayoutProperties",[...Ao.textLayoutProperties,"width"]),s(jo,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),X.setClass(jo);class Fo extends lr{shouldPerformLayout(g){return!!g.target.clipPath&&super.shouldPerformLayout(g)}shouldLayoutClipPath(){return!1}calcLayoutResult(g,f){const{target:x}=g,{clipPath:C}=x;if(!C||!this.shouldPerformLayout(g))return;const{width:w,height:S}=ie(cr(x,C)),T=new U(w,S);if(C.absolutePositioned){var O;return{center:ue(C.getRelativeCenterPoint(),void 0,null===(O=x.group)||void 0===O?void 0:O.calcTransformMatrix()),size:T}}{const w=C.getRelativeCenterPoint().transform(x.calcOwnMatrix(),!0);if(this.shouldPerformLayout(g)){const{center:x=new U,correction:C=new U}=this.calcBoundingBox(f,g)||{};return{center:x.add(w),correction:C.subtract(w),size:T}}return{center:x.getRelativeCenterPoint().add(w),size:T}}}}s(Fo,"type","clip-path"),X.setClass(Fo);class Lo extends lr{getInitialSize(g,f){let{target:x}=g,{size:C}=f;return new U(x.width||C.x,x.height||C.y)}}s(Lo,"type","fixed"),X.setClass(Lo);class Ro extends pr{subscribeTargets(g){const f=g.target;g.targets.reduce(((g,f)=>(f.parent&&g.add(f.parent),g)),new Set).forEach((g=>{g.layoutManager.subscribeTargets({target:g,targets:[f]})}))}unsubscribeTargets(g){const f=g.target,x=f.getObjects();g.targets.reduce(((g,f)=>(f.parent&&g.add(f.parent),g)),new Set).forEach((g=>{!x.some((f=>f.parent===g))&&g.layoutManager.unsubscribeTargets({target:g,targets:[f]})}))}}const Uo=["layoutManager"];class Io extends yr{static getDefaults(){return e(e({},super.getDefaults()),Io.ownDefaults)}constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{layoutManager:x}=f,C=i(f,Uo);super(g,{layoutManager:null!=x?x:new Ro}),Object.assign(this,Io.ownDefaults),this.setOptions(C)}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var g=arguments.length,f=new Array(g),x=0;x<g;x++)f[x]=arguments[x];"selection-order"===this.multiSelectionStacking?this.add(...f):f.forEach((g=>{const f=this._objects.findIndex((f=>f.isInFrontOf(g))),x=-1===f?this.size():f;this.insertAt(x,g)}))}canEnterGroup(g){return this.getObjects().some((f=>f.isDescendantOf(g)||g.isDescendantOf(f)))?(h("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(g)}enterGroup(g,f){g.parent&&g.parent===g.group?g.parent._exitGroup(g):g.group&&g.parent!==g.group&&g.group.remove(g),this._enterGroup(g,f)}exitGroup(g,f){this._exitGroup(g,f),g.parent&&g.parent._enterGroup(g,!0)}_onAfterObjectsChange(g,f){super._onAfterObjectsChange(g,f);const x=new Set;f.forEach((g=>{const{parent:f}=g;f&&x.add(f)})),g===hr?x.forEach((g=>{g._onAfterObjectsChange(ar,f)})):x.forEach((g=>{g._set("dirty",!0)}))}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(g,f,x){g.save(),g.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,super._renderControls(g,f);const C=e(e({hasControls:!1},x),{},{forActiveSelection:!0});for(let f=0;f<this._objects.length;f++)this._objects[f]._renderControls(g,C);g.restore()}}s(Io,"type","ActiveSelection"),s(Io,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),X.setClass(Io),X.setClass(Io,"activeSelection");class Xo{constructor(){s(this,"resources",{})}applyFilters(g,f,x,C,w){const S=w.getContext("2d");if(!S)return;S.drawImage(f,0,0,x,C);const T={sourceWidth:x,sourceHeight:C,imageData:S.getImageData(0,0,x,C),originalEl:f,originalImageData:S.getImageData(0,0,x,C),canvasEl:w,ctx:S,filterBackend:this};g.forEach((g=>{g.applyTo(T)}));const{imageData:O}=T;return O.width===x&&O.height===C||(w.width=O.width,w.height=O.height),S.putImageData(O,0,0),T}}class Yo{constructor(){let{tileSize:f=g.textureSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),s(this,"resources",{}),this.tileSize=f,this.setupGLContext(f,f),this.captureGPUInfo()}setupGLContext(g,f){this.dispose(),this.createWebGLCanvas(g,f)}createWebGLCanvas(g,f){const x=et();x.width=g,x.height=f;const C=x.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});C&&(C.clearColor(0,0,0,0),this.canvas=x,this.gl=C)}applyFilters(g,f,x,C,w,S){const T=this.gl,O=w.getContext("2d");if(!T||!O)return;let k;S&&(k=this.getCachedTexture(S,f));const D={originalWidth:f.width||f.originalWidth||0,originalHeight:f.height||f.originalHeight||0,sourceWidth:x,sourceHeight:C,destinationWidth:x,destinationHeight:C,context:T,sourceTexture:this.createTexture(T,x,C,k?void 0:f),targetTexture:this.createTexture(T,x,C),originalTexture:k||this.createTexture(T,x,C,k?void 0:f),passes:g.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:w},M=T.createFramebuffer();return T.bindFramebuffer(T.FRAMEBUFFER,M),g.forEach((g=>{g&&g.applyTo(D)})),function(g){const f=g.targetCanvas,x=f.width,C=f.height,w=g.destinationWidth,S=g.destinationHeight;x===w&&C===S||(f.width=w,f.height=S)}(D),this.copyGLTo2D(T,D),T.bindTexture(T.TEXTURE_2D,null),T.deleteTexture(D.sourceTexture),T.deleteTexture(D.targetTexture),T.deleteFramebuffer(M),O.setTransform(1,0,0,1,0,0),D}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(g,f,x,C,w){const{NEAREST:S,TEXTURE_2D:T,RGBA:O,UNSIGNED_BYTE:k,CLAMP_TO_EDGE:D,TEXTURE_MAG_FILTER:M,TEXTURE_MIN_FILTER:A,TEXTURE_WRAP_S:P,TEXTURE_WRAP_T:E}=g,j=g.createTexture();return g.bindTexture(T,j),g.texParameteri(T,M,w||S),g.texParameteri(T,A,w||S),g.texParameteri(T,P,D),g.texParameteri(T,E,D),C?g.texImage2D(T,0,O,O,k,C):g.texImage2D(T,0,O,f,x,0,O,k,null),j}getCachedTexture(g,f,x){const{textureCache:C}=this;if(C[g])return C[g];{const w=this.createTexture(this.gl,f.width,f.height,f,x);return w&&(C[g]=w),w}}evictCachesForKey(g){this.textureCache[g]&&(this.gl.deleteTexture(this.textureCache[g]),delete this.textureCache[g])}copyGLTo2D(g,f){const x=g.canvas,C=f.targetCanvas,w=C.getContext("2d");if(!w)return;w.translate(0,C.height),w.scale(1,-1);const S=x.height-C.height;w.drawImage(x,0,S,C.width,C.height,0,0,C.width,C.height)}copyGLTo2DPutImageData(g,f){const x=f.targetCanvas.getContext("2d"),C=f.destinationWidth,w=f.destinationHeight,S=C*w*4;if(!x)return;const T=new Uint8Array(this.imageBuffer,0,S),O=new Uint8ClampedArray(this.imageBuffer,0,S);g.readPixels(0,0,C,w,g.RGBA,g.UNSIGNED_BYTE,T);const k=new ImageData(O,C,w);x.putImageData(k,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const g=this.gl,f={renderer:"",vendor:""};if(!g)return f;const x=g.getExtension("WEBGL_debug_renderer_info");if(x){const C=g.getParameter(x.UNMASKED_RENDERER_WEBGL),w=g.getParameter(x.UNMASKED_VENDOR_WEBGL);C&&(f.renderer=C.toLowerCase()),w&&(f.vendor=w.toLowerCase())}return this.gpuInfo=f,f}}let Wo;function Vo(){const{WebGLProbe:f}=m();return f.queryWebGL(et()),g.enableGLFiltering&&f.isSupported(g.textureSize)?new Yo({tileSize:g.textureSize}):new Xo}function zo(){return!Wo&&(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(Wo=Vo()),Wo}function Ho(g){Wo=g}const Go=["filters","resizeFilter","src","crossOrigin","type"],Jo=["cropX","cropY"];class No extends li{static getDefaults(){return e(e({},super.getDefaults()),No.ownDefaults)}constructor(g,f){super(),s(this,"_lastScaleX",1),s(this,"_lastScaleY",1),s(this,"_filterScalingX",1),s(this,"_filterScalingY",1),this.filters=[],Object.assign(this,No.ownDefaults),this.setOptions(f),this.cacheKey="texture".concat(tt()),this.setElement("string"==typeof g?(this.canvas&&Ht(this.canvas.getElement())||v()).getElementById(g):g,f)}getElement(){return this._element}setElement(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=g,this._originalElement=g,this._setWidthHeight(f),g.classList.add(No.CSS_CANVAS),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(g){const f=zo(!1);f instanceof Yo&&f.evictCachesForKey(g)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((g=>{const f=this[g];f&&m().dispose(f),this[g]=void 0}))}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const g=this.getElement();return g?{width:g.naturalWidth||g.width,height:g.naturalHeight||g.height}:{width:0,height:0}}_stroke(g){if(!this.stroke||0===this.strokeWidth)return;const f=this.width/2,x=this.height/2;g.beginPath(),g.moveTo(-f,-x),g.lineTo(f,-x),g.lineTo(f,x),g.lineTo(-f,x),g.lineTo(-f,-x),g.closePath()}toObject(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const f=[];return this.filters.forEach((g=>{g&&f.push(g.toObject())})),e(e({},super.toObject([...Jo,...g])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:f},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const g=[],f=this._element,x=-this.width/2,C=-this.height/2;let w=[],S=[],T="",O="";if(!f)return[];if(this.hasCrop()){const g=tt();w.push('<clipPath id="imageCrop_'+g+'">\n','\t<rect x="'+x+'" y="'+C+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),T=' clip-path="url(#imageCrop_'+g+')" '}if(this.imageSmoothing||(O=' image-rendering="optimizeSpeed"'),g.push("\t<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(x-this.cropX,'" y="').concat(C-this.cropY,'" width="').concat(f.width||f.naturalWidth,'" height="').concat(f.height||f.naturalHeight,'"').concat(O).concat(T,"></image>\n")),this.stroke||this.strokeDashArray){const g=this.fill;this.fill=null,S=['\t<rect x="'.concat(x,'" y="').concat(C,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),'" />\n')],this.fill=g}return w="fill"!==this.paintFirst?w.concat(S,g):w.concat(g,S),w}getSrc(g){const f=g?this._element:this._originalElement;return f?f.toDataURL?f.toDataURL():this.srcFromAttribute?f.getAttribute("src")||"":f.src:this.src||""}getSvgSrc(g){return this.getSrc(g)}setSrc(g){let{crossOrigin:f,signal:x}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ct(g,{crossOrigin:f,signal:x}).then((g=>{void 0!==f&&this.set({crossOrigin:f}),this.setElement(g)}))}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const g=this.resizeFilter,f=this.minimumScaleTrigger,x=this.getTotalObjectScaling(),C=x.x,w=x.y,S=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!g||C>f&&w>f)return this._element=S,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=C,void(this._lastScaleY=w);const T=et(),O=S.width,k=S.height;T.width=O,T.height=k,this._element=T,this._lastScaleX=g.scaleX=C,this._lastScaleY=g.scaleY=w,zo().applyFilters([g],S,O,k,this._element),this._filterScalingX=T.width/this._originalElement.width,this._filterScalingY=T.height/this._originalElement.height}applyFilters(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.filters||[];if(g=g.filter((g=>g&&!g.isNeutralState())),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),0===g.length)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const f=this._originalElement,x=f.naturalWidth||f.width,C=f.naturalHeight||f.height;if(this._element===this._originalElement){const g=et();g.width=x,g.height=C,this._element=g,this._filteredEl=g}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,x,C),this._lastScaleX=1,this._lastScaleY=1);zo().applyFilters(g,this._originalElement,x,C,this._element),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(g){g.imageSmoothingEnabled=this.imageSmoothing,!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(g),this._renderPaintInOrder(g)}drawCacheOnCanvas(g){g.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(g)}shouldCache(){return this.needsItsOwnCache()}_renderFill(g){const f=this._element;if(!f)return;const x=this._filterScalingX,C=this._filterScalingY,w=this.width,S=this.height,T=Math.max(this.cropX,0),O=Math.max(this.cropY,0),k=f.naturalWidth||f.width,D=f.naturalHeight||f.height,M=T*x,A=O*C,P=Math.min(w*x,k-M),E=Math.min(S*C,D-A),j=-w/2,F=-S/2,L=Math.min(w,k/x-T),R=Math.min(S,D/C-O);f&&g.drawImage(f,M,A,P,E,j,F,L,R)}_needsResize(){const g=this.getTotalObjectScaling();return g.x!==this._lastScaleX||g.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:g,height:f}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const x=this.getOriginalSize();this.width=g||x.width,this.height=f||x.height}parsePreserveAspectRatioAttribute(){const g=Lt(this.preserveAspectRatio||""),f=this.width,x=this.height,C={width:f,height:x};let w,S=this._element.width,T=this._element.height,O=1,k=1,D=0,M=0,A=0,P=0;return!g||g.alignX===L&&g.alignY===L?(O=f/S,k=x/T):("meet"===g.meetOrSlice&&(O=k=_r(this._element,C),w=(f-S*O)/2,"Min"===g.alignX&&(D=-w),"Max"===g.alignX&&(D=w),w=(x-T*k)/2,"Min"===g.alignY&&(M=-w),"Max"===g.alignY&&(M=w)),"slice"===g.meetOrSlice&&(O=k=xr(this._element,C),w=S-f/O,"Mid"===g.alignX&&(A=w/2),"Max"===g.alignX&&(A=w),w=T-x/k,"Mid"===g.alignY&&(P=w/2),"Max"===g.alignY&&(P=w),S=f/O,T=x/k)),{width:S,height:T,scaleX:O,scaleY:k,offsetLeft:D,offsetTop:M,cropX:A,cropY:P}}static fromObject(g,f){let{filters:x,resizeFilter:C,src:w,crossOrigin:S,type:T}=g,O=i(g,Go);return Promise.all([Ct(w,e(e({},f),{},{crossOrigin:S})),x&&bt(x,f),C&&bt([C],f),wt(O,f)]).then((g=>{let[f,x=[],[C]=[],S={}]=g;return new this(f,e(e({},O),{},{src:w,filters:x,resizeFilter:C},S))}))}static fromURL(g){let{crossOrigin:f=null,signal:x}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return Ct(g,{crossOrigin:f,signal:x}).then((g=>new this(g,C)))}static async fromElement(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;const C=er(g,this.ATTRIBUTE_NAMES,x);return this.fromURL(C["xlink:href"],f,C).catch((g=>(h("log","Unable to parse Image",g),null)))}}function qo(g){if(!_s.test(g.nodeName))return{};const f=g.getAttribute("viewBox");let x,C,w=1,S=1,T=0,O=0;const k=g.getAttribute("width"),D=g.getAttribute("height"),M=g.getAttribute("x")||0,A=g.getAttribute("y")||0,P=!(f&&Cs.test(f)),E=!k||!D||"100%"===k||"100%"===D;let j="",F=0,R=0;if(P&&(M||A)&&g.parentNode&&"#document"!==g.parentNode.nodeName&&(j=" translate("+Ft(M||"0")+" "+Ft(A||"0")+") ",x=(g.getAttribute("transform")||"")+j,g.setAttribute("transform",x),g.removeAttribute("x"),g.removeAttribute("y")),P&&E)return{width:0,height:0};const B={width:0,height:0};if(P)return B.width=Ft(k),B.height=Ft(D),B;const I=f.match(Cs);T=-parseFloat(I[1]),O=-parseFloat(I[2]);const X=parseFloat(I[3]),N=parseFloat(I[4]);B.minX=T,B.minY=O,B.viewBoxWidth=X,B.viewBoxHeight=N,E?(B.width=X,B.height=N):(B.width=Ft(k),B.height=Ft(D),w=B.width/X,S=B.height/N);const $=Lt(g.getAttribute("preserveAspectRatio")||"");if($.alignX!==L&&("meet"===$.meetOrSlice&&(S=w=w>S?S:w),"slice"===$.meetOrSlice&&(S=w=w>S?w:S),F=B.width-X*w,R=B.height-N*w,"Mid"===$.alignX&&(F/=2),"Mid"===$.alignY&&(R/=2),"Min"===$.alignX&&(F=0),"Min"===$.alignY&&(R=0)),1===w&&1===S&&0===T&&0===O&&0===M&&0===A)return B;if((M||A)&&"#document"!==g.parentNode.nodeName&&(j=" translate("+Ft(M||"0")+" "+Ft(A||"0")+") "),x=j+" matrix("+w+" 0 0 "+S+" "+(T*w+F)+" "+(O*S+R)+") ","svg"===g.nodeName){for(C=g.ownerDocument.createElementNS(gs,"g");g.firstChild;)C.appendChild(g.firstChild);g.appendChild(C)}else C=g,C.removeAttribute("x"),C.removeAttribute("y"),x=C.getAttribute("transform")+x;return C.setAttribute("transform",x),B}s(No,"type","Image"),s(No,"cacheProperties",[...ks,...Jo]),s(No,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),s(No,"CSS_CANVAS","canvas-img"),s(No,"ATTRIBUTE_NAMES",[...Di,"x","y","width","height","preserveAspectRatio","xlink:href","crossOrigin","image-rendering"]),X.setClass(No),X.setSVGClass(No);const Ko=g=>g.tagName.replace("svg:",""),Qo=hs(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);function Zo(g,f){let x,C,w,S,T=[];for(w=0,S=f.length;w<S;w++)x=f[w],C=g.getElementsByTagNameNS("http://www.w3.org/2000/svg",x),T=T.concat(Array.from(C));return T}const $o=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],ea="xlink:href";function ta(g,f){var x;const C=(null===(x=f.getAttribute(ea))||void 0===x?void 0:x.slice(1))||"",w=g.getElementById(C);if(w&&w.getAttribute(ea)&&ta(g,w),w&&($o.forEach((g=>{const x=w.getAttribute(g);!f.hasAttribute(g)&&x&&f.setAttribute(g,x)})),!f.children.length)){const g=w.cloneNode(!0);for(;g.firstChild;)f.appendChild(g.firstChild)}f.removeAttribute(ea)}const la=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"];function sa(g){const f=g.getElementsByTagName("style");let x,C;const w={};for(x=0,C=f.length;x<C;x++){const g=(f[x].textContent||"").replace(/\/\*[\s\S]*?\*\//g,"");""!==g.trim()&&g.split("}").filter(((g,f,x)=>x.length>1&&g.trim())).forEach((g=>{if((g.match(/{/g)||[]).length>1&&g.trim().startsWith("@"))return;const f=g.split("{"),S={},T=f[1].trim().split(";").filter((function(g){return g.trim()}));for(x=0,C=T.length;x<C;x++){const g=T[x].split(":"),f=g[0].trim(),C=g[1].trim();S[f]=C}(g=f[0].trim()).split(",").forEach((g=>{""!==(g=g.replace(/^svg/i,"").trim())&&(w[g]=e(e({},w[g]||{}),S))}))}))}return w}const ia=g=>X.getSVGClass(Ko(g).toLowerCase());class ra{constructor(g,f,x,C,w){this.elements=g,this.options=f,this.reviver=x,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=C,this.clipPaths=w,this.gradientDefs=function(g){const f=Zo(g,la),x={};let C=f.length;for(;C--;){const w=f[C];w.getAttribute("xlink:href")&&ta(g,w);const S=w.getAttribute("id");S&&(x[S]=w)}return x}(C),this.cssRules=sa(C)}parse(){return Promise.all(this.elements.map((g=>this.createObject(g))))}async createObject(g){const f=ia(g);if(f){const x=await f.fromElement(g,this.options,this.cssRules);return this.resolveGradient(x,g,"fill"),this.resolveGradient(x,g,"stroke"),x instanceof No&&x._originalElement?nn(x,x.parsePreserveAspectRatioAttribute()):nn(x),await this.resolveClipPath(x,g),this.reviver&&this.reviver(g,x),x}return null}extractPropertyDefinition(g,f,x){const C=g[f],w=this.regexUrl;if(!w.test(C))return;w.lastIndex=0;const S=w.exec(C)[1];return w.lastIndex=0,x[S]}resolveGradient(g,f,x){const C=this.extractPropertyDefinition(g,x,this.gradientDefs);if(C){const w=f.getAttribute(x+"-opacity"),S=Pn.fromElement(C,g,e(e({},this.options),{},{opacity:w}));g.set(x,S)}}async resolveClipPath(g,f){const x=this.extractPropertyDefinition(g,"clipPath",this.clipPaths);if(x){const C=ht(g.calcTransformMatrix()),w=x[0].parentElement;let S=f;for(;S.parentElement&&S.getAttribute("clip-path")!==g.clipPath;)S=S.parentElement;S.parentElement.appendChild(w);const T=Ji("".concat(S.getAttribute("transform")||""," ").concat(w.getAttribute("originalTransform")||""));w.setAttribute("transform","matrix(".concat(T.join(","),")"));const O=await Promise.all(x.map((g=>ia(g).fromElement(g,this.options,this.cssRules).then((g=>(nn(g),g.fillRule=g.clipRule,delete g.clipRule,g)))))),k=1===O.length?O[0]:new yr(O),D=ct(C,k.calcTransformMatrix());k.clipPath&&await this.resolveClipPath(k,S);const{scaleX:M,scaleY:P,angle:E,skewX:j,translateX:F,translateY:L}=dt(D);k.set({flipX:!1,flipY:!1}),k.set({scaleX:M,scaleY:P,angle:E,skewX:j,skewY:0}),k.setPositionByOrigin(new U(F,L),A,A),g.clipPath=k}else delete g.clipPath}}const na=g=>ys.test(Ko(g)),oa=()=>({objects:[],elements:[],options:{},allElements:[]});async function aa(g,f){let{crossOrigin:x,signal:C}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(C&&C.aborted)return h("log",new l("parseSVGDocument")),oa();const w=g.documentElement;!function(g){const f=Zo(g,["use","svg:use"]);let x=0;for(;f.length&&x<f.length;){const C=f[x],w=C.getAttribute("xlink:href")||C.getAttribute("href");if(null===w)return;const S=w.slice(1),T=C.getAttribute("x")||0,O=C.getAttribute("y")||0,k=g.getElementById(S);if(null===k)return;let D=k.cloneNode(!0),M=(D.getAttribute("transform")||"")+" translate("+T+", "+O+")";const A=f.length,P=gs;if(qo(D),/^svg$/i.test(D.nodeName)){const g=D.ownerDocument.createElementNS(P,"g");for(let f=0,x=D.attributes,C=x.length;f<C;f++){const C=x.item(f);C&&g.setAttributeNS(P,C.nodeName,C.nodeValue)}for(;D.firstChild;)g.appendChild(D.firstChild);D=g}for(let g=0,f=C.attributes,x=f.length;g<x;g++){const x=f.item(g);if(!x)continue;const{nodeName:C,nodeValue:w}=x;"x"!==C&&"y"!==C&&"xlink:href"!==C&&"href"!==C&&("transform"===C?M=w+" "+M:D.setAttribute(C,w))}D.setAttribute("transform",M),D.setAttribute("instantiated_by_use","1"),D.removeAttribute("id"),C.parentNode.replaceChild(D,C),f.length===A&&x++}}(g);const S=Array.from(w.getElementsByTagName("*")),T=e(e({},qo(w)),{},{crossOrigin:x,signal:C}),O=S.filter((g=>(qo(g),na(g)&&!function(g){let f=g;for(;f&&(f=f.parentElement);)if(f&&f.nodeName&&Qo.test(Ko(f))&&!f.getAttribute("instantiated_by_use"))return!0;return!1}(g))));if(!O||O&&!O.length)return e(e({},oa()),{},{options:T,allElements:S});const k={};S.filter((g=>"clipPath"===Ko(g))).forEach((g=>{g.setAttribute("originalTransform",g.getAttribute("transform")||"");const f=g.getAttribute("id");k[f]=Array.from(g.getElementsByTagName("*")).filter((g=>na(g)))}));const D=new ra(O,T,f,g,k);return{objects:await D.parse(),elements:O,options:T,allElements:S}}function ha(g,f,x){return aa((new(y().DOMParser)).parseFromString(g.trim(),"text/xml"),f,x)}function ca(g,f){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(((f,C)=>{rn(g.replace(/^\n\s*/,"").trim(),{onComplete:g=>{const x=g.responseXML;x&&f(x),C()},signal:x.signal})})).then((g=>aa(g,f,x))).catch((()=>oa()))}const pa="modifyPoly",ua=g=>function(f,x,C){const{points:w,pathOffset:S}=C;return new U(w[g]).subtract(S).transform(ct(C.getViewportTransform(),C.calcTransformMatrix()))},da=(g,f,x,C)=>{const{target:w,pointIndex:S}=f,T=w,O=ue(new U(x,C),void 0,T.calcOwnMatrix());return T.points[S]=O.add(T.pathOffset),T.setDimensions(),!0},ga=(g,f)=>function(x,C,w,S){const T=C.target,O=new U(T.points[(g>0?g:T.points.length)-1]),k=O.subtract(T.pathOffset).transform(T.calcOwnMatrix()),D=f(x,e(e({},C),{},{pointIndex:g}),w,S),M=O.subtract(T.pathOffset).transform(T.calcOwnMatrix()).subtract(k);return T.left-=M.x,T.top-=M.y,D},fa=g=>Es(pa,ga(g,da));var ya=Object.freeze({__proto__:null,changeWidth:Is,createObjectDefaultControls:ni,createPolyActionHandler:fa,createPolyControls:function(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const x={};for(let C=0;C<("number"==typeof g?g:g.points.length);C++)x["p".concat(C)]=new Rs(e({actionName:pa,positionHandler:ua(C),actionHandler:fa(C)},f));return x},createPolyPositionHandler:ua,createResizeControls:oi,createTextboxDefaultControls:ai,dragHandler:Se,factoryPolyActionHandler:ga,getLocalPoint:we,polyActionHandler:da,renderCircleControl:Fs,renderSquareControl:Ls,rotationStyleHandler:Bs,rotationWithSnapping:Us,scaleCursorStyleHandler:Vs,scaleOrSkewActionName:ei,scaleSkewCursorStyleHandler:si,scalingEqually:Hs,scalingX:Gs,scalingXOrSkewingY:ii,scalingY:Ns,scalingYOrSkewingX:ri,skewCursorStyleHandler:Js,skewHandlerX:Qs,skewHandlerY:$s,wrapWithFireEvent:Es,wrapWithFixedAnchor:As});const ma=g=>void 0!==g.webgl,va=(g,f)=>{const x=et(),C=et().getContext("webgl"),w={imageBuffer:new ArrayBuffer(g*f*4)},S={destinationWidth:g,destinationHeight:f,targetCanvas:x};let T;x.width=g,x.height=f,T=y().performance.now(),Yo.prototype.copyGLTo2D.call(w,C,S);const O=y().performance.now()-T;T=y().performance.now(),Yo.prototype.copyGLTo2DPutImageData.call(w,C,S);return O>y().performance.now()-T},_a="precision highp float",xa="\n    ".concat(_a,";\n    varying vec2 vTexCoord;\n    uniform sampler2D uTexture;\n    void main() {\n      gl_FragColor = texture2D(uTexture, vTexCoord);\n    }"),Ca=["type"],ba=["type"],Sa=new RegExp(_a,"g");class wa{get type(){return this.constructor.type}constructor(){let g=i(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Ca);s(this,"vertexSource","\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    void main() {\n      vTexCoord = aPosition;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }"),Object.assign(this,this.constructor.defaults,g)}getFragmentSource(){return xa}createProgram(g){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getFragmentSource(),x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.vertexSource;const{WebGLProbe:{GLPrecision:C="highp"}}=m();"highp"!==C&&(f=f.replace(Sa,_a.replace("highp",C)));const w=g.createShader(g.VERTEX_SHADER),S=g.createShader(g.FRAGMENT_SHADER),T=g.createProgram();if(!w||!S||!T)throw new c("Vertex, fragment shader or program creation error");if(g.shaderSource(w,x),g.compileShader(w),!g.getShaderParameter(w,g.COMPILE_STATUS))throw new c("Vertex shader compile error for ".concat(this.type,": ").concat(g.getShaderInfoLog(w)));if(g.shaderSource(S,f),g.compileShader(S),!g.getShaderParameter(S,g.COMPILE_STATUS))throw new c("Fragment shader compile error for ".concat(this.type,": ").concat(g.getShaderInfoLog(S)));if(g.attachShader(T,w),g.attachShader(T,S),g.linkProgram(T),!g.getProgramParameter(T,g.LINK_STATUS))throw new c('Shader link error for "'.concat(this.type,'" ').concat(g.getProgramInfoLog(T)));const O=this.getUniformLocations(g,T)||{};return O.uStepW=g.getUniformLocation(T,"uStepW"),O.uStepH=g.getUniformLocation(T,"uStepH"),{program:T,attributeLocations:this.getAttributeLocations(g,T),uniformLocations:O}}getAttributeLocations(g,f){return{aPosition:g.getAttribLocation(f,"aPosition")}}getUniformLocations(g,f){return{}}sendAttributeData(g,f,x){const C=f.aPosition,w=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,w),g.enableVertexAttribArray(C),g.vertexAttribPointer(C,2,g.FLOAT,!1,0,0),g.bufferData(g.ARRAY_BUFFER,x,g.STATIC_DRAW)}_setupFrameBuffer(g){const f=g.context;if(g.passes>1){const x=g.destinationWidth,C=g.destinationHeight;g.sourceWidth===x&&g.sourceHeight===C||(f.deleteTexture(g.targetTexture),g.targetTexture=g.filterBackend.createTexture(f,x,C)),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,g.targetTexture,0)}else f.bindFramebuffer(f.FRAMEBUFFER,null),f.finish()}_swapTextures(g){g.passes--,g.pass++;const f=g.targetTexture;g.targetTexture=g.sourceTexture,g.sourceTexture=f}isNeutralState(g){const f=this.mainParameter,x=this.constructor.defaults[f];if(f){const g=this[f];return Array.isArray(x)&&Array.isArray(g)?x.every(((f,x)=>f===g[x])):x===g}return!1}applyTo(g){ma(g)?(this._setupFrameBuffer(g),this.applyToWebGL(g),this._swapTextures(g)):this.applyTo2d(g)}applyTo2d(g){}getCacheKey(){return this.type}retrieveShader(g){const f=this.getCacheKey();return g.programCache[f]||(g.programCache[f]=this.createProgram(g.context)),g.programCache[f]}applyToWebGL(g){const f=g.context,x=this.retrieveShader(g);0===g.pass&&g.originalTexture?f.bindTexture(f.TEXTURE_2D,g.originalTexture):f.bindTexture(f.TEXTURE_2D,g.sourceTexture),f.useProgram(x.program),this.sendAttributeData(f,x.attributeLocations,g.aPosition),f.uniform1f(x.uniformLocations.uStepW,1/g.sourceWidth),f.uniform1f(x.uniformLocations.uStepH,1/g.sourceHeight),this.sendUniformData(f,x.uniformLocations),f.viewport(0,0,g.destinationWidth,g.destinationHeight),f.drawArrays(f.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(g,f,x){g.activeTexture(x),g.bindTexture(g.TEXTURE_2D,f),g.activeTexture(g.TEXTURE0)}unbindAdditionalTexture(g,f){g.activeTexture(f),g.bindTexture(g.TEXTURE_2D,null),g.activeTexture(g.TEXTURE0)}getMainParameter(){return this.mainParameter?this[this.mainParameter]:void 0}setMainParameter(g){this.mainParameter&&(this[this.mainParameter]=g)}sendUniformData(g,f){}createHelpLayer(g){if(!g.helpLayer){const f=et();f.width=g.sourceWidth,f.height=g.sourceHeight,g.helpLayer=f}}toObject(){const g=this.mainParameter;return e({type:this.type},g?{[g]:this[g]}:{})}toJSON(){return this.toObject()}static async fromObject(g,f){return new this(i(g,ba))}}s(wa,"type","BaseFilter");const Oa={multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",difference:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"\n    if (uColor.r < 0.5) {\n      gl_FragColor.r *= 2.0 * uColor.r;\n    } else {\n      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n    }\n    if (uColor.g < 0.5) {\n      gl_FragColor.g *= 2.0 * uColor.g;\n    } else {\n      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n    }\n    if (uColor.b < 0.5) {\n      gl_FragColor.b *= 2.0 * uColor.b;\n    } else {\n      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n    }\n    ",tint:"\n    gl_FragColor.rgb *= (1.0 - uColor.a);\n    gl_FragColor.rgb += uColor.rgb;\n    "};class Ta extends wa{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec4 uColor;\n      varying vec2 vTexCoord;\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        gl_FragColor = color;\n        if (color.a > 0.0) {\n          ".concat(Oa[this.mode],"\n        }\n      }\n      ")}applyTo2d(g){let{imageData:{data:f}}=g;const x=new At(this.color).getSource(),C=x[0]*this.alpha,w=x[1]*this.alpha,S=x[2]*this.alpha,T=1-this.alpha;for(let g=0;g<f.length;g+=4){const x=f[g],O=f[g+1],k=f[g+2];switch(this.mode){case"multiply":f[g]=x*C/255,f[g+1]=O*w/255,f[g+2]=k*S/255;break;case"screen":f[g]=255-(255-x)*(255-C)/255,f[g+1]=255-(255-O)*(255-w)/255,f[g+2]=255-(255-k)*(255-S)/255;break;case"add":f[g]=x+C,f[g+1]=O+w,f[g+2]=k+S;break;case"difference":f[g]=Math.abs(x-C),f[g+1]=Math.abs(O-w),f[g+2]=Math.abs(k-S);break;case"subtract":f[g]=x-C,f[g+1]=O-w,f[g+2]=k-S;break;case"darken":f[g]=Math.min(x,C),f[g+1]=Math.min(O,w),f[g+2]=Math.min(k,S);break;case"lighten":f[g]=Math.max(x,C),f[g+1]=Math.max(O,w),f[g+2]=Math.max(k,S);break;case"overlay":f[g]=C<128?2*x*C/255:255-2*(255-x)*(255-C)/255,f[g+1]=w<128?2*O*w/255:255-2*(255-O)*(255-w)/255,f[g+2]=S<128?2*k*S/255:255-2*(255-k)*(255-S)/255;break;case"exclusion":f[g]=C+x-2*C*x/255,f[g+1]=w+O-2*w*O/255,f[g+2]=S+k-2*S*k/255;break;case"tint":f[g]=C+x*T,f[g+1]=w+O*T,f[g+2]=S+k*T}}}getUniformLocations(g,f){return{uColor:g.getUniformLocation(f,"uColor")}}sendUniformData(g,f){const x=new At(this.color).getSource();x[0]=this.alpha*x[0]/255,x[1]=this.alpha*x[1]/255,x[2]=this.alpha*x[2]/255,x[3]=this.alpha,g.uniform4fv(f.uColor,x)}toObject(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}s(Ta,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),s(Ta,"type","BlendColor"),X.setClass(Ta);const ka={multiply:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.rgba *= color2.rgba;\n      gl_FragColor = color;\n    }\n    ",mask:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.a = color2.a;\n      gl_FragColor = color;\n    }\n    "},Aa=["type","image"];class Da extends wa{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return ka[this.mode]}applyToWebGL(g){const f=g.context,x=this.createTexture(g.filterBackend,this.image);this.bindAdditionalTexture(f,x,f.TEXTURE1),super.applyToWebGL(g),this.unbindAdditionalTexture(f,f.TEXTURE1)}createTexture(g,f){return g.getCachedTexture(f.cacheKey,f.getElement())}calculateMatrix(){const g=this.image,{width:f,height:x}=g.getElement();return[1/g.scaleX,0,0,0,1/g.scaleY,0,-g.left/f,-g.top/x,1]}applyTo2d(g){let{imageData:{data:f,width:x,height:C},filterBackend:{resources:w}}=g;const S=this.image;w.blendImage||(w.blendImage=et());const T=w.blendImage,O=T.getContext("2d");T.width!==x||T.height!==C?(T.width=x,T.height=C):O.clearRect(0,0,x,C),O.setTransform(S.scaleX,0,0,S.scaleY,S.left,S.top),O.drawImage(S.getElement(),0,0,x,C);const k=O.getImageData(0,0,x,C).data;for(let g=0;g<f.length;g+=4){const x=f[g],C=f[g+1],w=f[g+2],S=f[g+3],T=k[g],O=k[g+1],D=k[g+2],M=k[g+3];switch(this.mode){case"multiply":f[g]=x*T/255,f[g+1]=C*O/255,f[g+2]=w*D/255,f[g+3]=S*M/255;break;case"mask":f[g+3]=M}}}getUniformLocations(g,f){return{uTransformMatrix:g.getUniformLocation(f,"uTransformMatrix"),uImage:g.getUniformLocation(f,"uImage")}}sendUniformData(g,f){const x=this.calculateMatrix();g.uniform1i(f.uImage,1),g.uniformMatrix3fv(f.uTransformMatrix,!1,x)}toObject(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}static fromObject(g,f){let{type:x,image:C}=g,w=i(g,Aa);return No.fromObject(C,f).then((g=>new this(e(e({},w),{},{image:g}))))}}s(Da,"type","BlendImage"),s(Da,"defaults",{mode:"multiply",alpha:1,vertexSource:"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    uniform mat3 uTransformMatrix;\n    void main() {\n      vTexCoord = aPosition;\n      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }\n    "}),X.setClass(Da);class Ma extends wa{getFragmentSource(){return"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform vec2 uDelta;\n    varying vec2 vTexCoord;\n    const float nSamples = 15.0;\n    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\n    float random(vec3 scale) {\n      /* use the fragment position for a different seed per-pixel */\n      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n    }\n    void main() {\n      vec4 color = vec4(0.0);\n      float total = 0.0;\n      float offset = random(v3offset);\n      for (float t = -nSamples; t <= nSamples; t++) {\n        float percent = (t + offset - 0.5) / nSamples;\n        float weight = 1.0 - abs(percent);\n        color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\n        total += weight;\n      }\n      gl_FragColor = color / total;\n    }\n  "}applyTo(g){ma(g)?(this.aspectRatio=g.sourceWidth/g.sourceHeight,g.passes++,this._setupFrameBuffer(g),this.horizontal=!0,this.applyToWebGL(g),this._swapTextures(g),this._setupFrameBuffer(g),this.horizontal=!1,this.applyToWebGL(g),this._swapTextures(g)):this.applyTo2d(g)}applyTo2d(g){g.imageData=this.simpleBlur(g)}simpleBlur(g){let{ctx:f,imageData:x,filterBackend:{resources:C}}=g;const{width:w,height:S}=x;C.blurLayer1||(C.blurLayer1=et(),C.blurLayer2=et());const T=C.blurLayer1,O=C.blurLayer2;T.width===w&&T.height===S||(O.width=T.width=w,O.height=T.height=S);const k=T.getContext("2d"),D=O.getContext("2d"),M=15,A=.06*this.blur*.5;let P,E,j,F;for(k.putImageData(x,0,0),D.clearRect(0,0,w,S),F=-15;F<=M;F++)P=(Math.random()-.5)/4,E=F/M,j=A*E*w+P,D.globalAlpha=1-Math.abs(E),D.drawImage(T,j,P),k.drawImage(O,0,0),D.globalAlpha=1,D.clearRect(0,0,O.width,O.height);for(F=-15;F<=M;F++)P=(Math.random()-.5)/4,E=F/M,j=A*E*S+P,D.globalAlpha=1-Math.abs(E),D.drawImage(T,P,j),k.drawImage(O,0,0),D.globalAlpha=1,D.clearRect(0,0,O.width,O.height);f.drawImage(T,0,0);const L=f.getImageData(0,0,T.width,T.height);return k.globalAlpha=1,k.clearRect(0,0,T.width,T.height),L}getUniformLocations(g,f){return{delta:g.getUniformLocation(f,"uDelta")}}sendUniformData(g,f){const x=this.chooseRightDelta();g.uniform2fv(f.delta,x)}chooseRightDelta(){let g=1;const f=[0,0];this.horizontal?this.aspectRatio>1&&(g=1/this.aspectRatio):this.aspectRatio<1&&(g=this.aspectRatio);const x=g*this.blur*.12;return this.horizontal?f[0]=x:f[1]=x,f}}s(Ma,"type","Blur"),s(Ma,"defaults",{blur:0,mainParameter:"blur"}),X.setClass(Ma);class Pa extends wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBrightness;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += uBrightness;\n    gl_FragColor = color;\n  }\n"}applyTo2d(g){let{imageData:{data:f}}=g;if(0===this.brightness)return;const x=Math.round(255*this.brightness);for(let g=0;g<f.length;g+=4)f[g]=f[g]+x,f[g+1]=f[g+1]+x,f[g+2]=f[g+2]+x}getUniformLocations(g,f){return{uBrightness:g.getUniformLocation(f,"uBrightness")}}sendUniformData(g,f){g.uniform1f(f.uBrightness,this.brightness)}}s(Pa,"type","Brightness"),s(Pa,"defaults",{brightness:0,mainParameter:"brightness"}),X.setClass(Pa);const Ea=["matrix"],La={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0};class ja extends wa{setOptions(g){let{matrix:f}=g,x=i(g,Ea);f&&(this.matrix=[...f]),Object.assign(this,x)}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  varying vec2 vTexCoord;\n  uniform mat4 uColorMatrix;\n  uniform vec4 uConstants;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color *= uColorMatrix;\n    color += uConstants;\n    gl_FragColor = color;\n  }"}applyTo2d(g){const f=g.imageData.data,x=this.matrix,C=this.colorsOnly;for(let g=0;g<f.length;g+=4){const w=f[g],S=f[g+1],T=f[g+2];if(C)f[g]=w*x[0]+S*x[1]+T*x[2]+255*x[4],f[g+1]=w*x[5]+S*x[6]+T*x[7]+255*x[9],f[g+2]=w*x[10]+S*x[11]+T*x[12]+255*x[14];else{const C=f[g+3];f[g]=w*x[0]+S*x[1]+T*x[2]+C*x[3]+255*x[4],f[g+1]=w*x[5]+S*x[6]+T*x[7]+C*x[8]+255*x[9],f[g+2]=w*x[10]+S*x[11]+T*x[12]+C*x[13]+255*x[14],f[g+3]=w*x[15]+S*x[16]+T*x[17]+C*x[18]+255*x[19]}}}getUniformLocations(g,f){return{uColorMatrix:g.getUniformLocation(f,"uColorMatrix"),uConstants:g.getUniformLocation(f,"uConstants")}}sendUniformData(g,f){const x=this.matrix,C=[x[0],x[1],x[2],x[3],x[5],x[6],x[7],x[8],x[10],x[11],x[12],x[13],x[15],x[16],x[17],x[18]],w=[x[4],x[9],x[14],x[19]];g.uniformMatrix4fv(f.uColorMatrix,!1,C),g.uniform4fv(f.uConstants,w)}}function Fa(g,f){var x;const C=(s(x=class extends ja{},"type",g),s(x,"defaults",e(e({},La),{},{mainParameter:void 0,matrix:f})),x);return X.setClass(C,g),C}s(ja,"type","ColorMatrix"),s(ja,"defaults",La),X.setClass(ja);const Ra=Fa("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]),Ba=Fa("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]),Ia=Fa("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]),Xa=Fa("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]),Ya=Fa("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]),Wa=Fa("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]),Va=Fa("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]),Ga=["subFilters"];class za extends wa{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{subFilters:f=[]}=g;super(i(g,Ga)),this.subFilters=f}applyTo(g){ma(g)&&(g.passes+=this.subFilters.length-1),this.subFilters.forEach((f=>{f.applyTo(g)}))}toObject(){return e(e({},super.toObject()),{},{subFilters:this.subFilters.map((g=>g.toObject()))})}isNeutralState(){return!this.subFilters.some((g=>!g.isNeutralState()))}static fromObject(g,f){return Promise.all((g.subFilters||[]).map((g=>X.getClass(g.type).fromObject(g,f)))).then((g=>new this({subFilters:g})))}}s(za,"type","Composed"),X.setClass(za);class Ha extends wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uContrast;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\n    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\n    gl_FragColor = color;\n  }"}applyTo2d(g){let{imageData:{data:f}}=g;if(0===this.contrast)return;const x=Math.floor(255*this.contrast),C=259*(x+255)/(255*(259-x));for(let g=0;g<f.length;g+=4)f[g]=C*(f[g]-128)+128,f[g+1]=C*(f[g+1]-128)+128,f[g+2]=C*(f[g+2]-128)+128}getUniformLocations(g,f){return{uContrast:g.getUniformLocation(f,"uContrast")}}sendUniformData(g,f){g.uniform1f(f.uContrast,this.contrast)}}s(Ha,"type","Contrast"),s(Ha,"defaults",{contrast:0,mainParameter:"contrast"}),X.setClass(Ha);const Na={Convolute_3_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_3_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_5_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_5_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_7_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_7_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_9_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_9_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    "};class Ua extends wa{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return Na[this.getCacheKey()]}applyTo2d(g){const f=g.imageData,x=f.data,C=this.matrix,w=Math.round(Math.sqrt(C.length)),S=Math.floor(w/2),T=f.width,O=f.height,k=g.ctx.createImageData(T,O),D=k.data,M=this.opaque?1:0;let A,P,E,j,F,L,R,B,I,X,N,$,Ot;for(N=0;N<O;N++)for(X=0;X<T;X++){for(F=4*(N*T+X),A=0,P=0,E=0,j=0,Ot=0;Ot<w;Ot++)for($=0;$<w;$++)R=N+Ot-S,L=X+$-S,R<0||R>=O||L<0||L>=T||(B=4*(R*T+L),I=C[Ot*w+$],A+=x[B]*I,P+=x[B+1]*I,E+=x[B+2]*I,M||(j+=x[B+3]*I));D[F]=A,D[F+1]=P,D[F+2]=E,D[F+3]=M?x[F+3]:j}g.imageData=k}getUniformLocations(g,f){return{uMatrix:g.getUniformLocation(f,"uMatrix"),uOpaque:g.getUniformLocation(f,"uOpaque"),uHalfSize:g.getUniformLocation(f,"uHalfSize"),uSize:g.getUniformLocation(f,"uSize")}}sendUniformData(g,f){g.uniform1fv(f.uMatrix,this.matrix)}toObject(){return e(e({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}s(Ua,"type","Convolute"),s(Ua,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),X.setClass(Ua);const Ka=["gamma"];class qa extends wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform vec3 uGamma;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    vec3 correction = (1.0 / uGamma);\n    color.r = pow(color.r, correction.r);\n    color.g = pow(color.g, correction.g);\n    color.b = pow(color.b, correction.b);\n    gl_FragColor = color;\n    gl_FragColor.rgb *= color.a;\n  }\n"}constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{gamma:f=[1,1,1]}=g;super(i(g,Ka)),this.gamma=f}applyTo2d(g){let{imageData:{data:f}}=g;const x=this.gamma,C=1/x[0],w=1/x[1],S=1/x[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const T=this.rgbValues;for(let g=0;g<256;g++)T.r[g]=255*Math.pow(g/255,C),T.g[g]=255*Math.pow(g/255,w),T.b[g]=255*Math.pow(g/255,S);for(let g=0;g<f.length;g+=4)f[g]=T.r[f[g]],f[g+1]=T.g[f[g+1]],f[g+2]=T.b[f[g+2]]}getUniformLocations(g,f){return{uGamma:g.getUniformLocation(f,"uGamma")}}sendUniformData(g,f){g.uniform3fv(f.uGamma,this.gamma)}}s(qa,"type","Gamma"),s(qa,"defaults",{mainParameter:"gamma",gamma:[1,1,1]}),X.setClass(qa);const nh={average:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      float average = (color.r + color.b + color.g) / 3.0;\n      gl_FragColor = vec4(average, average, average, color.a);\n    }\n    ",lightness:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    ",luminosity:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    "};class Ja extends wa{applyTo2d(g){let{imageData:{data:f}}=g;for(let g,x=0;x<f.length;x+=4){switch(this.mode){case"average":g=(f[x]+f[x+1]+f[x+2])/3;break;case"lightness":g=(Math.min(f[x],f[x+1],f[x+2])+Math.max(f[x],f[x+1],f[x+2]))/2;break;case"luminosity":g=.21*f[x]+.72*f[x+1]+.07*f[x+2]}f[x]=g,f[x+1]=g,f[x+2]=g}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return nh[this.mode]}getUniformLocations(g,f){return{uMode:g.getUniformLocation(f,"uMode")}}sendUniformData(g,f){g.uniform1i(f.uMode,1)}isNeutralState(){return!1}}s(Ja,"type","Grayscale"),s(Ja,"defaults",{mode:"average",mainParameter:"mode"}),X.setClass(Ja);class Za extends ja{calculateMatrix(){const g=this.rotation*Math.PI,f=H(g),x=G(g),C=1/3,w=Math.sqrt(C)*x,S=1-f;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=f+S/3,this.matrix[1]=C*S-w,this.matrix[2]=C*S+w,this.matrix[5]=C*S+w,this.matrix[6]=f+C*S,this.matrix[7]=C*S-w,this.matrix[10]=C*S-w,this.matrix[11]=C*S+w,this.matrix[12]=f+C*S}isNeutralState(){return this.calculateMatrix(),super.isNeutralState()}applyTo(g){this.calculateMatrix(),super.applyTo(g)}}s(Za,"type","HueRotation"),s(Za,"defaults",{rotation:0,mainParameter:"rotation"}),X.setClass(Za);class Qa extends wa{applyTo2d(g){let{imageData:{data:f}}=g;for(let g=0;g<f.length;g+=4)f[g]=255-f[g],f[g+1]=255-f[g+1],f[g+2]=255-f[g+2],this.alpha&&(f[g+3]=255-f[g+3])}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform int uInvert;\n  uniform int uAlpha;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    if (uInvert == 1) {\n      if (uAlpha == 1) {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);\n      } else {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n      }\n    } else {\n      gl_FragColor = color;\n    }\n  }\n"}isNeutralState(){return!this.invert}getUniformLocations(g,f){return{uInvert:g.getUniformLocation(f,"uInvert"),uAlpha:g.getUniformLocation(f,"uAlpha")}}sendUniformData(g,f){g.uniform1i(f.uInvert,Number(this.invert)),g.uniform1i(f.uAlpha,Number(this.alpha))}}s(Qa,"type","Invert"),s(Qa,"defaults",{alpha:!1,invert:!0,mainParameter:"invert"}),X.setClass(Qa);class $a extends wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uStepH;\n  uniform float uNoise;\n  uniform float uSeed;\n  varying vec2 vTexCoord;\n  float rand(vec2 co, float seed, float vScale) {\n    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n  }\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\n    gl_FragColor = color;\n  }\n"}applyTo2d(g){let{imageData:{data:f}}=g;if(0===this.noise)return;const x=this.noise;for(let g=0;g<f.length;g+=4){const C=(.5-Math.random())*x;f[g]+=C,f[g+1]+=C,f[g+2]+=C}}getUniformLocations(g,f){return{uNoise:g.getUniformLocation(f,"uNoise"),uSeed:g.getUniformLocation(f,"uSeed")}}sendUniformData(g,f){g.uniform1f(f.uNoise,this.noise/255),g.uniform1f(f.uSeed,Math.random())}toObject(){return e(e({},super.toObject()),{},{noise:this.noise})}}s($a,"type","Noise"),s($a,"defaults",{mainParameter:"noise",noise:0}),X.setClass($a);class th extends wa{applyTo2d(g){let{imageData:{data:f,width:x,height:C}}=g;for(let g=0;g<C;g+=this.blocksize)for(let w=0;w<x;w+=this.blocksize){const S=4*g*x+4*w,T=f[S],O=f[S+1],k=f[S+2],D=f[S+3];for(let S=g;S<Math.min(g+this.blocksize,C);S++)for(let g=w;g<Math.min(w+this.blocksize,x);g++){const C=4*S*x+4*g;f[C]=T,f[C+1]=O,f[C+2]=k,f[C+3]=D}}}isNeutralState(){return 1===this.blocksize}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBlocksize;\n  uniform float uStepW;\n  uniform float uStepH;\n  varying vec2 vTexCoord;\n  void main() {\n    float blockW = uBlocksize * uStepW;\n    float blockH = uBlocksize * uStepW;\n    int posX = int(vTexCoord.x / blockW);\n    int posY = int(vTexCoord.y / blockH);\n    float fposX = float(posX);\n    float fposY = float(posY);\n    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\n    vec4 color = texture2D(uTexture, squareCoords);\n    gl_FragColor = color;\n  }\n"}getUniformLocations(g,f){return{uBlocksize:g.getUniformLocation(f,"uBlocksize"),uStepW:g.getUniformLocation(f,"uStepW"),uStepH:g.getUniformLocation(f,"uStepH")}}sendUniformData(g,f){g.uniform1f(f.uBlocksize,this.blocksize)}}s(th,"type","Pixelate"),s(th,"defaults",{blocksize:4,mainParameter:"blocksize"}),X.setClass(th);class eh extends wa{getFragmentShader(){return"\nprecision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(uTexture, vTexCoord);\n  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\n    gl_FragColor.a = 0.0;\n  }\n}\n"}applyTo2d(g){let{imageData:{data:f}}=g;const x=255*this.distance,C=new At(this.color).getSource(),w=[C[0]-x,C[1]-x,C[2]-x],S=[C[0]+x,C[1]+x,C[2]+x];for(let g=0;g<f.length;g+=4){const x=f[g],C=f[g+1],T=f[g+2];x>w[0]&&C>w[1]&&T>w[2]&&x<S[0]&&C<S[1]&&T<S[2]&&(f[g+3]=0)}}getUniformLocations(g,f){return{uLow:g.getUniformLocation(f,"uLow"),uHigh:g.getUniformLocation(f,"uHigh")}}sendUniformData(g,f){const x=new At(this.color).getSource(),C=this.distance,w=[0+x[0]/255-C,0+x[1]/255-C,0+x[2]/255-C,1],S=[x[0]/255+C,x[1]/255+C,x[2]/255+C,1];g.uniform4fv(f.uLow,w),g.uniform4fv(f.uHigh,S)}toObject(){return e(e({},super.toObject()),{},{color:this.color,distance:this.distance})}}s(eh,"type","RemoveColor"),s(eh,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),X.setClass(eh);class sh extends wa{getUniformLocations(g,f){return{uDelta:g.getUniformLocation(f,"uDelta"),uTaps:g.getUniformLocation(f,"uTaps")}}sendUniformData(g,f){g.uniform2fv(f.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),g.uniform1fv(f.uTaps,this.taps)}getFilterWindow(){const g=this.tempScale;return Math.ceil(this.lanczosLobes/g)}getCacheKey(){const g=this.getFilterWindow();return"".concat(this.type,"_").concat(g)}getFragmentSource(){const g=this.getFilterWindow();return this.generateShader(g)}getTaps(){const g=this.lanczosCreate(this.lanczosLobes),f=this.tempScale,x=this.getFilterWindow(),C=new Array(x);for(let w=1;w<=x;w++)C[w-1]=g(w*f);return C}generateShader(g){const f=new Array(g);for(let x=1;x<=g;x++)f[x-1]="".concat(x,".0 * uDelta");return"\n      ".concat(this.fragmentSourceTOP,"\n      uniform float uTaps[").concat(g,"];\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        float sum = 1.0;\n        ").concat(f.map(((g,f)=>"\n              color += texture2D(uTexture, vTexCoord + ".concat(g,") * uTaps[").concat(f,"] + texture2D(uTexture, vTexCoord - ").concat(g,") * uTaps[").concat(f,"];\n              sum += 2.0 * uTaps[").concat(f,"];\n            "))).join("\n"),"\n        gl_FragColor = color / sum;\n      }\n    ")}applyToForWebgl(g){g.passes++,this.width=g.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=g.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),g.destinationWidth=this.dW,super.applyTo(g),g.sourceWidth=g.destinationWidth,this.height=g.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),g.destinationHeight=this.dH,super.applyTo(g),g.sourceHeight=g.destinationHeight}applyTo(g){ma(g)?this.applyToForWebgl(g):this.applyTo2d(g)}isNeutralState(){return 1===this.scaleX&&1===this.scaleY}lanczosCreate(g){return f=>{if(f>=g||f<=-g)return 0;if(f<1.1920929e-7&&f>-1.1920929e-7)return 1;const x=(f*=Math.PI)/g;return Math.sin(f)/f*Math.sin(x)/x}}applyTo2d(g){const f=g.imageData,x=this.scaleX,C=this.scaleY;this.rcpScaleX=1/x,this.rcpScaleY=1/C;const w=f.width,S=f.height,T=Math.round(w*x),O=Math.round(S*C);let k;k="sliceHack"===this.resizeType?this.sliceByTwo(g,w,S,T,O):"hermite"===this.resizeType?this.hermiteFastResize(g,w,S,T,O):"bilinear"===this.resizeType?this.bilinearFiltering(g,w,S,T,O):"lanczos"===this.resizeType?this.lanczosResize(g,w,S,T,O):new ImageData(T,O),g.imageData=k}sliceByTwo(g,f,x,C,w){const S=g.imageData,T=.5;let O=!1,k=!1,D=f*T,M=x*T;const A=g.filterBackend.resources;let P=0,E=0;const j=f;let F=0;A.sliceByTwo||(A.sliceByTwo=et());const L=A.sliceByTwo;(L.width<1.5*f||L.height<x)&&(L.width=1.5*f,L.height=x);const R=L.getContext("2d");for(R.clearRect(0,0,1.5*f,x),R.putImageData(S,0,0),C=Math.floor(C),w=Math.floor(w);!O||!k;)f=D,x=M,C<Math.floor(D*T)?D=Math.floor(D*T):(D=C,O=!0),w<Math.floor(M*T)?M=Math.floor(M*T):(M=w,k=!0),R.drawImage(L,P,E,f,x,j,F,D,M),P=j,E=F,F+=M;return R.getImageData(P,E,C,w)}lanczosResize(g,f,x,C,w){const S=g.imageData.data,T=g.ctx.createImageData(C,w),O=T.data,k=this.lanczosCreate(this.lanczosLobes),D=this.rcpScaleX,M=this.rcpScaleY,A=2/this.rcpScaleX,P=2/this.rcpScaleY,E=Math.ceil(D*this.lanczosLobes/2),j=Math.ceil(M*this.lanczosLobes/2),F={},L={x:0,y:0},R={x:0,y:0};return function t(g){let B,I,X,N,$,Ot,Zt,$t,re,pe,ve;for(L.x=(g+.5)*D,R.x=Math.floor(L.x),B=0;B<w;B++){for(L.y=(B+.5)*M,R.y=Math.floor(L.y),$=0,Ot=0,Zt=0,$t=0,re=0,I=R.x-E;I<=R.x+E;I++)if(!(I<0||I>=f)){pe=Math.floor(1e3*Math.abs(I-L.x)),F[pe]||(F[pe]={});for(let g=R.y-j;g<=R.y+j;g++)g<0||g>=x||(ve=Math.floor(1e3*Math.abs(g-L.y)),F[pe][ve]||(F[pe][ve]=k(Math.sqrt(Math.pow(pe*A,2)+Math.pow(ve*P,2))/1e3)),X=F[pe][ve],X>0&&(N=4*(g*f+I),$+=X,Ot+=X*S[N],Zt+=X*S[N+1],$t+=X*S[N+2],re+=X*S[N+3]))}N=4*(B*C+g),O[N]=Ot/$,O[N+1]=Zt/$,O[N+2]=$t/$,O[N+3]=re/$}return++g<C?t(g):T}(0)}bilinearFiltering(g,f,x,C,w){let S,T,O,k,D,M,A,P,E,j,F,L,R,B=0;const I=this.rcpScaleX,X=this.rcpScaleY,N=4*(f-1),$=g.imageData.data,Ot=g.ctx.createImageData(C,w),Zt=Ot.data;for(A=0;A<w;A++)for(P=0;P<C;P++)for(D=Math.floor(I*P),M=Math.floor(X*A),E=I*P-D,j=X*A-M,R=4*(M*f+D),F=0;F<4;F++)S=$[R+F],T=$[R+4+F],O=$[R+N+F],k=$[R+N+4+F],L=S*(1-E)*(1-j)+T*E*(1-j)+O*j*(1-E)+k*E*j,Zt[B++]=L;return Ot}hermiteFastResize(g,f,x,C,w){const S=this.rcpScaleX,T=this.rcpScaleY,O=Math.ceil(S/2),k=Math.ceil(T/2),D=g.imageData.data,M=g.ctx.createImageData(C,w),A=M.data;for(let g=0;g<w;g++)for(let x=0;x<C;x++){const w=4*(x+g*C);let M=0,P=0,E=0,j=0,F=0,L=0,R=0;const B=(g+.5)*T;for(let C=Math.floor(g*T);C<(g+1)*T;C++){const g=Math.abs(B-(C+.5))/k,w=(x+.5)*S,T=g*g;for(let g=Math.floor(x*S);g<(x+1)*S;g++){let x=Math.abs(w-(g+.5))/O;const S=Math.sqrt(T+x*x);S>1&&S<-1||(M=2*S*S*S-3*S*S+1,M>0&&(x=4*(g+C*f),R+=M*D[x+3],E+=M,D[x+3]<255&&(M=M*D[x+3]/250),j+=M*D[x],F+=M*D[x+1],L+=M*D[x+2],P+=M))}}A[w]=j/P,A[w+1]=F/P,A[w+2]=L/P,A[w+3]=R/E}return M}toObject(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}s(sh,"type","Resize"),s(sh,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,fragmentSourceTOP:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform vec2 uDelta;\n    varying vec2 vTexCoord;\n  "}),X.setClass(sh);class ih extends wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uSaturation;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float rgMax = max(color.r, color.g);\n    float rgbMax = max(rgMax, color.b);\n    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\n    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\n    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(g){let{imageData:{data:f}}=g;if(0===this.saturation)return;const x=-this.saturation;for(let g=0;g<f.length;g+=4){const C=Math.max(f[g],f[g+1],f[g+2]);f[g]+=C!==f[g]?(C-f[g])*x:0,f[g+1]+=C!==f[g+1]?(C-f[g+1])*x:0,f[g+2]+=C!==f[g+2]?(C-f[g+2])*x:0}}getUniformLocations(g,f){return{uSaturation:g.getUniformLocation(f,"uSaturation")}}sendUniformData(g,f){g.uniform1f(f.uSaturation,-this.saturation)}}s(ih,"type","Saturation"),s(ih,"defaults",{saturation:0,mainParameter:"saturation"}),X.setClass(ih);class rh extends wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uVibrance;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float max = max(color.r, max(color.g, color.b));\n    float avg = (color.r + color.g + color.b) / 3.0;\n    float amt = (abs(max - avg) * 2.0) * uVibrance;\n    color.r += max != color.r ? (max - color.r) * amt : 0.00;\n    color.g += max != color.g ? (max - color.g) * amt : 0.00;\n    color.b += max != color.b ? (max - color.b) * amt : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(g){let{imageData:{data:f}}=g;if(0===this.vibrance)return;const x=-this.vibrance;for(let g=0;g<f.length;g+=4){const C=Math.max(f[g],f[g+1],f[g+2]),w=(f[g]+f[g+1]+f[g+2])/3,S=2*Math.abs(C-w)/255*x;f[g]+=C!==f[g]?(C-f[g])*S:0,f[g+1]+=C!==f[g+1]?(C-f[g+1])*S:0,f[g+2]+=C!==f[g+2]?(C-f[g+2])*S:0}}getUniformLocations(g,f){return{uVibrance:g.getUniformLocation(f,"uVibrance")}}sendUniformData(g,f){g.uniform1f(f.uVibrance,-this.vibrance)}}s(rh,"type","Vibrance"),s(rh,"defaults",{vibrance:0,mainParameter:"vibrance"}),X.setClass(rh);var oh=Object.freeze({__proto__:null,BaseFilter:wa,BlackWhite:Va,BlendColor:Ta,BlendImage:Da,Blur:Ma,Brightness:Pa,Brownie:Ra,ColorMatrix:ja,Composed:za,Contrast:Ha,Convolute:Ua,Gamma:qa,Grayscale:Ja,HueRotation:Za,Invert:Qa,Kodachrome:Ia,Noise:$a,Pixelate:th,Polaroid:Ya,RemoveColor:eh,Resize:sh,Saturation:ih,Sepia:Wa,Technicolor:Xa,Vibrance:rh,Vintage:Ba});export{Io as ActiveSelection,jn as BaseBrush,js as BaseFabricObject,mn as Canvas,Xo as Canvas2dFilterBackend,an as CanvasDOMManager,Yn as Circle,Wn as CircleBrush,Fo as ClipPathLayout,At as Color,Rs as Control,Jn as Ellipse,No as FabricImage,li as FabricObject,_o as FabricText,ur as FitContentLayout,Lo as FixedLayout,Pn as Gradient,yr as Group,Ao as IText,No as Image,is as Intersection,pr as LayoutManager,lr as LayoutStrategy,Nn as Line,li as Object,Y as Observable,Rn as Path,An as Pattern,zn as PatternBrush,Bn as PencilBrush,U as Point,eo as Polygon,to as Polyline,rr as Rect,ws as Shadow,Vn as SprayBrush,Qt as StaticCanvas,Jt as StaticCanvasDOMManager,_o as Text,jo as Textbox,qn as Triangle,Yo as WebGLFilterBackend,C as cache,X as classRegistry,g as config,ya as controlsUtils,K as createCollectionMixin,oh as filters,sa as getCSSRules,m as getEnv,v as getFabricDocument,y as getFabricWindow,zo as getFilterBackend,k as iMatrix,Vo as initFilterBackend,va as isPutImageFaster,ma as isWebGLPipelineState,ha as loadSVGFromString,ca as loadSVGFromURL,er as parseAttributes,Qi as parseFontDeclaration,Zn as parsePointsAttribute,aa as parseSVGDocument,$i as parseStyleAttribute,Ji as parseTransformAttribute,N as runningAnimations,p as setEnv,Ho as setFilterBackend,ln as util,w as version};

